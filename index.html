<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>哈尔斯带级认证学习系统</title>
    <link rel="icon" type="image/png" href="企业logo白字透明底.png">
    <link rel="apple-touch-icon" href="企业logo白字透明底.png">
    <style>
        :root {
            --klein-blue: #002FA7;
            --pure-white: #FFFFFF;
            --bright-yellow: #FFD700;
            --text-dark: #333333;
            --text-light: #555555;
            --gray-bg: #F8F9FA;
            --success-green: #28a745;
            --fail-red: #dc3545;
            --accent-blue: #E3F2FD;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; background: var(--pure-white); color: var(--text-dark); line-height: 1.7; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- 布局组件 --- */
        .container { max-width: 1440px; margin: 0 auto; padding: 20px; position: relative; flex: 1; width: 100%; }
        .top-accent { height: 4px; background: var(--bright-yellow); width: 100%; position: fixed; top: 0; left: 0; z-index: 1000; }

        nav { display: flex; justify-content: space-between; align-items: center; padding: 25px 0; border-bottom: 1px solid #eee; margin-bottom: 30px; background: var(--pure-white); }
        .brand { display: inline-flex; align-items: center; gap: 12px; cursor: pointer; }
        .brand-mark { width: 78px; height: 78px; border-radius: 24px; background: var(--klein-blue); display: grid; place-items: center; box-shadow: 0 16px 40px rgba(0,47,167,0.28); }
        .brand-mark img { width: 60px; height: 60px; object-fit: contain; display: block; }
        .logo { color: var(--klein-blue); font-size: 1.8rem; font-weight: 950; letter-spacing: -0.5px; }
        .nav-links { display: flex; gap: 25px; }
        .nav-item { cursor: pointer; color: var(--text-dark); font-weight: 600; transition: 0.3s; position: relative; }
        .nav-item:hover { color: var(--klein-blue); }
        .nav-right { display: flex; align-items: center; gap: 12px; }
        .user-chip { display: none; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 999px; border: 1px solid rgba(17,24,39,0.10); background: #ffffff; cursor: pointer; transition: 0.18s; }
        .user-chip:hover { border-color: rgba(0,47,167,0.22); background: rgba(0,47,167,0.03); }
        .user-avatar { width: 30px; height: 30px; border-radius: 999px; display: grid; place-items: center; background: rgba(0,47,167,0.12); color: var(--klein-blue); font-weight: 950; }
        .user-avatar svg { width: 18px; height: 18px; }
        .user-name { font-weight: 900; color: #111827; }
        .user-meta { color: #6b7280; font-weight: 800; font-size: 0.9rem; }
        
        /* --- 按钮系统 --- */
        .btn { padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 0.95rem; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--klein-blue); color: white; box-shadow: 0 4px 10px rgba(0, 47, 167, 0.2); }
        .btn-primary:hover { background: #002585; box-shadow: 0 6px 15px rgba(0, 47, 167, 0.3); }
        .btn-outline { background: transparent; border: 2px solid var(--klein-blue); color: var(--klein-blue); }
        .btn-outline:hover { background: var(--gray-bg); }
        .btn-ghost { background: var(--bright-yellow); color: var(--klein-blue); }
        .btn-ghost:hover { background: #e6c200; }

        /* --- 首页（无背景图，标题居中） --- */
        #hero-page { padding: 96px 0 70px; animation: fadeIn 0.8s ease-out; }
        .cover-section { background: transparent; }
        .cover-inner { max-width: 1440px; margin: 0 auto; padding: 0 20px; text-align: center; }

        .hero-title { font-size: 3.45rem; color: var(--klein-blue); margin-bottom: 22px; font-weight: 950; letter-spacing: -0.5px; text-align:center; }
        .hero-subtitle { font-size: 1.08rem; color: #4b5563; margin-bottom: 18px; max-width: 980px; font-weight: 650; margin-left: auto; margin-right: auto; text-align:center; }
        .hero-slogan { margin-bottom: 52px; color: #0b1b3a; font-weight: 950; letter-spacing: 1px; text-align:center; }

        .mode-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 22px; margin-top: 26px; }
        .mode-card { background: #ffffff; border: 1px solid rgba(17,24,39,0.10); border-radius: 22px; padding: 34px 26px 30px; cursor: pointer; transition: 0.18s; position: relative; overflow: hidden; text-align: center; box-shadow: 0 14px 40px rgba(17,24,39,0.06); }
        .mode-card::before { content: ""; position: absolute; inset: 0; background: radial-gradient(circle at 50% 0%, rgba(0,47,167,0.14), transparent 55%); opacity: 0.28; }
        .mode-card > * { position: relative; z-index: 1; }
        .mode-card:hover { transform: translateY(-4px); box-shadow: 0 22px 60px rgba(17,24,39,0.10); border-color: rgba(0,47,167,0.20); }
        .mode-card.talent { grid-column: auto; }
        .mode-card.mode-exam { border-color: rgba(220,53,69,0.22); box-shadow: 0 16px 46px rgba(220,53,69,0.10); }
        .mode-card.mode-exam::before { background: radial-gradient(circle at 50% 0%, rgba(255,215,0,0.22), rgba(220,53,69,0.12), transparent 60%); opacity: 0.45; }
        .mode-card.mode-exam:hover { border-color: rgba(220,53,69,0.38); box-shadow: 0 26px 70px rgba(220,53,69,0.16); }

        .mode-num { position: absolute; top: 16px; left: 16px; display: inline-flex; align-items: center; justify-content: center; padding: 7px 11px; border-radius: 999px; background: rgba(17,24,39,0.05); color: #111827; font-weight: 950; font-size: 0.9rem; letter-spacing: 0.6px; }
        .mode-icon { width: 72px; height: 72px; border-radius: 22px; display: grid; place-items: center; margin: 6px auto 16px; }
        .mode-icon svg { width: 34px; height: 34px; }
        .mode-icon.study { background: rgba(0,47,167,0.12); color: var(--klein-blue); }
        .mode-icon.practice { background: rgba(255,215,0,0.26); color: #7a5b00; }
        .mode-icon.exam { background: rgba(220,53,69,0.12); color: #b42318; }

        .mode-title { font-size: 1.9rem; color: #111827; font-weight: 950; letter-spacing: 0.2px; line-height: 1.1; }
        .mode-caption { margin-top: 6px; font-size: 0.9rem; color: #6b7280; font-weight: 850; letter-spacing: 1.1px; text-transform: uppercase; }
        .mode-desc { margin-top: 14px; color: #4b5563; font-size: 0.98rem; line-height: 1.75; }

        .mode-arrow { position: absolute; right: 16px; top: 16px; width: 36px; height: 36px; border-radius: 999px; border: 1px solid rgba(17,24,39,0.10); display:flex; align-items:center; justify-content:center; color: rgba(17,24,39,0.55); background: rgba(255,255,255,0.7); }
        .mode-card:hover .mode-arrow { color: var(--klein-blue); border-color: rgba(0,47,167,0.22); background: rgba(0,47,167,0.04); }

        @media (max-width: 1280px) {
            .mode-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 980px) {
            .mode-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 720px) {
            .mode-grid { grid-template-columns: 1fr; }
        }

        #memo-modules { text-align: left; }
        .memo-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 18px; width: 100%; }
        .memo-card { background: #ffffff; border: 1px solid rgba(17,24,39,0.10); border-radius: 18px; padding: 18px 18px 16px; cursor: pointer; transition: 0.18s; position: relative; overflow: hidden; text-align: left; box-shadow: 0 12px 34px rgba(17,24,39,0.05); display: grid; gap: 8px; }
        .memo-card:hover { transform: translateY(-2px); box-shadow: 0 18px 46px rgba(17,24,39,0.10); border-color: rgba(0,47,167,0.20); }
        .memo-head { display: flex; align-items: center; gap: 10px; }
        .memo-icon { width: 38px; height: 38px; border-radius: 14px; display: grid; place-items: center; background: rgba(0,47,167,0.10); color: var(--klein-blue); }
        .memo-icon svg { width: 20px; height: 20px; }
        .memo-title { font-weight: 950; color: #111827; letter-spacing: 0.2px; }
        .memo-desc { color: #4b5563; font-weight: 750; line-height: 1.65; }
        .memo-hint { color: #b45309; font-weight: 900; font-size: 0.92rem; }
        .memo-card.locked { cursor: not-allowed; }
        .memo-card.locked:hover { transform: none; box-shadow: 0 12px 34px rgba(17,24,39,0.05); border-color: rgba(17,24,39,0.10); }
        .memo-card.locked::after { content: "LOCKED"; position: absolute; right: 14px; top: 12px; opacity: 0.55; font-weight: 950; font-size: 0.85rem; letter-spacing: 0.6px; }

        @media (max-width: 720px) {
            .memo-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 900px) {
            #hero-page { padding: 72px 0 52px; }
            .hero-title { font-size: 2.45rem; }
            .hero-slogan { margin-bottom: 40px; }
        }

        /* --- 科目选择 --- */
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; animation: slideUp 0.5s ease-out; }
        .subject-card { 
            background: var(--pure-white); border: 1px solid #eee; padding: 25px; border-radius: 12px; 
            cursor: pointer; transition: 0.3s; border-left: 5px solid transparent; 
            display: flex; flex-direction: column; justify-content: center; height: 140px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }
        .subject-card:hover { border-left-color: var(--bright-yellow); transform: translateX(5px); box-shadow: 0 8px 15px rgba(0,0,0,0.05); }
        .subject-card h4 { color: var(--klein-blue); font-size: 1.3rem; margin-bottom: 8px; }
        .subject-card p { color: #888; font-size: 0.9rem; }

        /* --- 考生信息录入弹窗 --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; display: none;
            align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .login-card {
            background: #ffffff; padding: 34px; border-radius: 18px; width: 92%; max-width: 780px;
            box-shadow: 0 28px 70px rgba(0,0,0,0.20); animation: bounceIn 0.5s; text-align: center;
            border: 1px solid rgba(255,255,255,0.32);
            max-height: 86vh;
            overflow: auto;
        }
        .login-title { font-size: 1.75rem; color: var(--klein-blue); margin-bottom: 10px; font-weight: 950; letter-spacing: -0.2px; }
        .login-slogan { margin-bottom: 18px; font-weight: 950; color: #0b1b3a; letter-spacing: 0.8px; }
        .login-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .login-layout { display: grid; grid-template-columns: 1fr 240px; gap: 18px; align-items: start; margin-top: 6px; }
        .login-left { display: grid; gap: 14px; }
        .login-right { text-align: left; }
        .auth-aside { background: linear-gradient(135deg, rgba(0,47,167,0.07), rgba(0,47,167,0.02)); border: 1px solid rgba(0,47,167,0.14); border-radius: 18px; padding: 18px; display: grid; gap: 14px; }
        .auth-aside-head { display: flex; align-items: center; gap: 12px; }
        .auth-aside-logo { width: 52px; height: 52px; border-radius: 18px; background: var(--klein-blue); display: grid; place-items: center; box-shadow: 0 14px 32px rgba(0,47,167,0.22); flex-shrink: 0; }
        .auth-aside-logo img { width: 38px; height: 38px; object-fit: contain; display: block; }
        .auth-aside-title { font-weight: 950; color: #111827; letter-spacing: -0.2px; }
        .auth-aside-sub { color: #6b7280; font-weight: 850; font-size: 0.92rem; margin-top: 2px; }
        .auth-aside-list { display: grid; gap: 10px; }
        .auth-aside-item { display: flex; gap: 10px; align-items: flex-start; padding: 12px; border-radius: 16px; background: #ffffff; border: 1px solid rgba(17,24,39,0.08); }
        .auth-aside-icon { width: 36px; height: 36px; border-radius: 14px; background: rgba(0,47,167,0.10); color: var(--klein-blue); display: grid; place-items: center; flex-shrink: 0; }
        .auth-aside-icon svg { width: 20px; height: 20px; }
        .auth-aside-item-title { font-weight: 950; color: #111827; font-size: 0.96rem; line-height: 1.2; }
        .auth-aside-item-desc { color: #6b7280; font-weight: 800; font-size: 0.88rem; margin-top: 3px; line-height: 1.35; }
        .input-group { margin-bottom: 14px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: #666; font-weight: 600; font-size: 0.9rem; }
        .input-field {
            width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px;
            font-size: 1rem; transition: 0.3s; outline: none;
        }
        .input-field:focus { border-color: var(--klein-blue); box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.1); }

        .avatar-picker { margin-top: 16px; text-align: left; }
        .avatar-picker-title { display: block; margin-bottom: 10px; color: #666; font-weight: 600; font-size: 0.9rem; }
        .avatar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .avatar-option { width: 100%; aspect-ratio: 1; border-radius: 14px; border: 2px solid #eee; background: #ffffff; cursor: pointer; transition: 0.18s; display: grid; place-items: center; }
        .avatar-option:hover { border-color: rgba(0,47,167,0.26); background: rgba(0,47,167,0.03); transform: translateY(-1px); }
        .avatar-option.selected { border-color: var(--klein-blue); box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.10); }
        .avatar-option svg { width: 26px; height: 26px; }

        @media (max-width: 420px) {
            .avatar-grid { grid-template-columns: repeat(4, 1fr); }
        }
        @media (max-width: 520px) {
            .login-form-grid { grid-template-columns: 1fr; }
            .login-layout { grid-template-columns: 1fr; }
        }

        /* --- 知识学习 (Rich Content Styles) --- */
        .content-section { display: none; padding-bottom: 60px; animation: fadeIn 0.5s; }
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; }
        .section-title h2 { font-size: 2rem; color: var(--klein-blue); }
        
        .knowledge-content { background: var(--pure-white); padding: 50px; border-radius: 16px; border: 1px solid #eee; box-shadow: 0 5px 20px rgba(0,0,0,0.02); }
        
        .k-title-main { font-size: 1.8rem; color: var(--klein-blue); margin-bottom: 30px; border-bottom: 3px solid var(--bright-yellow); padding-bottom: 10px; display: inline-block; font-weight: 800; }
        .k-title-sub { font-size: 1.4rem; color: var(--text-dark); margin: 40px 0 20px; font-weight: 700; border-left: 5px solid var(--klein-blue); padding-left: 15px; background: linear-gradient(to right, #f4f7ff, transparent); padding-top: 5px; padding-bottom: 5px;}
        .k-strong { color: var(--klein-blue); font-weight: 700; background-color: #eef2ff; padding: 0 4px; border-radius: 4px; }
        .k-term { font-weight: 600; color: #333; }
        
        .concept-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .concept-card { background: #f9f9f9; border: 1px solid #eee; padding: 20px; border-radius: 8px; transition: 0.3s; }
        .concept-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-color: var(--klein-blue); }
        .concept-title { font-weight: 700; color: var(--klein-blue); margin-bottom: 8px; display: block; }

        .formula-box { background: var(--text-dark); color: white; padding: 20px; border-radius: 8px; margin: 20px 0; font-family: 'Consolas', monospace; font-size: 1.1rem; text-align: center; border-left: 5px solid var(--bright-yellow); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .formula-desc { font-size: 0.9rem; color: #aaa; margin-top: 5px; font-weight: normal; }

        .k-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.95rem; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .k-table th, .k-table td { border: 1px solid #eee; padding: 15px; text-align: left; }
        .k-table th { background-color: var(--klein-blue); color: white; font-weight: 600; }
        .k-table tr:nth-child(even) { background-color: #f8f9fa; }
        
        /* 5S 色块 */
        .color-badge { display: inline-block; width: 120px; padding: 5px; text-align: center; color: white; font-weight: bold; border-radius: 4px; margin-right: 10px; font-size: 0.9rem; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .bg-yellow { background-color: #FFD700; color: #333; }
        .bg-red { background-color: #dc3545; }
        .bg-blue { background-color: #007bff; }
        .bg-green { background-color: #28a745; }
        .bg-zebra { background: repeating-linear-gradient(45deg, #FFD700, #FFD700 10px, #000 10px, #000 20px); color: white; text-shadow: 0 0 3px #000; }

        /* VSM */
        .vsm-timeline { display: flex; margin: 30px 0; align-items: flex-end; }
        .vsm-step { text-align: center; flex: 1; position: relative; padding-bottom: 20px; border-bottom: 2px solid #333; }
        .vsm-step::after { content: ""; position: absolute; bottom: 0; right: 0; width: 2px; height: 10px; background: #333; }
        .vsm-step:last-child::after { display: none; }
        .vsm-top { color: var(--fail-red); font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        .vsm-btm { color: var(--success-green); font-weight: bold; margin-top: 10px; font-size: 0.9rem; position: absolute; bottom: -30px; width: 100%; left: 0; }
        .vsm-line-container { height: 60px; position: relative; margin-bottom: 40px; border-left: 2px solid #333; }

        /* --- 题库与考试 --- */
        .question-wrapper { max-width: 950px; margin: 0 auto; display: flex; gap: 20px; align-items: flex-start; }
        .question-main { flex: 1; }
        
        .q-nav-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            background: white; padding: 20px; border-radius: 12px; border: 1px solid #eee;
            width: 280px; position: sticky; top: 80px;
        }
        .q-nav-item {
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            background: var(--gray-bg); border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: var(--text-light); transition: 0.2s;
        }
        .q-nav-item:hover { background: #e0e7ff; }
        .q-nav-item.active { border: 2px solid var(--klein-blue); color: var(--klein-blue); }
        .q-nav-item.answered { background: var(--klein-blue); color: white; }

        .q-card { background: var(--pure-white); padding: 40px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.04); border: 1px solid #eee; position: relative; min-height: 400px; }
        .q-header { display: flex; justify-content: space-between; align-items: center; color: #888; font-size: 0.9rem; margin-bottom: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .q-body { font-size: 1.3rem; font-weight: 600; color: var(--text-dark); margin-bottom: 35px; line-height: 1.5; }
        
        .options-grid { display: grid; gap: 15px; }
        .option { 
            background: var(--pure-white); border: 2px solid #e0e0e0; padding: 18px 25px; border-radius: 10px; 
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; font-size: 1.05rem; 
        }
        .option:hover { border-color: var(--klein-blue); background: var(--gray-bg); transform: translateX(5px); }
        .option.selected { border-color: var(--klein-blue); background: #eef2ff; color: var(--klein-blue); font-weight: 600; }
        .option.correct { border-color: var(--success-green); background: #e7f9ee; color: #155724; }
        .option.wrong { border-color: var(--fail-red); background: #fceaea; color: #721c24; }
        
        .opt-char { 
            width: 32px; height: 32px; background: #eee; color: #666; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; margin-right: 20px; font-size: 0.9rem; font-weight: 700; flex-shrink: 0; transition: 0.2s;
        }
        .option.selected .opt-char { background: var(--klein-blue); color: white; }
        .option.correct .opt-char { background: var(--success-green); color: white; }
        .option.wrong .opt-char { background: var(--fail-red); color: white; }

        .feedback-box { margin-top: 25px; padding: 20px; background: var(--gray-bg); border-radius: 10px; border-left: 4px solid var(--klein-blue); animation: fadeIn 0.3s; display: none; }

        .bank-controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .bank-search { flex: 1; min-width: 260px; padding: 12px 14px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.2s; }
        .bank-search:focus { border-color: var(--klein-blue); box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.1); }
        .bank-select { padding: 12px 14px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.2s; background: white; }
        .bank-select:focus { border-color: var(--klein-blue); box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.1); }
        .bank-toggle { display: inline-flex; align-items: center; gap: 8px; font-weight: 800; color: #374151; user-select: none; }
        .bank-toggle input { width: 18px; height: 18px; }
        .bank-meta { margin-top: 12px; color: #6b7280; font-weight: 800; }
        .bank-list { margin-top: 14px; display: grid; gap: 12px; }
        .bank-item { border: 1px solid rgba(17,24,39,0.10); border-radius: 14px; padding: 14px 16px; background: #ffffff; }
        .bank-item-head { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 8px; }
        .bank-badges { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .bank-badge { display: inline-flex; align-items: center; padding: 6px 10px; border-radius: 999px; font-weight: 950; font-size: 0.82rem; letter-spacing: 0.3px; }
        .bank-badge.type { background: rgba(0,47,167,0.10); color: var(--klein-blue); }
        .bank-badge.no { background: rgba(17,24,39,0.06); color: #111827; }
        .bank-q { font-weight: 950; color: #111827; line-height: 1.65; font-size: 1.05rem; }
        .bank-a { margin-top: 10px; font-weight: 900; color: #155724; background: #e7f9ee; border: 1px solid rgba(40,167,69,0.22); padding: 10px 12px; border-radius: 12px; }
        .bank-expl { margin-top: 10px; color: #374151; font-weight: 700; line-height: 1.7; background: #f8fafc; border: 1px solid rgba(17,24,39,0.10); padding: 10px 12px; border-radius: 12px; }

        .talent-tabs { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
        .talent-controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .talent-search { flex: 1; min-width: 260px; padding: 12px 14px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.2s; }
        .talent-search:focus { border-color: var(--klein-blue); box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.1); }
        .talent-select { padding: 12px 14px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.2s; background: white; }
        .talent-select:focus { border-color: var(--klein-blue); box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.1); }
        .talent-meta { margin-top: 12px; color: #6b7280; font-weight: 800; }
        .talent-grid { margin-top: 14px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        @media (max-width: 980px) {
            .talent-grid { grid-template-columns: 1fr; }
        }
        .talent-card { border: 1px solid rgba(17,24,39,0.10); border-radius: 14px; padding: 14px 16px; background: #ffffff; display: grid; gap: 8px; }
        .talent-head { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .talent-name { font-weight: 950; color: #111827; letter-spacing: 0.2px; }
        .talent-dept { color: #4b5563; font-weight: 800; }
        .talent-tags { display: flex; gap: 8px; flex-wrap: wrap; }
        .talent-tag { display: inline-flex; align-items: center; padding: 6px 10px; border-radius: 999px; font-weight: 950; font-size: 0.82rem; letter-spacing: 0.3px; }
        .talent-tag.green { background: rgba(40,167,69,0.14); color: #155724; }
        .talent-tag.black { background: rgba(17,24,39,0.10); color: #111827; }
        .talent-tag.badge { background: rgba(255,215,0,0.34); color: #7a5b00; }

        .badge-award { position: relative; overflow: hidden; padding-top: 56px; }
        .badge-award::before {
            content: "";
            position: absolute;
            inset: -2px;
            background: conic-gradient(from 120deg, rgba(255,215,0,0.20), rgba(0,47,167,0.18), rgba(255,215,0,0.32));
            opacity: 0.55;
            filter: blur(10px);
            animation: badgeGlow 3.6s ease-in-out infinite;
        }
        .badge-award::after {
            content: "";
            position: absolute;
            top: -60%;
            left: -40%;
            width: 60%;
            height: 220%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.55), transparent);
            transform: rotate(18deg);
            animation: badgeShine 2.8s ease-in-out infinite;
        }
        .badge-award > * { position: relative; z-index: 1; }
        .badge-award { box-shadow: 0 12px 34px rgba(17,24,39,0.08); transform: translateZ(0); }
        .badge-award:hover { transform: translateY(-2px); box-shadow: 0 18px 46px rgba(17,24,39,0.12); }

        .badge-ribbon {
            position: absolute;
            right: 12px;
            top: 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 7px 10px;
            border-radius: 999px;
            background: rgba(255,215,0,0.34);
            color: #7a5b00;
            font-weight: 950;
            letter-spacing: 0.3px;
            border: 1px solid rgba(122,91,0,0.18);
        }
        .badge-award .talent-head { padding-right: 132px; }
        @media (max-width: 420px) {
            .badge-award { padding-top: 62px; }
            .badge-award .talent-head { padding-right: 0; }
            .badge-ribbon { right: 10px; top: 10px; }
        }
        .badge-medal {
            width: 18px;
            height: 18px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, #fff2a8, #ffd700 55%, #caa000);
            box-shadow: 0 0 0 3px rgba(255,215,0,0.26);
            animation: badgePulse 1.9s ease-in-out infinite;
        }

        @keyframes badgeGlow {
            0%, 100% { transform: scale(1); opacity: 0.45; }
            50% { transform: scale(1.04); opacity: 0.72; }
        }
        @keyframes badgeShine {
            0%, 100% { transform: translateX(-120%) rotate(18deg); opacity: 0.0; }
            35% { opacity: 0.18; }
            55% { opacity: 0.0; }
            70% { transform: translateX(260%) rotate(18deg); opacity: 0.0; }
        }
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        
        /* --- 结果页 --- */
        #result-section { text-align: center; display: none; padding-top: 50px; flex: 1; }
        .result-icon-container { height: 180px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; position: relative; }
        
        .trophy-anim { font-size: 8rem; animation: bounceIn 1s cubic-bezier(0.68, -0.55, 0.265, 1.55); display: none; }
        .fail-anim { font-size: 8rem; animation: shake 0.5s ease-in-out; display: none; filter: grayscale(1); opacity: 0.7; }

        .score-display { font-size: 5rem; font-weight: 900; color: var(--klein-blue); margin-bottom: 10px; line-height: 1; }
        .score-label { font-size: 1.2rem; color: #888; text-transform: uppercase; letter-spacing: 2px; }
        .result-msg { font-size: 1.5rem; margin: 20px 0 40px; font-weight: 600; }
        .user-info-display { font-size: 1.2rem; color: #555; background: #f0f0f0; padding: 10px 20px; border-radius: 20px; display: inline-block; margin-bottom: 20px; border: 1px solid #ddd; }

        .exam-report { margin-top: 18px; text-align: left; background: #f8fafc; border: 1px solid rgba(17,24,39,0.10); border-radius: 16px; padding: 16px; }
        .report-head { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 10px; }
        .report-title { font-weight: 950; color: #111827; letter-spacing: 0.2px; }
        .report-summary { color: #4b5563; font-weight: 750; margin-bottom: 10px; }
        .report-list { display: grid; gap: 12px; }
        .report-item { background: #ffffff; border: 1px solid rgba(17,24,39,0.10); border-radius: 14px; padding: 12px 14px; }
        .report-q { font-weight: 900; color: #111827; line-height: 1.55; }
        .report-qno { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 8px; background: rgba(0,47,167,0.10); color: var(--klein-blue); margin-right: 8px; font-weight: 950; }
        .report-rows { margin-top: 10px; display: grid; gap: 6px; }
        .report-row { color: #374151; font-weight: 750; }
        .report-row .label { color: #6b7280; font-weight: 850; margin-right: 8px; }
        .report-row .bad { color: var(--fail-red); }
        .report-row .good { color: var(--success-green); }
        .report-expl { margin-top: 10px; color: #4b5563; font-size: 0.95rem; line-height: 1.6; border-top: 1px dashed rgba(17,24,39,0.16); padding-top: 10px; }

        .confetti { position: absolute; width: 10px; height: 10px; background-color: var(--bright-yellow); animation: fall linear forwards; opacity: 0; }

        /* 动画 */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 0% { transform: scale(0); opacity: 0; } 60% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-10px); } 40%, 80% { transform: translateX(10px); } }
        @keyframes fall { 0% { top: -10%; transform: rotate(0deg) translateX(0); opacity: 1; } 100% { top: 100%; transform: rotate(360deg) translateX(50px); opacity: 0; } }

        .toolbar { display: flex; justify-content: space-between; margin-top: 30px; align-items: center; }
        #timer-box { font-family: monospace; font-size: 1.5rem; font-weight: bold; background: var(--klein-blue); color: white; padding: 8px 20px; border-radius: 6px; display: none; box-shadow: 0 4px 10px rgba(0,47,167,0.3); }

        footer { margin-top: auto; }
        .site-footer { border-top: 1px solid rgba(17,24,39,0.10); background: #ffffff; }
        .footer-inner { max-width: 1440px; margin: 0 auto; padding: 42px 20px; }
        .footer-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 28px; align-items: start; }
        .footer-brand { display: grid; gap: 10px; }
        .footer-brand-title { font-weight: 950; color: #111827; letter-spacing: 0.2px; font-size: 1.05rem; }
        .footer-brand-sub { color: #4b5563; font-weight: 700; }
        .footer-slogan { margin-top: 6px; color: #0b1b3a; font-weight: 950; letter-spacing: 1px; }
        .footer-meta { margin-top: 10px; color: #6b7280; font-size: 0.95rem; }
        .footer-links { display: grid; gap: 10px; justify-items: end; }
        .footer-link-row { display: flex; gap: 14px; flex-wrap: wrap; justify-content: end; }
        .footer-link { cursor: pointer; color: #374151; font-weight: 800; text-decoration: none; padding: 8px 10px; border-radius: 10px; border: 1px solid transparent; }
        .footer-link:hover { color: var(--klein-blue); background: rgba(0,47,167,0.04); border-color: rgba(0,47,167,0.14); }
        .footer-sign { color: #9aa3b2; font-size: 0.9rem; text-align: right; }

        .footer-badge { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 14px; background: var(--klein-blue); color: #ffffff; font-weight: 950; letter-spacing: 0.6px; width: fit-content; font-size: 1.08rem; }
        .footer-badge img { width: 26px; height: 26px; object-fit: contain; display: block; }
        #footer-home { max-width: none; padding: 0; }
        #footer-home .footer-badge { width: 100%; justify-content: center; border-radius: 0; padding: 56px 20px; font-size: 1.6rem; letter-spacing: 1.2px; }
        #footer-home .footer-badge { gap: 18px; }
        #footer-home .footer-badge img { width: 92px; height: 92px; }

        

        @media (max-width: 900px) {
            .question-wrapper { flex-direction: column-reverse; }
            .q-nav-grid { width: 100%; position: static; grid-template-columns: repeat(10, 1fr); }
            .footer-grid { grid-template-columns: 1fr; }
            .footer-links { justify-items: start; }
            .footer-link-row { justify-content: start; }
            .footer-sign { text-align: left; }
        }
    </style>
</head>
<body>
    <div class="top-accent"></div>

    <div id="login-modal" class="modal-overlay">
        <div class="login-card">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
                <h2 class="login-title" id="auth-title" style="margin:0;">登录</h2>
                <div style="display:flex; gap:8px;">
                    <button class="btn btn-outline" id="auth-tab-login" onclick="setAuthView('login')" style="padding:8px 14px;">登录</button>
                    <button class="btn btn-outline" id="auth-tab-register" onclick="setAuthView('register')" style="padding:8px 14px;">注册</button>
                </div>
            </div>
            <div class="login-slogan">让AI更有温度 让制作更有速度</div>
            <div class="login-layout">
                <div class="login-left">
                    <div class="login-form-grid">
                        <div class="input-group" style="margin-bottom:0;">
                            <label>姓名</label>
                            <input type="text" id="user-name" class="input-field" placeholder="例如：陈云">
                        </div>
                        <div class="input-group" style="margin-bottom:0;">
                            <label>工号（7位数字）</label>
                            <input type="text" id="user-id" class="input-field" placeholder="例如：2508179" inputmode="numeric" maxlength="7">
                        </div>
                    </div>
                    <div id="auth-example" style="color:#6b7280; font-weight:800; font-size:0.9rem; text-align:left; margin-top: 4px;">
                        示例填写：姓名 陈云｜工号 2508179
                    </div>
                    <div style="display:grid; gap:10px;">
                        <button class="btn btn-primary" id="auth-primary-btn" onclick="submitAuth()" style="width:100%;">登录</button>
                        <button class="btn btn-outline" onclick="guestLogin()" style="width:100%;">员工登录</button>
                    </div>
                    <div id="auth-hint" style="color:#6b7280; font-weight:800; font-size:0.9rem; text-align:left;"></div>
                </div>
                <div class="login-right">
                    <div class="avatar-picker" id="avatar-picker" style="margin-top:0;">
                        <label class="avatar-picker-title">选择头像</label>
                        <div id="avatar-grid" class="avatar-grid"></div>
                    </div>
                    <div class="auth-aside" id="auth-aside" style="margin-top:0;">
                        <div class="auth-aside-head">
                            <div class="auth-aside-logo">
                                <img src="企业logo白字透明底.png" alt="企业Logo">
                            </div>
                            <div>
                                <div class="auth-aside-title">登录后可用</div>
                                <div class="auth-aside-sub">成绩 / 错题 / 笔记 自动同步</div>
                            </div>
                        </div>
                        <div class="auth-aside-list">
                            <div class="auth-aside-item">
                                <div class="auth-aside-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M7 20h10" />
                                        <path d="M9 16h6" />
                                        <path d="M8 4h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="auth-aside-item-title">成绩记录</div>
                                    <div class="auth-aside-item-desc">自动保存历次考试成绩与最佳分</div>
                                </div>
                            </div>
                            <div class="auth-aside-item">
                                <div class="auth-aside-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M7 4h10a2 2 0 0 1 2 2v14" />
                                        <path d="M5 6a2 2 0 0 1 2-2v16a2 2 0 0 0-2-2h12" />
                                        <path d="M9 10h6" />
                                        <path d="M9 14h5" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="auth-aside-item-title">错题本</div>
                                    <div class="auth-aside-item-desc">练习/考试错题自动收集，可一键删除已掌握</div>
                                </div>
                            </div>
                            <div class="auth-aside-item">
                                <div class="auth-aside-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 19V6a2 2 0 0 1 2-2h9a3 3 0 0 1 3 3v12" />
                                        <path d="M6 18h11" />
                                        <path d="M8 8h7" />
                                        <path d="M8 11h7" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="auth-aside-item-title">笔记本</div>
                                    <div class="auth-aside-item-desc">沉淀学习要点与复盘总结，下次登录继续看</div>
                                </div>
                            </div>
                            <div class="auth-aside-item">
                                <div class="auth-aside-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 2a7 7 0 0 0-7 7c0 2.4 1.2 4.5 3 5.8V22l4-2 4 2v-7.2c1.8-1.3 3-3.4 3-5.8a7 7 0 0 0-7-7z" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="auth-aside-item-title">带级徽章</div>
                                    <div class="auth-aside-item-desc">通过考试后点亮徽章与认证信息展示</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <nav>
            <div class="brand" onclick="goHome()">
                <div class="brand-mark">
                    <img src="企业logo白字透明底.png" alt="企业Logo">
                </div>
                <div class="logo">LEAN ACADEMY</div>
            </div>
            <div class="nav-right">
                <div class="nav-links">
                    <span class="nav-item active" onclick="goHome()">学习中心</span>
                    <span class="nav-item" onclick="openProfile()">个人中心</span>
                </div>
                <div id="user-chip" class="user-chip" onclick="openProfile()">
                    <div class="user-avatar" id="user-avatar">A</div>
                    <div style="display:grid; line-height:1.1;">
                        <div class="user-name" id="nav-user-name">未登录</div>
                        <div class="user-meta" id="nav-user-id"></div>
                    </div>
                </div>
            </div>
        </nav>

        <section id="hero-page" class="cover-section">
            <div class="cover-inner">
                <h1 class="hero-title">哈尔斯带级认证学习系统</h1>
                <p class="hero-subtitle">面向全员的精益知识体系与认证平台</p>
                <div class="hero-slogan">2026 精益革新办</div>

                <div class="mode-grid">
                    <div class="mode-card" onclick="selectMode('study')">
                        <div class="mode-arrow">&gt;</div>
                        <span class="mode-num">01</span>
                        <div class="mode-icon study" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 19c-3-2-6-2-9-1V5c3-1 6-1 9 1" />
                                <path d="M12 19c3-2 6-2 9-1V5c-3-1-6-1-9 1" />
                                <path d="M12 6v13" />
                            </svg>
                        </div>
                        <div class="mode-title">深度学习</div>
                        <div class="mode-caption">Deep Learning</div>
                        <div class="mode-desc">按模块归纳成清晰条目：定义、方法、易错点与典型场景，一眼能学会，一页能复习。</div>
                    </div>
                    <div class="mode-card" onclick="selectMode('practice')">
                        <div class="mode-arrow">&gt;</div>
                        <span class="mode-num">02</span>
                        <div class="mode-icon practice" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M13.1 2 3 14h7.1L9 22l12-14h-7.2L13.1 2Z" />
                            </svg>
                        </div>
                        <div class="mode-title">强化训练</div>
                        <div class="mode-caption">Practice</div>
                        <div class="mode-desc">高质量干扰项贴近现场场景，做题同时学“为什么错”，提升辨析与应用能力。</div>
                    </div>
                    <div class="mode-card" onclick="selectMode('bank')">
                        <div class="mode-arrow">&gt;</div>
                        <span class="mode-num">03</span>
                        <div class="mode-icon study" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19V6a2 2 0 0 1 2-2h9a3 3 0 0 1 3 3v12" />
                                <path d="M6 18h11" />
                                <path d="M8 8h7" />
                                <path d="M8 11h7" />
                                <path d="M8 14h5" />
                            </svg>
                        </div>
                        <div class="mode-title">题库解析</div>
                        <div class="mode-caption">Question Bank</div>
                        <div class="mode-desc">把题目、标准答案与解析集中整理，支持搜索与筛选，便于出题、复盘与复习。</div>
                    </div>
                    <div class="mode-card talent" onclick="openTalentShowcase()">
                        <div class="mode-arrow">&gt;</div>
                        <span class="mode-num">04</span>
                        <div class="mode-icon practice" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </div>
                        <div class="mode-title">带级人才</div>
                        <div class="mode-caption">Certified Talents</div>
                        <div class="mode-desc">展示已认证带级人才名单，并对认证三科以上人员展示绿带徽章。</div>
                    </div>
                    <div class="mode-card mode-exam" onclick="selectMode('exam')">
                        <div class="mode-arrow">&gt;</div>
                        <span class="mode-num">05</span>
                        <div class="mode-icon exam" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="6" y="3" width="12" height="14" rx="2" />
                                <path d="M9 7h6" />
                                <path d="M9 10h6" />
                                <path d="M12 13h3" />
                                <path d="M10 21v-3l2-1 2 1v3l-2-1-2 1Z" />
                            </svg>
                        </div>
                        <div class="mode-title">资格认证</div>
                        <div class="mode-caption">Certification</div>
                        <div class="mode-desc">标准化考试流程：20题 / 90分及格，倒计时与自动评分，输出可追溯的认证结果。</div>
                    </div>
                </div>
                <div id="memo-modules" style="margin-top: 18px;"></div>
            </div>
        </section>

        <section id="subject-page" class="content-section">
            <div class="section-header">
                <div class="section-title">
                    <h2 id="mode-title">选择科目</h2>
                    <p style="color:#666; margin-top:5px;">当前模式：<span id="current-mode-display" style="color:var(--klein-blue); font-weight:bold;"></span></p>
                </div>
                <button class="btn btn-outline" onclick="goHome()">返回首页</button>
            </div>
            <div class="subject-grid">
                <div class="subject-card" onclick="startActivity('DM')">
                    <h4>DM 日常管理</h4>
                    <p>班前会、4M变化点、SQDC、Andon</p>
                </div>
                <div class="subject-card" onclick="startActivity('PSP')">
                    <h4>PSP 问题解决</h4>
                    <p>5W2H、5Why、鱼骨图、PDCA</p>
                </div>
                <div class="subject-card" onclick="startActivity('SW')">
                    <h4>SW 标准作业</h4>
                    <p>TT/CT计算、线平衡、标准三票</p>
                </div>
                <div class="subject-card" onclick="startActivity('VSM')">
                    <h4>VSM 价值流</h4>
                    <p>增值比、Lead Time、未来态规划</p>
                </div>
                <div class="subject-card" onclick="startActivity('5S')">
                    <h4>5S & 目视化</h4>
                    <p>红牌作战、三定、颜色标准(VCS)</p>
                </div>
                <div class="subject-card" onclick="startActivity('TIMWOODS')">
                    <h4>TIMWOODS 八大浪费</h4>
                    <p>八大浪费识别、ECRS改善四原则</p>
                </div>
            </div>
        </section>

        <section id="study-page" class="content-section">
            <div class="section-header">
                <div class="section-title">
                    <h2 id="study-subject-title">科目名称</h2>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="backToSubject()">返回目录</button>
                    <button class="btn btn-primary" onclick="quickPractice()">去练习本章</button>
                </div>
            </div>
            <div id="study-content" class="knowledge-content">
                </div>
        </section>

        <section id="bank-page" class="content-section">
            <div class="section-header">
                <div class="section-title">
                    <h2 id="bank-subject-title">题库解析</h2>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="backToSubject()">返回目录</button>
                    <button class="btn btn-outline" onclick="goHome()">返回首页</button>
                </div>
            </div>
            <div class="knowledge-content" style="padding: 26px;">
                <div class="bank-controls">
                    <input id="bank-search" class="bank-search" placeholder="搜索：题目 / 答案 / 解析关键词" />
                    <select id="bank-type-filter" class="bank-select">
                        <option value="ALL">全部题型</option>
                        <option value="MCQ">选择题</option>
                        <option value="TF">判断题</option>
                    </select>
                    <label class="bank-toggle">
                        <input id="bank-show-answer" type="checkbox" checked />
                        显示答案与解析
                    </label>
                </div>
                <div class="bank-meta" id="bank-meta"></div>
                <div class="bank-list" id="bank-list"></div>
                <div style="display:flex; justify-content:center; margin-top: 18px;">
                    <button class="btn btn-outline" id="bank-load-more" onclick="bankLoadMore()">加载更多</button>
                </div>
            </div>
        </section>

        <section id="talent-page" class="content-section">
            <div class="section-header">
                <div class="section-title">
                    <h2>带级人才展示</h2>
                    <p style="color:#666; margin-top:5px;">已认证带级人才名单与年度绿带徽章获得者</p>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="goHome()">返回首页</button>
                </div>
            </div>
            <div class="knowledge-content" style="padding: 26px;">
                <div class="talent-tabs">
                    <button class="btn btn-outline" id="tab-talent-list" onclick="switchTalentTab('list')">人才名单</button>
                    <button class="btn btn-outline" id="tab-talent-badges" onclick="switchTalentTab('badges')">绿带徽章获得者</button>
                </div>

                <div id="talent-panel-list">
                    <div class="talent-controls">
                        <input id="talent-search" class="talent-search" placeholder="搜索姓名 / 部门 / 带级" />
                        <select id="talent-dept" class="talent-select"></select>
                        <select id="talent-belt" class="talent-select"></select>
                    </div>
                    <div class="talent-meta" id="talent-meta"></div>
                    <div class="talent-grid" id="talent-grid"></div>
                </div>

                <div id="talent-panel-badges" style="display:none;">
                    <div class="talent-meta" id="badge-meta"></div>
                    <div class="talent-grid" id="badge-grid"></div>
                </div>
            </div>
        </section>

        <section id="profile-page" class="content-section">
            <div class="section-header">
                <div class="section-title">
                    <h2>个人中心</h2>
                    <p style="color:#666; margin-top:5px;">个人信息、认证情况与成绩记录</p>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="goHome()">返回首页</button>
                    <button class="btn btn-outline" onclick="deleteAccount()" style="border-color:#dc3545; color:#dc3545;">账号注销</button>
                    <button class="btn btn-outline" onclick="logout()">退出登录</button>
                </div>
            </div>
            <div class="knowledge-content" style="padding: 26px;">
                <div id="profile-summary" class="talent-card" style="margin-bottom: 14px;"></div>
                <div style="display:grid; gap: 12px;">
                    <div class="talent-card">
                        <div class="talent-name">我的成绩</div>
                        <div class="talent-dept" id="profile-exam-meta"></div>
                        <div id="profile-exam-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="memo-page" class="content-section">
            <div class="section-header">
                <div class="section-title">
                    <h2>错题本 & 笔记本</h2>
                    <p style="color:#666; margin-top:5px;">记录错题与个人笔记（登录后可跨设备保存）</p>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="goHome()">返回首页</button>
                </div>
            </div>
            <div class="knowledge-content" style="padding: 26px;">
                <div class="talent-tabs">
                    <button class="btn btn-outline" id="tab-memo-wrong" onclick="switchMemoTab('wrong')">错题本</button>
                    <button class="btn btn-outline" id="tab-memo-notes" onclick="switchMemoTab('notes')">笔记本</button>
                </div>

                <div id="memo-guest-tip" class="talent-card" style="display:none; margin-top: 12px;">
                    <div class="talent-name">提示</div>
                    <div class="talent-dept" style="margin-top: 6px;">当前为员工模式（本机保存）：错题本与笔记本将保存在当前浏览器，不跨设备同步。登录/注册后可自动同步到数据库。</div>
                    <div style="margin-top: 12px;">
                        <button class="btn btn-primary" onclick="openLoginModal(openMemoCenter)">去登录/注册</button>
                    </div>
                </div>

                <div id="memo-panel-wrong" style="margin-top: 12px;">
                    <div style="display:flex; gap:10px; flex-wrap: wrap; align-items:center;">
                        <input id="wrong-search" class="bank-search" placeholder="搜索：题目关键词 / 科目" style="max-width: 360px;" />
                        <select id="wrong-subject" class="bank-select" style="max-width: 220px;">
                            <option value="ALL">全部科目</option>
                            <option value="DM">DM</option>
                            <option value="PSP">PSP</option>
                            <option value="SW">SW</option>
                            <option value="VSM">VSM</option>
                            <option value="5S">5S</option>
                            <option value="TIMWOODS">TIMWOODS</option>
                        </select>
                        <button class="btn btn-outline" onclick="loadWrongBook()">刷新</button>
                    </div>
                    <div class="talent-meta" id="wrong-meta"></div>
                    <div id="wrong-list" style="display:grid; gap: 12px; margin-top: 12px;"></div>
                </div>

                <div id="memo-panel-notes" style="display:none; margin-top: 12px;">
                    <div class="talent-card" style="margin-bottom: 12px;">
                        <div class="talent-name" id="note-form-title">新建笔记</div>
                        <div style="display:grid; gap:10px; margin-top: 10px;">
                            <input id="note-title" class="input-field" placeholder="标题（例如：5Why 的常见误区）" />
                            <textarea id="note-content" class="input-field" placeholder="记录你的精益知识、现场观察、复盘要点..." style="min-height: 140px; resize: vertical;"></textarea>
                            <div style="display:flex; gap:10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" id="note-save-btn" onclick="saveNote()">保存</button>
                                <button class="btn btn-outline" id="note-cancel-btn" onclick="resetNoteForm()" style="display:none;">取消编辑</button>
                            </div>
                        </div>
                    </div>
                    <div class="talent-meta" id="note-meta"></div>
                    <div id="note-list" style="display:grid; gap: 12px; margin-top: 12px;"></div>
                </div>
            </div>
        </section>

        <section id="quiz-page" class="content-section">
            <div class="question-wrapper">
                <div class="question-main">
                    <div class="q-card">
                        <div class="q-header">
                            <span id="quiz-progress">QUESTION 1 / 20</span>
                            <span id="quiz-mode-badge" class="section-tag">练习模式</span>
                            <span id="timer-box">20:00</span>
                        </div>
                        <div class="q-body" id="question-text">
                            题目加载中...
                        </div>
                        <div class="options-grid" id="options-container">
                            </div>
                        <div class="feedback-box" id="feedback-container"></div>
                    </div>

                    <div class="toolbar">
                        <button class="btn btn-outline" onclick="prevQuestion()" id="prev-btn">上一题</button>
                        <div>
                            <button class="btn btn-ghost" onclick="quitQuiz()" style="margin-right:10px;">退出</button>
                            <button class="btn btn-outline" id="skip-btn" onclick="nextPracticeQuestion()" style="display:none; margin-right:10px; border-color:#ccc; color:#666;">跳过此题</button>
                            <button class="btn btn-primary" id="action-btn" onclick="handleAction()">下一题</button>
                        </div>
                    </div>
                </div>
                
                <div class="q-nav-grid" id="q-nav-grid" style="display:none;">
                    </div>
            </div>
        </section>

        <section id="result-page" class="content-section">
            <div class="result-overlay">
                <div class="result-icon-container">
                    <div class="trophy-anim">🏆</div>
                    <div class="fail-anim">💪</div>
                </div>
                <div class="score-label">FINAL SCORE</div>
                <div class="score-display"><span id="final-score">0</span><span style="font-size:2rem; color:#999;">/100</span></div>
                
                <div class="user-info-display">
                    考生：<span id="res-name"></span> (工号: <span id="res-id"></span>)
                </div>

                <div class="result-msg" id="result-message"></div>

                <div class="exam-report" id="exam-report" style="display:none;">
                    <div class="report-head">
                        <div class="report-title">错题报告</div>
                        <button class="btn btn-outline" id="toggle-report-btn" onclick="toggleExamReport()">收起</button>
                    </div>
                    <div class="report-summary" id="report-summary"></div>
                    <div class="report-list" id="report-list"></div>
                </div>
                
                <div style="display:flex; justify-content:center; gap:20px;">
                    <button class="btn btn-outline" onclick="goHome()">返回首页</button>
                    <button class="btn btn-primary" onclick="retryExam()">再考一次</button>
                </div>
            </div>
        </section>

        <footer class="site-footer" id="site-footer">
            <div class="footer-inner" id="footer-home">
                <div class="footer-badge"><img src="企业logo白字透明底.png" alt="企业Logo">© 2026 哈尔斯集团精益革新办</div>
            </div>
            <div class="footer-inner" id="footer-simple" style="display:none; padding: 22px 20px;">
                <div style="display:flex; justify-content: space-between; align-items:center; gap: 14px; flex-wrap: wrap;">
                    <div style="font-weight:950; color:#111827;">哈尔斯带级认证学习系统</div>
                    <div style="color:#9aa3b2; font-size:0.95rem;">2026 哈尔斯集团精益革新办</div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const API_BASE_URL = (
            (typeof window !== 'undefined' && window.__API_BASE_URL__) ||
            new URLSearchParams(location.search).get('api') ||
            'https://haers-certification-api.gaolujie26.workers.dev'
        ).replace(/\/$/, '');

        // ================= API 调用函数 =================
        async function apiLogin(employeeId, name) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ employeeId, name })
                });
                const data = await response.json();
                if (data && data.success) return { ok: true, user: data.user, error: null };
                return { ok: false, user: null, error: (data && data.error) || '登录失败' };
            } catch (error) {
                console.error('登录请求失败:', error);
                return { ok: false, user: null, error: '登录请求失败' };
            }
        }

        async function apiRegister(employeeId, name, avatar) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ employeeId, name, avatar })
                });
                const data = await response.json();
                if (data && data.success) return { ok: true, user: data.user, error: null };
                return { ok: false, user: null, error: (data && data.error) || '注册失败' };
            } catch (error) {
                console.error('注册请求失败:', error);
                return { ok: false, user: null, error: '注册请求失败' };
            }
        }

        async function apiDeleteAccount(payload) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/delete-account`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload || {})
                });
                const data = await response.json();
                return { ok: response.ok, data };
            } catch (error) {
                return { ok: false, data: { error: String(error && error.message ? error.message : error) } };
            }
        }

        async function apiGetWrongQuestions(userId, employeeId, subject) {
            try {
                const qs = new URLSearchParams({ userId: String(userId), employeeId: String(employeeId) });
                if (subject && subject !== 'ALL') qs.set('subject', subject);
                const response = await fetch(`${API_BASE_URL}/api/wrong-questions?${qs.toString()}`);
                const data = await response.json();
                return data.success ? data.items : [];
            } catch {
                return [];
            }
        }

        async function apiUpsertWrongQuestion(payload) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/wrong-questions/upsert`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload || {})
                });
                const data = await response.json();
                return { ok: response.ok, data };
            } catch (error) {
                return { ok: false, data: { error: String(error && error.message ? error.message : error) } };
            }
        }

        async function apiDeleteWrongQuestion(payload) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/wrong-questions/delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload || {})
                });
                const data = await response.json();
                return { ok: response.ok, data };
            } catch (error) {
                return { ok: false, data: { error: String(error && error.message ? error.message : error) } };
            }
        }

        async function apiGetNotes(userId, employeeId) {
            try {
                const qs = new URLSearchParams({ userId: String(userId), employeeId: String(employeeId) });
                const response = await fetch(`${API_BASE_URL}/api/notes?${qs.toString()}`);
                const data = await response.json();
                return data.success ? data.items : [];
            } catch {
                return [];
            }
        }

        async function apiUpsertNote(payload) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/notes/upsert`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload || {})
                });
                const data = await response.json();
                return { ok: response.ok, data };
            } catch (error) {
                return { ok: false, data: { error: String(error && error.message ? error.message : error) } };
            }
        }

        async function apiDeleteNote(payload) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/notes/delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload || {})
                });
                const data = await response.json();
                return { ok: response.ok, data };
            } catch (error) {
                return { ok: false, data: { error: String(error && error.message ? error.message : error) } };
            }
        }

        async function apiSaveExam(examData) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/save-exam`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(examData)
                });
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('保存成绩失败:', error);
                return null;
            }
        }

        async function apiGetUserExams(userId, employeeId) {
            try {
                const qs = new URLSearchParams({ userId: String(userId), employeeId: String(employeeId) });
                const response = await fetch(`${API_BASE_URL}/api/user-exams?${qs.toString()}`);
                const data = await response.json();
                return data.success ? data.records : [];
            } catch (error) {
                console.error('获取考试记录失败:', error);
                return [];
            }
        }

        // ================= 数据中心 (Data Center) =================
        const KNOWLEDGE_BASE = {
            "DM": {
                "title": "DM - 日常管理 (Daily Management)",
                "content": `
                    <div class="k-title-main">日常管理：精益的底盘</div>
                    <p>日常管理 (Daily Management) 的核心目的是<strong>维持现状</strong>并<strong>稳定绩效</strong>。如果说方针管理 (Hoshin Kanri) 是为了实现突破性目标，那么日常管理就是为了防止退步。没有稳固的日常管理，改善成果无法保持。</p>

                    <div class="k-title-sub">1. SQDC 绩效看板</div>
                    <p>SQDC 是现场管理的“仪表盘”，代表了企业经营的平衡记分卡。管理者应遵循<span class="k-strong">“3秒法则”</span>：3秒内通过颜色（红/绿）判断状态。</p>
                    <table class="k-table">
                        <tr><th>维度</th><th>全称 (中文)</th><th>关注指标示例</th></tr>
                        <tr><td><strong>S</strong></td><td>Safety (安全)</td><td>无灾害天数、未遂事故件数 (Near Miss)</td></tr>
                        <tr><td><strong>Q</strong></td><td>Quality (质量)</td><td>直通率 (FPY)、客诉 (Customer Complaints)</td></tr>
                        <tr><td><strong>D</strong></td><td>Delivery (交付)</td><td>计划达成率、UPPH (人均时产)</td></tr>
                        <tr><td><strong>C</strong></td><td>Cost (成本)</td><td>废品金额、加班工时 (Overtime)</td></tr>
                    </table>

                    <div class="k-title-sub">2. 班前会 (Asakai / Pre-shift Meeting)</div>
                    <p>不是点名会，而是“作战部署会”。核心在于<strong>对齐 (Alignment)</strong>。</p>
                    <div class="concept-grid">
                        <div class="concept-card">
                            <span class="concept-title">⏱️ 标准时长</span>
                            5-10 分钟，必须<strong>站立 (Stand-up)</strong> 进行，以保持紧迫感。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">📋 议程重点</span>
                            1. 人员确认 (Man)<br>2. 安全宣贯 (Safety/KYT)<br>3. 昨日回顾 (SQDC红绿)<br>4. 今日目标 (Target)
                        </div>
                    </div>

                    <div class="k-title-sub">3. 4M 变化点管理</div>
                    <p>生产不稳定的最大来源是 4M 的变化。只要 4M 发生变化，必须执行<strong>初物管理 (First Piece Inspection)</strong>。</p>
                    <ul>
                        <li><span class="k-term">Man (人)</span>：新员工、顶岗、情绪波动。</li>
                        <li><span class="k-term">Machine (机)</span>：设备维修后、刀具更换、新设备。</li>
                        <li><span class="k-term">Material (料)</span>：供应商变更、批次变更、代用料。</li>
                        <li><span class="k-term">Method (法)</span>：工艺参数调整、SOP 变更。</li>
                    </ul>

                    <div class="k-title-sub">4. 异常响应闭环 (Andon System)</div>
                    <p>遵循“三现主义”：<strong>现场 (Genba)、现物 (Genbutsu)、现实 (Genjitsu)</strong>。</p>
                    <p>流程：发现异常 → 停止生产 (Stop) → 呼叫班长 (Call) → 等待/处理 (Wait)。<br>原则：<strong>不接受、不制造、不流出不良</strong>。</p>

                    <div class="k-title-sub">5. 案例：SQDC 红灯如何当天闭环</div>
                    <p><span class="k-strong">场景</span>：当班直通率 (FPY) 低于目标，看板出现 <span class="k-strong">Q 红灯</span>。</p>
                    <table class="k-table">
                        <tr><th>步骤</th><th>现场动作</th><th>输出物</th></tr>
                        <tr><td>1. 立即止血</td><td>围堵可疑批次，确认流出范围；必要时停线。</td><td>隔离清单/范围确认</td></tr>
                        <tr><td>2. 快速定位</td><td>用 5W2H 描述缺陷：发生在哪道工序/哪个班次/多少件。</td><td>问题描述表</td></tr>
                        <tr><td>3. 临时对策</td><td>在不扩散风险前提下恢复生产（加严检验/工装调整/换人等）。</td><td>临时对策 + 验证方式</td></tr>
                        <tr><td>4. 根因与固化</td><td>5Why/鱼骨验证真因；有效做法写进 SOP/点检/看板。</td><td>标准更新记录</td></tr>
                    </table>

                    <div class="k-title-sub">6. 班前会 5 分钟脚本（可直接照做）</div>
                    <ul>
                        <li><span class="k-strong">30秒</span>：确认人机料法变化点（新员工/换刀/代用料/参数调整）。</li>
                        <li><span class="k-strong">90秒</span>：复盘昨日 SQDC 红灯与对策完成度（谁、何时完成、验证结果）。</li>
                        <li><span class="k-strong">90秒</span>：宣贯当班安全要点与风险点（KYT）。</li>
                        <li><span class="k-strong">60秒</span>：发布当班目标与关键管控点（首件/点检/巡检节奏）。</li>
                        <li><span class="k-strong">30秒</span>：确认异常响应路径（Andon 触发条件、到场责任人）。</li>
                    </ul>
                `
            },
            "PSP": {
                "title": "PSP - 问题解决 (Problem Solving Process)",
                "content": `
                    <div class="k-title-main">PSP：从救火到防火</div>
                    <p>PSP 的核心在于逻辑思维，区分“现象”与“真因”，并强调数据驱动。不仅要解决问题，更要防止再发 (Recurrence Prevention)。</p>

                    <div class="k-title-sub">1. 5W2H 问题描述法</div>
                    <p>一个描述清晰的问题已经解决了一半。用于量化现状与标准之间的差距 (Gap)。</p>
                    <ul style="line-height:2;">
                        <li><span class="k-term">What (什么)</span>：具体是什么缺陷？（例：表面划痕，而非“机器坏了”）</li>
                        <li><span class="k-term">Where (哪里)</span>：缺陷在产品的哪个位置？流程哪一环？</li>
                        <li><span class="k-term">When (何时)</span>：发生时间、班次、周期点？</li>
                        <li><span class="k-term">Who (谁)</span>：与人员技能、供应商有关吗？（<span class="k-strong">注意：不是为了指责个人</span>）</li>
                        <li><span class="k-term">Why (为什么)</span>：为什么这是个问题？影响了什么？</li>
                        <li><span class="k-term">How (如何)</span>：发生的模式是怎样的？</li>
                        <li><span class="k-term">How Much (多少)</span>：数量、频率、金钱损失 (Cost)。</li>
                    </ul>

                    <div class="k-title-sub">2. 根本原因分析工具</div>
                    <div class="concept-grid">
                        <div class="concept-card">
                            <span class="concept-title">🔍 5Why 分析法</span>
                            一种挖掘深层原因的钻探技术。
                            <br><strong>原则</strong>：问到真因浮现为止，不一定是5次。
                            <br><strong>验证</strong>：倒推法 (Therefore)，逻辑必须通畅。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">🐟 鱼骨图 (Fishbone)</span>
                            又称石川图 (Ishikawa)，用于头脑风暴。
                            <br><strong>鱼头</strong>：问题陈述。
                            <br><strong>大骨 (4M1E)</strong>：人、机、料、法、环。
                        </div>
                    </div>

                    <div class="k-title-sub">3. PDCA 循环</div>
                    <p>所有改善活动的基础逻辑。</p>
                    <ul>
                        <li><span class="k-term">P (Plan)</span>：定义问题、分析原因、制定对策。</li>
                        <li><span class="k-term">D (Do)</span>：执行对策。</li>
                        <li><span class="k-term">C (Check)</span>：检查效果，验证 Gap 是否消除。</li>
                        <li><span class="k-term">A (Act)</span>：如果有效，进行<strong>标准化 (Standardization)</strong> 和横向展开 (Yokoten)；无效则重新开始。</li>
                    </ul>

                    <div class="k-title-sub">4. 案例：客诉划痕的 PSP 闭环</div>
                    <p><span class="k-strong">场景</span>：客户反馈“杯体表面划痕”客诉上升。</p>
                    <div class="concept-grid">
                        <div class="concept-card">
                            <span class="concept-title">📌 5W2H 描述</span>
                            What：杯体表面划痕<br>
                            Where：包装后抽检发现<br>
                            When：夜班集中出现<br>
                            How much：3天内 18 件
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">🧯 围堵止血</span>
                            隔离夜班批次；加严外观检；确认流出范围；临时增加防护垫。
                        </div>
                    </div>
                    <p><span class="k-strong">真因示例</span>：包装工位治具护套磨损 → 造成二次刮擦（用现场证据与复现验证）。</p>
                    <p><span class="k-strong">固化</span>：护套点检项加入日点检表；更换周期写入作业指导；异常时触发隔离动作与再确认。</p>

                    <div class="k-title-sub">5. 对策有效性怎么判定（避免“做了就算”）</div>
                    <ul>
                        <li>看<span class="k-strong">趋势</span>：缺陷率连续下降，而不是单日偶然。</li>
                        <li>看<span class="k-strong">复发</span>：相同条件下不再出现同类问题。</li>
                        <li>看<span class="k-strong">过程</span>：对策执行有记录（点检/参数/培训）。</li>
                    </ul>
                `
            },
            "SW": {
                "title": "SW - 标准作业 (Standard Work)",
                "content": `
                    <div class="k-title-main">标准作业：改善的起点</div>
                    <p>标准作业不是僵化的教条，而是<strong>当前最佳</strong>的作业方法。它是管理者与员工之间的契约，也是持续改善 (Kaizen) 的基准。</p>

                    <div class="k-title-sub">1. 核心计算公式</div>
                    
                    <div class="formula-box">
                        TT (Takt Time 节拍时间) = <br>
                        净可用工作时间 / 客户需求量
                        <div class="formula-desc">
                            * TT 是客户需求的脉搏，决定生产线的速度。<br>
                            * 净可用时间扣除休息、会议等计划停机，<span class="k-strong">不扣除</span>故障、换型。
                        </div>
                    </div>

                    <div class="formula-box">
                        LBE (Line Balancing Efficiency 线平衡率) = <br>
                        (∑各工序CT) / (瓶颈工序CT × 工序数) × 100%
                        <div class="formula-desc">
                            * 衡量流水线负荷是否均匀。<br>
                            * 改善方法：ECRS (削峰填谷)。
                        </div>
                    </div>

                    <div class="formula-box">
                        SWIP (Standard WIP 标准手持) = <br>
                        ∑(人工时间 + 自动加工时间) / Takt Time
                        <div class="formula-desc">
                            * 结果通常向上取整。<br>
                            * 定义：维持标准作业循环所需的<span class="k-strong">最小</span>在制品数量。
                        </div>
                    </div>

                    <div class="k-title-sub">2. 关键概念辨析</div>
                    <table class="k-table">
                        <tr><th>概念</th><th>解释</th></tr>
                        <tr><td><strong>Cycle Time (CT)</strong></td><td>循环时间。作业者完成一个循环实测所需的时间。当 CT > TT，为瓶颈；CT < TT，为浪费。</td></tr>
                        <tr><td><strong>标准作业三要素</strong></td><td>1. 节拍时间 (TT)<br>2. 作业顺序 (Work Sequence)<br>3. 标准手持 (SWIP)</td></tr>
                        <tr><td><strong>标准作业三票</strong></td><td>1. 工程别能力表 (各工序能力)<br>2. 标准作业组合票 (人机时间组合)<br>3. 标准作业票 (布局与动线)</td></tr>
                    </table>

                    <div class="k-title-sub">3. 案例：瓶颈 CT 大于 TT 的改善思路</div>
                    <p><span class="k-strong">场景</span>：客户需求提升后，产线欠交；测得瓶颈工序 CT=68s，而 TT=55s。</p>
                    <ul>
                        <li><span class="k-strong">第一步</span>：确认数据口径一致（TT 的净可用时间是否扣除了计划停机；CT是否为连续多次实测代表值）。</li>
                        <li><span class="k-strong">第二步</span>：用 ECRS 做方法改善（先剔除无价值动作，再合并/重排/简化）。</li>
                        <li><span class="k-strong">第三步</span>：人机分离/并行作业（把自动等待时间与人工动作拆开），让“人不等机、机不等人”。</li>
                        <li><span class="k-strong">第四步</span>：改善后更新标准作业三票，并设置 SWIP，防止回退。</li>
                    </ul>

                    <div class="k-title-sub">4. 易错点（中级难度常考）</div>
                    <ul>
                        <li>把 TT 当成设备能力：TT 是需求节奏，不是设备极限速度。</li>
                        <li>用“加人/加班”替代方法改善：会把浪费固化，成本上升。</li>
                        <li>改善后不更新标准：结果是换人就回退。</li>
                    </ul>
                `
            },
            "VSM": {
                "title": "VSM - 价值流图 (Value Stream Mapping)",
                "content": `
                    <div class="k-title-main">VSM：精益的战略地图</div>
                    <p>VSM 不同于流程图，它必须包含<strong>信息流</strong>和<strong>时间线</strong>，且严格区分增值 (VA) 与非增值 (NVA) 时间。核心目的是看清全貌 (Big Picture)。</p>

                    <div class="k-title-sub">1. 核心图标与语义</div>
                    <div class="concept-grid">
                        <div class="concept-card">
                            <span class="concept-title">⚠️ 库存三角 (I)</span>
                            代表工序间的停滞和库存，是 Lead Time 的主要来源。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">🦓 推式箭头 (Push)</span>
                            黑白格粗箭头。代表按计划生产，不管下道工序是否需要。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">🛒 超市 (Supermarket)</span>
                            开口向右的 U 型。代表受控的拉动库存。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">⚡ 电子信息流</span>
                            闪电折线。代表 ERP、EDI、Email 等电子指令。
                        </div>
                    </div>

                    <div class="k-title-sub">2. 关键计算与时间线</div>
                    <p>VSM 底部的时间线分为两部分：</p>
                    <div class="vsm-line-container">
                        <div class="vsm-timeline">
                            <div class="vsm-step">库存<div class="vsm-top">Lead Time (天)</div></div>
                            <div class="vsm-step">加工<div class="vsm-btm">VA Time (秒)</div></div>
                            <div class="vsm-step">库存<div class="vsm-top">Lead Time (天)</div></div>
                            <div class="vsm-step">加工<div class="vsm-btm">VA Time (秒)</div></div>
                        </div>
                    </div>
                    <ul>
                        <li><strong>Lead Time (交付周期)</strong> = 库存数量 / 日客户需求量。</li>
                        <li><strong>增值比 (VA Ratio)</strong> = 总增值时间 / 总 Lead Time。传统工厂通常 < 1%。</li>
                    </ul>

                    <div class="k-title-sub">3. 未来态 (Future State) 关键词</div>
                    <ul>
                        <li><span class="k-term">Takt Time</span>：按客户节拍生产。</li>
                        <li><span class="k-term">Continuous Flow (连续流)</span>：消除停顿。</li>
                        <li><span class="k-term">Pull System (拉动)</span>：在无法流动处使用超市。</li>
                        <li><span class="k-term">Pacemaker (定拍工序)</span>：全厂唯一接收计划的工序。</li>
                        <li><span class="k-term">Heijunka (均衡化)</span>：混合排产，平抑波动。</li>
                    </ul>

                    <div class="k-title-sub">4. 案例：把推式改成“可落地”的拉动</div>
                    <p><span class="k-strong">场景</span>：现状图显示各工序按计划推送，工序间库存高，Lead Time 被等待吃掉。</p>
                    <table class="k-table">
                        <tr><th>改造点</th><th>做法</th><th>验证指标</th></tr>
                        <tr><td>选定拍工序</td><td>让计划只下达到一个工序，其余按信号补给。</td><td>欠交次数下降</td></tr>
                        <tr><td>设置超市</td><td>在无法连续流处设定上/下限水位，明确补给周期。</td><td>WIP下降、断料减少</td></tr>
                        <tr><td>看板信号</td><td>用取用触发补充（Pull），而不是生产完就推走。</td><td>过量生产减少</td></tr>
                        <tr><td>时间线复算</td><td>重新计算库存LT与VA比率，锁定最大等待点。</td><td>Lead Time缩短</td></tr>
                    </table>

                    <div class="k-title-sub">5. 易错点</div>
                    <ul>
                        <li>“画了未来态”但没有参数：没有批量/补给周期/水位线，就无法落地。</li>
                        <li>把超市当成大仓库：超市是受控库存，用于稳定拉动，而不是无限堆积。</li>
                        <li>只改物流不改信息流：信息触发方式不改，库存会很快反弹。</li>
                    </ul>
                `
            },
            "5S": {
                "title": "5S & 目视化 (Visual Control System)",
                "content": `
                    <div class="k-title-main">5S：异常探测系统</div>
                    <p>5S 绝非简单的打扫卫生。如果一个陌生人在 5 秒内无法分辨现场的正常与异常，说明 5S 是失败的。</p>

                    <div class="k-title-sub">1. 5S 定义与核心</div>
                    <ul style="line-height: 2;">
                        <li><strong>整理 (Seiri)</strong>：区分要与不要。核心工具：<span class="k-strong">红牌作战 (Red Tag)</span>。</li>
                        <li><strong>整顿 (Seiton)</strong>：三定原则（<span class="k-strong">定点、定品、定量</span>）。核心：消除“寻找”的浪费。</li>
                        <li><strong>清扫 (Seiso)</strong>：<span class="k-strong">清扫即点检</span>。目的是发现微缺陷（如漏油、松动）。</li>
                        <li><strong>清洁 (Seiketsu)</strong>：标准化。将前 3S 制度化、规范化。</li>
                        <li><strong>素养 (Shitsuke)</strong>：习惯与纪律。守规则。</li>
                    </ul>

                    <div class="k-title-sub">2. 目视化颜色标准 (VCS)</div>
                    <p>哈尔斯工厂通用标准：</p>
                    <div style="margin-top:20px;">
                        <p><span class="color-badge bg-yellow">黄色 Yellow</span> 通道线、一般区域分界。</p>
                        <p><span class="color-badge bg-red">红色 Red</span> 不合格品区、消防设备、危险品、红牌区。</p>
                        <p><span class="color-badge bg-blue">蓝色 Blue</span> 原材料区、在制品 (WIP)、待检区。</p>
                        <p><span class="color-badge bg-green">绿色 Green</span> 合格品区、成品区、安全设施。</p>
                        <p><span class="color-badge bg-zebra">黑黄斑马</span> 警示区域（如电柜前、坑洞边缘）。</p>
                    </div>

                    <div class="k-title-sub">3. 红牌作战 (Red Tag Strategy)</div>
                    <p>将隐性库存显性化的强力工具。</p>
                    <ul>
                        <li><strong>挂牌</strong>：对不确定或不需要的物品贴红牌。</li>
                        <li><strong>移送</strong>：移动到暂存区 (Red Tag Area)。</li>
                        <li><strong>处置</strong>：冻结期满后，废弃、变卖或归位。</li>
                    </ul>

                    <div class="k-title-sub">4. 案例：三定让缺件“一眼可见”</div>
                    <p><span class="k-strong">场景</span>：某装配工位频繁缺螺丝，作业员来回寻找导致节拍不稳。</p>
                    <ul>
                        <li><span class="k-strong">定品</span>：明确螺丝型号与名称，标识统一。</li>
                        <li><span class="k-strong">定点</span>：在工位左前方固定位置设置取用盒，贴定置线。</li>
                        <li><span class="k-strong">定量</span>：设定最小/最大水位线；低于最小线立即触发补给。</li>
                    </ul>
                    <p><span class="k-strong">效果</span>：缺料从“事后抱怨”变成“现场异常”，管理者可及时响应。</p>

                    <div class="k-title-sub">5. 清扫即点检：把故障前兆提前暴露</div>
                    <ul>
                        <li>清扫时发现漏油/松动/异响，必须标识并进入处理流程。</li>
                        <li>把高频异常写进点检表：位置、判定标准、处理动作、责任人。</li>
                    </ul>

                    <div class="k-title-sub">6. 维持机制（否则一定反弹）</div>
                    <ul>
                        <li><span class="k-strong">责任区</span>：区域边界清晰，责任人明确。</li>
                        <li><span class="k-strong">稽核节奏</span>：班组自查 + 周巡查 + 月度抽查。</li>
                        <li><span class="k-strong">闭环</span>：发现问题必须有对策与复查，不能只打分。</li>
                    </ul>
                `
            },
            "TIMWOODS": {
                "title": "TIMWOODS - 八大浪费与 ECRS",
                "content": `
                    <div class="k-title-main">消除浪费 (Muda)</div>
                    <p>精益的核心是消除浪费。除了增值 (VA) 活动，其他一切不增加价值的活动都是浪费。哈尔斯采用 TIMWOODS 模型。</p>

                    <div class="k-title-sub">1. 八大浪费 (TIMWOODS)</div>
                    <div class="concept-grid">
                        <div class="concept-card">
                            <span class="concept-title">T - Transportation (搬运)</span>
                            不产生价值的物料移动。如叉车空跑、动线过长。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">I - Inventory (库存)</span>
                            掩盖问题（水落石出理论）。占用资金和场地。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">M - Motion (动作)</span>
                            <strong>人</strong>的多余活动。如弯腰、转身、找工具。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">W - Waiting (等待)</span>
                            人或机器闲置。如缺料、设备故障、等待指令。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">O - Overproduction (过量生产)</span>
                            <span class="k-strong">万恶之源</span>。生产多于或早于客户需求。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">O - Over-processing (过加工)</span>
                            超出客户要求的加工。如过度抛光、多余检测。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">D - Defects (不良)</span>
                            返工、报废、客诉。造成材料、人工倍增。
                        </div>
                        <div class="concept-card">
                            <span class="concept-title">S - Skills (人才浪费)</span>
                            未利用员工的智慧。只让动手不让动脑。
                        </div>
                    </div>

                    <div class="k-title-sub">2. ECRS 改善四原则</div>
                    <p>一旦识别浪费，按顺序使用 ECRS 进行消除：</p>
                    <table class="k-table">
                        <tr><th>原则</th><th>英文 (English)</th><th>说明与案例</th></tr>
                        <tr><td><strong>E 剔除</strong></td><td>Eliminate</td><td><strong>首选</strong>。最好的改善是不做。例：取消不必要的审批。</td></tr>
                        <tr><td><strong>C 合并</strong></td><td>Combine</td><td>无法剔除时尝试合并。例：加工与检测合并。</td></tr>
                        <tr><td><strong>R 重排</strong></td><td>Rearrange</td><td>改变顺序。例：将检验放到瓶颈工序之前。</td></tr>
                        <tr><td><strong>S 简化</strong></td><td>Simplify</td><td>让动作更简单。例：使用工装夹具、滑槽。</td></tr>
                    </table>

                    <div class="k-title-sub">3. 案例：用 ECRS 降低换型时间</div>
                    <p><span class="k-strong">场景</span>：换型需要 25 分钟，导致小批量难落地，库存不断上升。</p>
                    <ul>
                        <li><span class="k-strong">E</span>：取消不必要的签字/等待（把“等确认”改为并行确认）。</li>
                        <li><span class="k-strong">C</span>：把两次重复测量合并为一次，并设定判定标准。</li>
                        <li><span class="k-strong">R</span>：把“找工具/找夹具”提前到停机前准备（外部作业）。</li>
                        <li><span class="k-strong">S</span>：使用快速定位销与颜色标识，减少调试动作。</li>
                    </ul>
                    <p><span class="k-strong">验证</span>：换型时间下降、在制下降、欠交减少；有效做法写入标准作业与点检。</p>

                    <div class="k-title-sub">4. 中级难度要点</div>
                    <ul>
                        <li>不要把浪费“自动化”：先消除浪费，再考虑自动化与信息化。</li>
                        <li>浪费要可量化：时间、距离、次数、金额，才能验证改善。</li>
                        <li>人才浪费常被忽视：授权与提案制度能持续产生改善。</li>
                    </ul>
                `
            }
        };

        const QUESTION_SEEDS = {
            "DM": [
                { "q": "日常管理的核心目的是什么？", "a": "维持现状并稳定绩效", "w": ["制定长远战略", "开发新产品", "进行财务审计", "招聘新员工"] },
                { "q": "SQDC中的“S”代表什么？", "a": "Safety (安全)", "w": ["Speed (速度)", "Standard (标准)", "System (系统)"] },
                { "q": "SQDC中的“Q”代表什么？", "a": "Quality (质量)", "w": ["Quantity (数量)", "Quick (快速)", "Question (问题)"] },
                { "q": "SQDC中的“D”代表什么？", "a": "Delivery (交付)", "w": ["Delay (延误)", "Design (设计)", "Detail (细节)"] },
                { "q": "SQDC中的“C”代表什么？", "a": "Cost (成本)", "w": ["Customer (客户)", "Clean (清洁)", "Control (控制)"] },
                { "q": "在4M管理中，人员变动属于哪一类？", "a": "Man (人)", "w": ["Machine (机)", "Material (料)", "Method (法)"] },
                { "q": "设备维修后重新启动，属于哪种4M变化？", "a": "Machine (机)", "w": ["Man (人)", "Material (料)", "Method (法)"] },
                { "q": "供应商更换了原材料，这属于？", "a": "Material (料)", "w": ["Man (人)", "Machine (机)", "Method (法)"] },
                { "q": "修改了作业指导书 (SOP)，这属于？", "a": "Method (法)", "w": ["Man (人)", "Machine (机)", "Material (料)"] },
                { "q": "班前会的标准时长通常建议为？", "a": "5-10分钟", "w": ["30分钟", "1小时", "2小时", "30秒"] },
                { "q": "班前会的主要地点应该在？", "a": "现场 (Gemba)", "w": ["会议室", "办公室", "食堂", "家里"] },
                { "q": "如果SQDC看板上的指标是红色的，意味着？", "a": "未达成目标，需要对策", "w": ["达成目标", "数据错误", "无需关注", "颜色好看"] },
                { "q": "异常响应流程的第一步是？", "a": "发现异常", "w": ["呼叫班长", "停止生产", "填写报告", "继续生产"] },
                { "q": "发现异常后，操作工应该立即做出的动作是？", "a": "停止并呼叫 (Stop & Call)", "w": ["自行修理", "大声喊叫", "掩盖问题", "等待下班"] },
                { "q": "“三现主义”指的是？", "a": "现场、现物、现实", "w": ["现状、现金、现代", "现在、现场、现查", "现象、现行、现成"] },
                { "q": "Andon系统的主要作用是？", "a": "可视化异常并呼叫支援", "w": ["监控员工考勤", "播放背景音乐", "调节车间温度", "计算工资"] },
                { "q": "初物管理通常在什么时候进行？", "a": "4M发生变化后", "w": ["每天下班时", "每月月底", "每年年初", "设备报废时"] },
                { "q": "日常管理看板要求具备“3秒法则”，意思是？", "a": "3秒内能判断正常与否", "w": ["3秒内必须读完所有字", "3秒内必须更新数据", "3秒内必须打卡"] },
                { "q": "KYT活动的含义是？", "a": "危险预知训练", "w": ["快乐运动时间", "快速甚至跳跃", "科学运通", "矿业特种作业"] },
                { "q": "在班前会上，最优先讨论的议题是？", "a": "安全", "w": ["产量", "成本", "质量", "考勤"] },
                { "q": "PDCA循环中，D代表？", "a": "Do (执行)", "w": ["Design (设计)", "Done (完成)", "Deal (处理)"] },
                { "q": "PDCA循环中，C代表？", "a": "Check (检查)", "w": ["Cost (成本)", "Clean (清洁)", "Call (呼叫)"] },
                { "q": "PDCA循环中，A代表？", "a": "Act (处理/标准化)", "w": ["Ask (询问)", "Aim (目标)", "Add (增加)"] },
                { "q": "日常管理的“正常”状态是指？", "a": "符合标准", "w": ["没有领导在场", "机器在转动", "有人在工作", "没有噪音"] },
                { "q": "谁是班前会的主持人？", "a": "班组长或团队领导", "w": ["公司总经理", "人事经理", "财务总监", "外部顾问"] },
                { "q": "变化点管理的目的是？", "a": "防止变化导致的不良和事故", "w": ["为了记录变化", "为了增加工作量", "为了应付审核"] },
                { "q": "目视化管理的最高境界是？", "a": "异常一旦发生显而易见", "w": ["把墙壁涂满颜色", "到处贴标语", "使用昂贵的显示屏"] },
                { "q": "在SQDC看板上，绿色通常代表？", "a": "正常/达成目标", "w": ["异常", "停止", "危险", "警告"] },
                { "q": "TBM (Tool Box Meeting) 通常指？", "a": "班前安全/作业交底会", "w": ["工具箱维修", "时间管理会议", "高层战略会"] },
                { "q": "如果生产线出现连续不良，应该？", "a": "立即停线分析", "w": ["继续生产挑出不良", "加快速度弥补", "责怪上道工序"] },
                { "q": "标准化作业指导书 (SOP) 属于？", "a": "标准", "w": ["建议", "参考", "小说", "日记"] },
                { "q": "日常管理报表应该由谁更新？", "a": "现场负责人/班组长", "w": ["总经理", "人事部", "清洁工", "客户"] },
                { "q": "发生安全事故后，首要动作是？", "a": "救治伤员并保护现场", "w": ["逃跑", "隐瞒", "继续工作", "指责伤者"] },
                { "q": "交接班时，最重要的是交接？", "a": "异常情况与变化点", "w": ["私人八卦", "工具箱钥匙", "打火机", "零食"] },
                { "q": "OJT (On the Job Training) 是指？", "a": "在岗培训", "w": ["脱产培训", "在线考试", "出国考察", "自学"] },
                { "q": "多能工的培养有助于？", "a": "应对人员缺勤带来的波动", "w": ["降低员工工资", "增加管理难度", "造成混乱"] },
                { "q": "生产计划未达成时，首先应分析？", "a": "未达成的原因 (Gap Analysis)", "w": ["修改计划", "加班", "指责员工", "无视"] },
                { "q": "日常管理的基石是？", "a": "5S", "w": ["TPM", "JIT", "Six Sigma", "ERP"] },
                { "q": "一线主管的“管家婆”角色主要体现在？", "a": "对人、机、料、法、环的统筹", "w": ["管钱", "管饭", "管闲事", "管卫生"] },
                { "q": "为什么要求班前会站立进行？", "a": "提高效率，保持紧迫感", "w": ["没有椅子", "为了锻炼身体", "模仿军队", "省钱"] },
                { "q": "首件检验的目的是？", "a": "防止批量不良", "w": ["测试仪器", "浪费时间", "休息一下", "走形式"] },
                { "q": "Gemba Walk 的中文意思是？", "a": "现场巡视/走动管理", "w": ["饭后散步", "参观工厂", "甚至迷路", "跑步比赛"] },
                { "q": "变化的4M中，最难控制的是？", "a": "Man (人)", "w": ["Machine (机)", "Material (料)", "Method (法)"] },
                { "q": "对于重复发生的日常问题，应该？", "a": "启动问题解决流程 (PSP)", "w": ["习惯就好", "视而不见", "天天救火", "增加人手"] },
                { "q": "生产线平衡率低会导致？", "a": "等待浪费和成本上升", "w": ["效率提升", "质量变好", "员工开心", "库存降低"] },
                { "q": "日常点检表的作用是？", "a": "预防设备故障和安全事故", "w": ["练习打钩", "应付检查", "收集废纸", "记录心情"] },
                { "q": "全员生产维护 (TPM) 的基础是？", "a": "日常清扫和点检", "w": ["专业维修", "外包服务", "购买新机", "设备改造"] },
                { "q": "红牌作战通常用于？", "a": "5S整理阶段，识别不要物", "w": ["军事演习", "体育比赛", "奖励员工", "装饰车间"] },
                { "q": "定置管理属于5S中的？", "a": "整顿 (Seiton)", "w": ["整理", "清扫", "清洁", "素养"] },
                { "q": "班组建设的核心是？", "a": "凝聚力与执行力", "w": ["吃喝玩乐", "个人英雄主义", "帮派主义", "无政府主义"] },
                { "q": "精益生产追求的目标是？", "a": "零浪费、零不良、零故障、零灾害", "w": ["零库存", "零员工", "零成本", "零工资"] },
                { "q": "防错 (Poka-Yoke) 装置的作用是？", "a": "即使人为疏忽也不会产生不良", "w": ["代替人工", "提高速度", "降低噪音", "增加重量"] },
                { "q": "单点课程 (OPL) 的时长通常是？", "a": "5-10分钟", "w": ["1小时", "半天", "一天", "一周"] },
                { "q": "谁是质量的第一责任人？", "a": "制造者 (操作工)", "w": ["检验员", "质量经理", "总经理", "客户"] },
                { "q": "在日常管理中，Lead Time 指的是？", "a": "交付周期", "w": ["领导时间", "学习时间", "休息时间", "带队时间"] },
                { "q": "JIT (Just In Time) 的核心思想是？", "a": "在需要的时间，按需要的量，生产需要的产品", "w": ["越快越好", "越多越好", "越早越好", "越便宜越好"] },
                { "q": "拉动式生产的信号通常是？", "a": "看板 (Kanban)", "w": ["命令", "电话", "广播", "猜测"] },
                { "q": "一个流 (One Piece Flow) 的好处是？", "a": "快速暴露问题，缩短周期", "w": ["掩盖问题", "增加搬运", "增加库存", "看起来忙碌"] },
                { "q": "水蜘蛛 (Water Spider) 的角色是？", "a": "负责物料配送，支持作业员专注于增值工作", "w": ["负责清洁卫生", "负责监督纪律", "负责维修设备", "负责倒水"] },
                { "q": "Andon灯亮黄灯通常表示？", "a": "缺料或请求支援", "w": ["设备故障", "生产停止", "下班", "吃饭"] },
                { "q": "Andon灯亮红灯通常表示？", "a": "设备故障或质量异常，停线", "w": ["缺料", "正常运行", "准备开会", "欢迎参观"] }
            ],
            "PSP": [
                { "q": "5Why分析法的主要目的是？", "a": "挖掘问题的根本原因", "w": ["为了责怪员工", "为了拖延时间", "为了凑字数"] },
                { "q": "鱼骨图（石川图）的“鱼头”代表？", "a": "问题陈述/结果", "w": ["根本原因", "解决方案", "最大影响因素"] },
                { "q": "鱼骨图的4M1E不包括？", "a": "Money (金钱)", "w": ["Man (人)", "Machine (机)", "Material (料)", "Method (法)"] },
                { "q": "在PDCA循环中，Plan (计划) 阶段主要做？", "a": "现状调查、原因分析、制定对策", "w": ["实施对策", "检查效果", "标准化"] },
                { "q": "验证5Why分析逻辑是否严密的词语是？", "a": "因此 (Therefore)", "w": ["但是", "或者", "也许", "可能"] },
                { "q": "当原因不明确，需要团队集思广益时，最适合的工具是？", "a": "鱼骨图 (头脑风暴)", "w": ["控制图", "散点图", "直方图", "甘特图"] },
                { "q": "PDCA中的A (Act) 如果成功，下一步是？", "a": "标准化并横向展开", "w": ["回到原点", "放弃项目", "隐瞒成果"] },
                { "q": "问题描述必须基于？", "a": "事实和数据 (Fact & Data)", "w": ["猜测和直觉", "传闻", "主观臆断"] },
                { "q": "做5Why分析时，应该何时停止？", "a": "找到可执行的根本原因时", "w": ["问满5次时", "问到领导满意时", "问到没词时"] },
                { "q": "5W2H中的“Who”主要用于？", "a": "识别与人员相关的规律（技能、班次）", "w": ["寻找替罪羊", "扣奖金", "表扬", "记录名字"] },
                { "q": "鱼骨图中的“环境”因素包括？", "a": "温度、湿度、照明、噪音", "w": ["工资水平", "食堂饭菜", "公司政策"] },
                { "q": "“对策”与“临时措施”的区别是？", "a": "对策消除真因防止复发，临时措施仅止血", "w": ["对策花钱少", "临时措施更有效", "两者没区别"] },
                { "q": "如果Check阶段发现问题未解决，应该？", "a": "重新回到Plan阶段分析原因", "w": ["强行进入Act阶段", "伪造数据", "放弃解决"] },
                { "q": "以下哪个属于鱼骨图中“方法”类的原因？", "a": "作业顺序不合理", "w": ["员工疲劳", "轴承磨损", "原料硬度高"] },
                { "q": "问题的定义是？", "a": "现状与标准（目标）之间的差距", "w": ["领导不满意", "发生了争吵", "机器停了"] },
                { "q": "纠正 (Correction) 和纠正措施 (Corrective Action) 的区别？", "a": "纠正治标，纠正措施治本", "w": ["纠正治本，纠正措施治标", "纠正是为了检查", "纠正措施是为了罚款"] },
                { "q": "解决问题的最后一步通常是？", "a": "标准化与防错", "w": ["实施", "分析", "计划", "汇报"] },
                { "q": "去“现场” (Gemba) 解决问题是为了？", "a": "掌握第一手真实信息", "w": ["呼吸新鲜空气", "监督员工", "展示权威"] },
                { "q": "鱼骨图中“人”的因素通常包括？", "a": "技能不足、疲劳、未按标准操作", "w": ["电压不稳", "原料硬度", "温湿度"] },
                { "q": "如果只问一次Why就解决，风险是？", "a": "只是处理了表象，问题会复发", "w": ["效率太高", "成本太低", "领导会生气"] },
                { "q": "5W2H中的“2H”指？", "a": "How (如何) 和 How Much (程度/成本)", "w": ["Hello 和 Hi", "Heavy 和 Hard", "Head 和 Hand"] },
                { "q": "进行5Why分析前，必须先？", "a": "明确问题并掌握现状", "w": ["购买设备", "开除员工", "写检讨"] },
                { "q": "如果对策成本过高，应该？", "a": "重新评估，寻找更优的性价比方案", "w": ["不管成本强行上", "放弃解决", "挪用公款"] },
                { "q": "头脑风暴法的原则是？", "a": "自由畅想，暂不评判", "w": ["立即批评", "领导先说", "只能说正确的"] },
                { "q": "帕累托图 (80/20法则) 用于？", "a": "识别关键的少数问题", "w": ["平均分配资源", "显示时间序列", "分析相关性"] },
                { "q": "A3报告是一种？", "a": "在一页纸上呈现完整解决过程的工具", "w": ["A3纸打印的文件", "三种答案", "昂贵的软件"] },
                { "q": "ECRS原则在制定对策时用于？", "a": "优化流程（剔除、合并、重排、简化）", "w": ["增加复杂性", "扩大规模", "延长即时间"] },
                { "q": "5Why分析容易犯的错误是？", "a": "逻辑跳跃或归咎于不可控因素", "w": ["问得太深", "思考太久", "写字太丑"] },
                { "q": "解决问题时，数据比观点重要，因为？", "a": "观点可能带有偏见，数据更客观", "w": ["数据更难懂", "观点太便宜", "数据可以卖钱"] },
                { "q": "PDCA是一个？", "a": "螺旋上升的循环", "w": ["封闭的圆环", "直线", "断裂的线"] },
                { "q": "对于突发性质量事故，首先要做的是？", "a": "围堵不良品（止血）", "w": ["寻找真因", "开除员工", "修改SOP"] },
                { "q": "防错设计的等级最高的是？", "a": "使错误不可能发生 (消除)", "w": ["错误发生时报警", "错误发生后挑选", "依靠人的注意力"] },
                { "q": "问题解决的最高境界是？", "a": "预防问题发生", "w": ["快速解决问题", "掩盖问题", "没有问题"] },
                { "q": "下列哪项不是真因？", "a": "工人不小心", "w": ["防错装置失效", "未定义作业标准", "培训机制缺失"] },
                { "q": "丰田解决问题的核心思考方式是？", "a": "科学思维", "w": ["经验主义", "教条主义", "拿来主义"] },
                { "q": "散点图用于分析？", "a": "两个变量之间的相关性", "w": ["数据的分布", "关键少数", "随时间的变化"] },
                { "q": "直方图用于分析？", "a": "数据的分布形态（波动）", "w": ["相关性", "趋势", "因果关系"] },
                { "q": "控制图用于？", "a": "监控过程是否处于受控状态", "w": ["寻找真因", "制定计划", "计算成本"] },
                { "q": "解决问题需要“刨根问底”，这叫？", "a": "深究", "w": ["钻牛角尖", "找茬", "多事"] },
                { "q": "标准化是为了？", "a": "防止问题反弹", "w": ["限制自由", "增加文档", "应付审核"] },
                { "q": "Yokoten (横向展开) 的意义是？", "a": "让一个地方的教训成为全公司的经验", "w": ["把问题扩散", "推卸责任", "增加工作"] },
                { "q": "QC七大手法不包括？", "a": "SWOT分析", "w": ["帕累托图", "鱼骨图", "直方图"] },
                { "q": "关联图用于？", "a": "分析复杂因素之间的因果关系", "w": ["展示数据", "制定日程", "分配工作"] },
                { "q": "解决问题的态度应该是？", "a": "对事不对人", "w": ["对人不对事", "既对人也对事", "不管人也不管事"] },
                { "q": "DMAIC 是六西格玛的改进路径，分别指？", "a": "定义、测量、分析、改进、控制", "w": ["设计、制造、分析、改进、检查", "做、量、分析、实施、查"] },
                { "q": "8D 报告中的 D4 是？", "a": "确定并验证根本原因", "w": ["成立小组", "描述问题", "临时措施"] },
                { "q": "TRIZ 理论用于？", "a": "解决发明创造中的矛盾", "w": ["解决人际矛盾", "解决财务问题", "解决物流问题"] },
                { "q": "FMEA (失效模式与影响分析) 是一种？", "a": "预防性的风险分析工具", "w": ["事后补救工具", "统计工具", "绘图工具"] },
                { "q": "RPN (风险顺序数) 的计算公式是？", "a": "严重度 x 发生度 x 探测度", "w": ["严重度 + 发生度 + 探测度", "严重度 / 发生度"] },
                { "q": "解决问题的根本动力是？", "a": "持续改善 (Kaizen) 的精神", "w": ["奖金", "升职", "恐惧"] },
                { "q": "当遇到“无解”的问题时，应该？", "a": "回到原点，重新审视问题定义", "w": ["放弃", "造假", "推给别人"] },
                { "q": "解决问题的能力是？", "a": "可以通过训练提高的技能", "w": ["天生的天赋", "运气", "不可学习的"] },
                { "q": "好的对策应该具备？", "a": "有效性、可行性、经济性", "w": ["复杂性、昂贵性、理论性", "随意性、临时性、隐蔽性"] },
                { "q": "解决问题时，为什么要“现地现物”？", "a": "因为报告和数据往往过滤了细节", "w": ["因为现场凉快", "因为办公室太吵", "因为要锻炼身体"] },
                { "q": "丰田的“大野圆圈”是指？", "a": "站在圈里观察现场直到发现问题", "w": ["画个圈诅咒问题", "一种游戏", "一种零件"] },
                { "q": "解决问题不是为了？", "a": "惩罚犯错的人", "w": ["消除隐患", "提升能力", "改进流程"] },
                { "q": "解决问题时，多问几个“为什么”可以防止？", "a": "头痛医头，脚痛医脚", "w": ["头痛医脚", "脚痛医头", "没病找病"] },
                { "q": "问题的冰山模型中，水面下的部分是？", "a": "系统、文化、观念等深层原因", "w": ["现象", "事件", "结果"] },
                { "q": "企业最大的浪费是？", "a": "员工智慧的浪费", "w": ["纸张浪费", "电费", "水费"] },
                { "q": "问题解决型团队的特征是？", "a": "自主性、协作性、数据导向", "w": ["依赖性、对抗性、直觉导向", "松散、懒惰、推诿"] },
                { "q": "PSP在精益屋中的位置是？", "a": "基础 (与标准化并列)", "w": ["屋顶", "支柱", "装饰品"] }
            ],
            "SW": [
                { "q": "如果一天净工作时间480分钟，客户需求480件，TT是多少？", "a": "1分钟/件", "w": ["480分钟/件", "0.5分钟/件", "2分钟/件"] },
                { "q": "标准手持 (SWIP) 的定义是？", "a": "维持标准作业循环所需的最小在制品数量", "w": ["仓库里的最大库存", "生产线上的废品", "为了安全多放的库存"] },
                { "q": "线平衡率 (LBE) 的分母是？", "a": "瓶颈工序CT x 工序数", "w": ["总CT x 工序数", "瓶颈工序CT x 100", "总工时"] },
                { "q": "如果循环时间 (CT) 大于节拍时间 (TT)，结果是？", "a": "无法满足客户需求（瓶颈）", "w": ["产能过剩", "效率很高", "库存积压"] },
                { "q": "哪种图表用于显示人机配合的时间关系？", "a": "标准作业组合票", "w": ["山积图", "鱼骨图", "散点图"] },
                { "q": "山积图 (Yamazumi Chart) 主要用于？", "a": "线平衡分析与改善", "w": ["登山路线规划", "库存堆积分析", "质量数据分析"] },
                { "q": "计算TT时，是否扣除设备故障停机时间？", "a": "否，故障属于管理损失", "w": ["是，必须扣除", "看心情", "不确定"] },
                { "q": "提高线平衡率的主要方法是？", "a": "削峰填谷 (ECRS)", "w": ["增加所有人工作量", "让瓶颈做得更慢", "增加库存"] },
                { "q": "如果人工时间20秒，机器自动40秒，TT是60秒，理论SWIP是？", "a": "1件", "w": ["2件", "0件", "10件"] },
                { "q": "标准作业的前提是？", "a": "过程稳定 (4M稳定)", "w": ["人员充足", "设备昂贵", "领导在场"] },
                { "q": "节拍时间是由谁决定的？", "a": "客户 (市场)", "w": ["工厂厂长", "设备能力", "工人速度"] },
                { "q": "作业顺序是指？", "a": "作业员在周期内最高效的操作次序", "w": ["产品工艺流程", "随意操作", "按心情操作"] },
                { "q": "如果客户需求增加，TT会？", "a": "变短", "w": ["变长", "不变", "消失"] },
                { "q": "少人化 (Shojinka) 的实现依赖于？", "a": "标准作业和多能工", "w": ["自动化设备", "外包", "裁员"] },
                { "q": "标准作业票上通常画有？", "a": "设备布局、物流动线、人员动线、SWIP", "w": ["风景画", "电路图", "组织架构图"] },
                { "q": "工程别能力表用于？", "a": "识别各工序的加工能力上限", "w": ["评价员工能力", "计算成本", "记录考勤"] },
                { "q": "如果只有作业标准，没有标准作业，会导致？", "a": "效率和质量的波动", "w": ["没影响", "效率更高", "质量更好"] },
                { "q": "标准作业是？", "a": "当前的最佳实践，并不断改善", "w": ["一成不变的法律", "仅仅是参考", "用来应付检查"] },
                { "q": "周期时间 (Cycle Time) 是指？", "a": "完成一个工序的实测时间", "w": ["产品交付时间", "采购时间", "运输时间"] },
                { "q": "LBE (Line Balance Efficiency) 低意味着？", "a": "存在大量等待浪费", "w": ["效率很高", "没有浪费", "设备很好"] },
                { "q": "非周期性作业（如换刀、加料）应该？", "a": "尽量转化为外部作业或由水蜘蛛进行", "w": ["计入循环时间", "让操作员停机去做", "不管它"] },
                { "q": "标准作业改善的循环是？", "a": "观察 -> 分析 -> 改善 -> 新标准", "w": ["改善 -> 观察 -> 分析 -> 新标准", "分析 -> 改善 -> 观察 -> 新标准"] },
                { "q": "在标准作业中，质量检查应该？", "a": "内建于作业步骤中", "w": ["由专职检验员做", "最后统一做", "不做"] },
                { "q": "生产线中有5个工位，CT分别是10, 12, 10, 9, 10秒，瓶颈是？", "a": "12秒的工位", "w": ["9秒的工位", "10秒的工位", "第一工位"] },
                { "q": "标准作业组合票中的红色线通常代表？", "a": "等待时间", "w": ["步行时间", "手动作业", "机器自动"] },
                { "q": "标准作业改善的第一步是？", "a": "测量并记录现行作业时间", "w": ["直接修改", "开会讨论", "购买设备"] },
                { "q": "人机作业分离的目的是？", "a": "人不做机器能做的事（如看守机器）", "w": ["人可以休息", "机器可以休息", "减少产量"] },
                { "q": "SWIP放置的位置应该是？", "a": "固定的、标准化的位置", "w": ["随便放", "地上", "口袋里"] },
                { "q": "若TT=60s，CT=55s，这时候操作员应该？", "a": "执行标准作业，剩余时间作为等待或进行5S", "w": ["生产更多", "自行减速", "玩手机"] },
                { "q": "标准作业卡 (SOS) 主要用于？", "a": "培训和目视化管理", "w": ["装饰", "挡风", "记笔记"] },
                { "q": "如果作业员不按标准作业操作，首先应该？", "a": "询问原因（是否标准难执行？）", "w": ["处罚", "开除", "不管"] },
                { "q": "标准作业是为了消除？", "a": "Mura (波动/不均)", "w": ["Muri (超负荷)", "Muda (浪费)", "Money (金钱)"] },
                { "q": "如果一个工位CT远小于TT，应该？", "a": "考虑合并工位或增加工作内容", "w": ["让他休息", "让他生产库存", "让他打扫卫生"] },
                { "q": "标准作业不仅规定了做什么，还规定了？", "a": "怎么做、多少时间做", "w": ["谁做", "在哪做", "为什么做"] },
                { "q": "水蜘蛛 (Water Spider) 的作业也需要标准作业吗？", "a": "必须有，且要求更高", "w": ["不需要", "随意跑", "看情况"] },
                { "q": "标准作业不仅适用于生产线，也适用于？", "a": "换型、物流、甚至办公流程", "w": ["只适用于组装", "只适用于机加", "不适用于其他"] },
                { "q": "标准时间的设定应该基于？", "a": "熟练工人的正常速度", "w": ["最快工人的速度", "最慢工人的速度", "领导想象的速度"] },
                { "q": "宽放时间 (Allowance) 包括？", "a": "生理宽放、疲劳宽放、作业宽放等", "w": ["聊天时间", "玩手机时间", "迟到时间"] },
                { "q": "观测时间时，通常需要观测多少次？", "a": "至少10次以上以取平均值", "w": ["1次", "2次", "3次"] },
                { "q": "剔除异常值的目的是？", "a": "保证数据的代表性", "w": ["造假", "让数据好看", "凑数"] },
                { "q": "标准作业与SOP的区别？", "a": "SOP侧重操作步骤和质量，标准作业侧重时间、顺序和手持", "w": ["没有区别", "SOP是给领导看的", "标准作业是给客户看的"] },
                { "q": "当TT由60s变为30s时，理论上人员需要？", "a": "增加（倍增）", "w": ["减少", "不变", "解散"] },
                { "q": "U型线内侧宽度一般建议为？", "a": "1.2米-1.5米（便于跨越）", "w": ["3米以上", "0.5米", "无所谓"] },
                { "q": "逆时针巡回作业有利于？", "a": "大部分人是右撇子，便于取放料", "w": ["顺时针更好", "无所谓", "左撇子多"] },
                { "q": "标准手持量过多会掩盖？", "a": "工序间的不平衡和微小停顿", "w": ["灰尘", "地面", "噪音"] },
                { "q": "标准作业的前提是物料？", "a": "齐套且质量合格", "w": ["随便", "缺料也行", "坏料也行"] },
                { "q": "动作经济原则包括？", "a": "双手同时动作、减少动作幅度等", "w": ["单手操作", "大幅度动作", "弯腰动作"] },
                { "q": "Therblig (动素) 分析用于？", "a": "微观动作分析", "w": ["宏观流程分析", "财务分析", "化学分析"] },
                { "q": "PTS (预定时间标准) 法可以？", "a": "在不观测现场的情况下设定标准时间", "w": ["完全取代秒表", "没有任何误差", "不需要培训"] },
                { "q": "标准作业不仅是文件的标准化，更是？", "a": "动作的标准化", "w": ["思想的标准化", "语言的标准化", "服装的标准化"] },
                { "q": "标准作业改进后，必须？", "a": "培训员工并更新文件", "w": ["保密", "只告诉领导", "不更新文件"] },
                { "q": "谁负责制定和维护标准作业？", "a": "现场班组长/工程师", "w": ["操作工自己", "总经理", "人事部"] },
                { "q": "标准作业的“三性”是？", "a": "科学性、合理性、可操作性", "w": ["随意性、临时性、模糊性", "强制性、惩罚性、困难性"] },
                { "q": "如果操作者发现更好的方法，应该？", "a": "提出建议，验证后修改标准", "w": ["私自按新方法做", "不告诉别人", "继续按旧方法做不吭声"] },
                { "q": "标准作业能保证？", "a": "质量一致性", "w": ["必然盈利", "设备不坏", "物料不缺"] },
                { "q": "作业要领书通常包含？", "a": "关键点 (Key Point) 和成败理由", "w": ["废话", "口号", "广告"] },
                { "q": "Takt Time 是德语词汇，原意是？", "a": "指挥棒/节拍", "w": ["时间", "坦克", "任务"] },
                { "q": "标准作业是精益屋的？", "a": "基础", "w": ["支柱", "屋顶", "地基之下"] },
                { "q": "没有标准作业，就无法进行？", "a": "PDCA改善", "w": ["生产", "销售", "采购"] },
                { "q": "标准作业组合票的时间轴单位通常是？", "a": "秒", "w": ["分", "小时", "天"] },
                { "q": "作业顺序应避免？", "a": "交叉迂回和空手等待", "w": ["直线运动", "双手并用", "节奏感"] },
                { "q": "标准手持量计算公式中，如果结果是3.2，应该取？", "a": "4 (向上取整)", "w": ["3 (四舍五入)", "3.2", "0"] },
                { "q": "线平衡改善中，分割工序是指？", "a": "将瓶颈工序的一部分拆分给其他工序", "w": ["把零件切开", "把机器拆开", "把人分开"] },
                { "q": "生产线速度设定应？", "a": "略快于TT (考虑效率损失)", "w": ["等于TT", "慢于TT", "随意设定"] },
                { "q": "标准作业是否适用于非重复性工作？", "a": "难，但可以标准化流程", "w": ["完全适用", "完全不适用", "只适用于艺术创作"] },
                { "q": "标准作业卡上的“+”符号通常代表？", "a": "安全注意点", "w": ["质量检查", "标准手持", "操作顺序"] },
                { "q": "标准作业卡上的菱形符号通常代表？", "a": "质量检查点", "w": ["安全注意", "标准手持", "等待时间"] },
                { "q": "标准作业的修订频率是？", "a": "随着改善不断修订", "w": ["一年一次", "从不修订", "领导想起来就修"] },
                { "q": "One Piece Flow (一个流) 相比批量生产？", "a": "Lead Time更短", "w": ["库存更多", "隐患更隐蔽", "管理更复杂"] },
                { "q": "实现标准作业的难点通常在于？", "a": "员工习惯的改变", "w": ["技术难度", "设备能力", "计算公式"] },
                { "q": "标准作业培训的最佳方式是？", "a": "TWI-JI (工作指导)", "w": ["自学", "看视频", "听讲座"] },
                { "q": "标准作业能降低？", "a": "培训新员工的成本和时间", "w": ["设备寿命", "产品价格", "客户期望"] }
            ],
            "VSM": [
                { "q": "VSM的全称是？", "a": "Value Stream Mapping (价值流图)", "w": ["Value Standard Method", "Visual Stream Map", "Virtual System Model"] },
                { "q": "计算库存Lead Time的公式是？", "a": "库存数量 / 日客户需求量", "w": ["库存数量 x 日产量", "库存金额 / 总资产", "日产量 / 库存数量"] },
                { "q": "VSM中闪电形状的箭头代表？", "a": "电子信息流", "w": ["人工信息流", "物料流", "推式生产"] },
                { "q": "VSM时间线底部的凸起部分代表？", "a": "增值时间 (Processing Time)", "w": ["等待时间", "搬运时间", "库存时间"] },
                { "q": "VSM时间线顶部的平直线代表？", "a": "非增值时间 (Lead Time)", "w": ["增值时间", "加工时间", "循环时间"] },
                { "q": "带有黑白条纹的粗箭头代表？", "a": "推式生产 (Push)", "w": ["拉动生产 (Pull)", "电子信息", "运输"] },
                { "q": "开口向右的“U”形符号代表？", "a": "超市 (Supermarket)", "w": ["仓库", "工序", "卡车"] },
                { "q": "增值时间 (VA) 是指？", "a": "改变产品形态或性能且客户愿意付费的时间", "w": ["搬运时间", "检验时间", "等待时间"] },
                { "q": "绘制VSM的第一步是？", "a": "选择产品族", "w": ["绘制当前态", "绘制未来态", "计算节拍"] },
                { "q": "绘制当前态图时，应该？", "a": "从后往前画 (从客户到供应商)", "w": ["从前往后画", "从中间开始", "随便画"] },
                { "q": "数据框 (Data Box) 中不包含？", "a": "操作员家庭住址", "w": ["循环时间 (CT)", "换型时间 (C/O)", "稼动率"] },
                { "q": "定拍工序 (Pacemaker) 是？", "a": "生产计划下达的唯一工序", "w": ["第一道工序", "最后一道工序", "瓶颈工序"] },
                { "q": "未来态设计的目的是？", "a": "建立流动和拉动，消除浪费", "w": ["画着好看", "应付老板", "增加库存"] },
                { "q": "EPEI (Every Part Every Interval) 反映了？", "a": "生产的柔性/换型频率", "w": ["设备故障率", "人员出勤率", "废品率"] },
                { "q": "如果在VSM中看到大量库存三角，说明？", "a": "流动性差，Lead Time长", "w": ["生产能力强", "客户需求大", "管理很好"] },
                { "q": "超市拉动适用于？", "a": "无法实现连续流的断点处", "w": ["所有地方", "任何地方都不用", "只用于原材料"] },
                { "q": "看板 (Kanban) 在VSM中用于？", "a": "传递生产或取料指令", "w": ["装饰", "记录数据", "请假"] },
                { "q": "“爆炸”状的图标 (Kaizen Burst) 代表？", "a": "改善机会/突击周", "w": ["危险区域", "废弃设备", "重要通知"] },
                { "q": "VSM区别于普通流程图的关键在于？", "a": "包含了信息流和时间线", "w": ["用纸画", "用电脑画", "符号不同"] },
                { "q": "增值比率 (Activity Ratio) 计算公式是？", "a": "总增值时间 / 总Lead Time", "w": ["总Lead Time / 总增值时间", "总增值时间 x 100", "总产量 / 总工时"] },
                { "q": "通常企业的增值比率约为？", "a": "< 5%", "w": ["50%", "80%", "100%"] },
                { "q": "FIFO车道 (先入先出) 用于？", "a": "连接两个工序并限制库存上限", "w": ["无限堆积库存", "随意取拿", "长期存储"] },
                { "q": "负荷均衡框 (Heijunka Box) 用于？", "a": "均衡生产及其混流排产", "w": ["装废料", "装工具", "装文件"] },
                { "q": "VSM中的卡车图标代表？", "a": "外部运输 (发货/收货)", "w": ["内部搬运", "叉车", "小推车"] },
                { "q": "眼镜图标 (Go See) 代表？", "a": "现场调度/目视检查", "w": ["近视眼", "看书", "休息"] },
                { "q": "如果C/O时间长，会导致？", "a": "EPEI变大，批量变大，库存增加", "w": ["EPEI变小", "批量变小", "库存减少"] },
                { "q": "未来态中，计划只下达给？", "a": "定拍工序", "w": ["所有工序", "第一道工序", "瓶颈工序"] },
                { "q": "连续流 (Continuous Flow) 是最高效的，因为它？", "a": "消除了工序间的库存和等待", "w": ["速度最快", "设备最贵", "人最多"] },
                { "q": "VSM中的“OXOX”符号代表？", "a": "负荷均衡 (Heijunka)", "w": ["拥抱亲吻", "井字棋", "未知"] },
                { "q": "如果上游工序比下游快，会导致？", "a": "库存堆积 (Overproduction)", "w": ["下游断料", "效率提升", "成本降低"] },
                { "q": "生产看板 (Production Kanban) 指令？", "a": "制造规定数量的产品", "w": ["搬运产品", "购买材料", "修理机器"] },
                { "q": "取料看板 (Withdrawal Kanban) 指令？", "a": "从上游工序或超市搬运物料", "w": ["制造产品", "检验产品", "废弃产品"] },
                { "q": "信号看板 (Signal Kanban) 通常用于？", "a": "批量生产的触发", "w": ["单件流", "紧急停止", "换班"] },
                { "q": "VSM不仅关注物流，还关注？", "a": "信息流", "w": ["现金流", "人流", "电流"] },
                { "q": "绘制VSM需要遵循？", "a": "实事求是，基于现场数据", "w": ["领导指示", "书本理论", "理想状态"] },
                { "q": "当前态图画完后，最重要的工作是？", "a": "计算时间线并识别浪费", "w": ["归档", "复印", "挂墙上"] },
                { "q": "未来态图通常规划多长时间的目标？", "a": "6-12个月", "w": ["10年", "1个月", "1周"] },
                { "q": "VSM是哪个层级的改善工具？", "a": "系统级 (System Level)", "w": ["点改善 (Point Kaizen)", "工位级", "设备级"] },
                { "q": "如果Lead Time是20天，VA是20分钟，说明？", "a": "巨大的改善空间", "w": ["正常现象", "无法改善", "行业通病"] },
                { "q": "超市中的“最大库存”决定了？", "a": "Lead Time的上限", "w": ["生产速度", "设备能力", "人员数量"] },
                { "q": "安全库存 (Safety Stock) 是为了？", "a": "应对客户需求的波动或内部不稳定", "w": ["为了好看", "为了占地方", "为了多生产"] },
                { "q": "VSM中的工序框如果不共用，应该？", "a": "分开画", "w": ["画在一起", "重叠画", "不画"] },
                { "q": "如果多个产品经过相似的工艺流程，它们属于？", "a": "同一个产品族", "w": ["不同产品族", "无关产品", "竞争产品"] },
                { "q": "产品族矩阵 (Product Family Matrix) 用于？", "a": "选择适合绘制VSM的产品族", "w": ["计算价格", "排班", "设备选型"] },
                { "q": "VSM中的操作员图标（人头）代表？", "a": "该工序的人员数量", "w": ["管理者", "客户", "供应商"] },
                { "q": "如果一个工序的稼动率 (Uptime) 很低，在VSM中意味着？", "a": "产能损失和潜在瓶颈", "w": ["没关系", "很正常", "甚至更好"] },
                { "q": "VSM能不能用于非制造业（如办公流程）？", "a": "可以，原理通用的", "w": ["绝对不行", "只能用于汽车", "只能用于食品"] },
                { "q": "在未来态中，一旦实现了连续流，推式箭头将变为？", "a": "无箭头（工序合并）或拉动/FIFO", "w": ["更粗的推式箭头", "闪电", "消失"] },
                { "q": "Lead Time 的单位通常是？", "a": "天 (Days)", "w": ["秒", "分", "年"] },
                { "q": "CT 的单位通常是？", "a": "秒 (Seconds)", "w": ["天", "月", "年"] },
                { "q": "为什么我们要缩短 Lead Time？", "a": "快速响应市场，降低资金占用", "w": ["为了好玩", "为了比赛", "为了增加库存"] },
                { "q": "VSM 是精益转型的？", "a": "蓝图 (Blueprint)", "w": ["终点", "细节", "教条"] },
                { "q": "画 VSM 最好用？", "a": "铅笔和纸 (A3)", "w": ["电脑软件", "油漆", "毛笔"] },
                { "q": "VSM 中的“孤岛”是指？", "a": "被库存隔开的独立工序", "w": ["度假的地方", "食堂", "办公室"] },
                { "q": "节拍时间 (TT) 在 VSM 中写在哪里？", "a": "右上角数据框", "w": ["左下角", "中间", "背面"] },
                { "q": "如果总 Cycle Time < TT，但无法满足需求，原因是？", "a": "换型、故障等非计划停机导致OEE低", "w": ["员工速度慢", "设备老化", "材料问题"] },
                { "q": "VSM 团队应该是？", "a": "跨部门的", "w": ["只有生产部", "只有物流部", "只有老板"] },
                { "q": "如果一个工序是共享资源（如喷涂线），用什么符号？", "a": "工序框内打斜线或阴影", "w": ["画两个框", "不画", "画个圆"] },
                { "q": "VSM 的终极目标是实现？", "a": "按需生产，零浪费", "w": ["零库存", "零人工", "零设备"] },
                { "q": "改善计划 (Implementation Plan) 是？", "a": "实现未来态的具体行动步骤", "w": ["画完图就结束", "空头支票", "愿望清单"] },
                { "q": "Loop (循环) 在 VSM 中指？", "a": "定拍工序之前的拉动循环", "w": ["死循环", "圆圈", "错误"] },
                { "q": "看板计算公式中，(DD x LT x (1+SS)) / 容器容量，DD是？", "a": "日需求量", "w": ["日产量", "日废品", "日库存"] },
                { "q": "水蜘蛛在 VSM 中如何体现？", "a": "物料搬运的连接", "w": ["画个蜘蛛", "不体现", "作为工序"] },
                { "q": "如果发现信息流极其复杂，说明？", "a": "管理混乱，容易出错", "w": ["信息化程度高", "管理先进", "无需改善"] },
                { "q": "价值流经理 (Value Stream Manager) 的职责是？", "a": "对整个价值流的绩效负责，打破部门墙", "w": ["只管生产", "只管销售", "只管采购"] },
                { "q": "VSM 必须由谁亲自去画？", "a": "不仅是工程师，管理者也要参与", "w": ["实习生", "文员", "清洁工"] },
                { "q": "如果 VSM 仅仅挂在墙上不执行，它就是？", "a": "墙纸 (Wallpaper)", "w": ["艺术品", "宝藏", "机密"] },
                { "q": "未来态不是一成不变的，它是？", "a": "下一个当前态", "w": ["永恒的真理", "完美的终点", "不可修改的"] },
                { "q": "VSM 中如何表示批量推动？", "a": "推式箭头", "w": ["拉动箭头", "超市", "FIFO"] },
                { "q": "VSM 分析可以揭示？", "a": "系统性的浪费", "w": ["某个螺丝松了", "某个人迟到了", "某个灯坏了"] },
                { "q": "绘制 VSM 时，一定要记录？", "a": "时间", "w": ["重量", "颜色", "味道"] },
                { "q": "如果库存周转率高，Lead Time 通常？", "a": "短", "w": ["长", "不变", "无关"] },
                { "q": "VSM 是一种（）语言？", "a": "精益通用的", "w": ["英语", "德语", "日语"] },
                { "q": "数据采集必须在？", "a": "最差情况和最好情况之间取典型值", "w": ["取最好值", "取最差值", "取平均值"] },
                { "q": "VSM 有助于？", "a": "统一团队对流程的认知", "w": ["制造矛盾", "浪费时间", "增加隔阂"] },
                { "q": "如果发现 Lead Time 99% 是浪费，应该？", "a": "感到兴奋，因为有巨大改善潜力", "w": ["感到绝望", "辞职", "掩盖数据"] },
                { "q": "定拍工序通常是？", "a": "最靠近客户的连续流末端", "w": ["第一道工序", "中间工序", "仓库"] },
                { "q": "超市必须有？", "a": "标准量、地址、目视化", "w": ["收银员", "购物车", "打折商品"] },
                { "q": "VSM 也能识别（）的浪费？", "a": "物流搬运", "w": ["吃饭", "睡觉", "上厕所"] },
                { "q": "信息流的改善往往能？", "a": "大幅减少牛鞭效应", "w": ["增加库存", "增加波动", "增加误解"] },
                { "q": "VSM 中，External Logistics 指？", "a": "与供应商和客户的物流", "w": ["厂内物流", "线边物流", "工位物流"] },
                { "q": "Monthly / Weekly 指的是？", "a": "信息传递的频率", "w": ["发工资的频率", "放假的频率", "检修的频率"] },
                { "q": "VSM 的全流程包括？", "a": "准备、绘制当前态、绘制未来态、制定计划", "w": ["画画、吃饭、睡觉", "开会、吵架、散会"] },
                { "q": "如果不知道 Takt Time，就无法？", "a": "设计未来态", "w": ["画当前态", "数库存", "看现场"] },
                { "q": "VSM 是一种（）工具？", "a": "纸笔工具 (Pencil and Paper)", "w": ["高科技", "全自动", "声控"] },
                { "q": "VSM 绘制完成后，应该？", "a": "团队签名并承诺实施", "w": ["扔进碎纸机", "藏起来", "甚至烧掉"] },
                { "q": "未来态图中的云朵状图标代表？", "a": "Kaizen Burst (改善点)", "w": ["下雨", "阴天", "多云"] },
                { "q": "VSM 的核心价值在于？", "a": "看清全貌 (Big Picture)", "w": ["看清细节", "看清个人", "看清设备"] },
                { "q": "如果 VSM 显示只有推式生产，没有拉动，说明？", "a": "精益水平较低", "w": ["精益水平很高", "甚至完美", "不需要改善"] },
                { "q": "VSM 属于（）的范畴？", "a": "工业工程 (IE)", "w": ["土木工程", "化学工程", "生物工程"] },
                { "q": "Lead Time 的缩短直接贡献于？", "a": "现金流 (Cash Flow)", "w": ["固定资产", "负债", "甚至亏损"] },
                { "q": "VSM 中的“三角”是？", "a": "敌人的象征（库存是万恶之源）", "w": ["朋友的象征", "财富的象征", "安全的象征"] },
                { "q": "画 VSM 时，要沿着（）走？", "a": "产品流", "w": ["人流", "车流", "气流"] },
                { "q": "VSM 不仅是图，更是？", "a": "对话的平台", "w": ["独角戏", "命令书", "甚至圣旨"] },
                { "q": "通过 VSM，我们可以计算出？", "a": "总 Lead Time 和 总 VA Time", "w": ["总重量", "总长度", "总面积"] },
                { "q": "VSM 适用于？", "a": "多品种小批量和少品种大批量", "w": ["只适合一种模式", "都不适合", "看心情"] },
                { "q": "VSM 的绘制应该限制在？", "a": "特定的产品族", "w": ["全工厂所有产品", "随便几个产品", "看哪个顺眼"] },
                { "q": "如果两个工序之间没有库存，VSM 中怎么画？", "a": "不画三角", "w": ["画个空三角", "画个圆", "画个叉"] }
            ],
            "5S": [
                { "q": "5S中的“整顿”是指？", "a": "将要用的东西按规定摆放（三定）", "w": ["区分要与不要", "打扫卫生", "甚至装饰"] },
                { "q": "5S中的“清扫”是指？", "a": "清除脏污，并进行点检", "w": ["大扫除", "甚至洗澡", "甚至消毒"] },
                { "q": "5S中的“清洁”是指？", "a": "维持前3S的成果，制度化", "w": ["洗衣服", "甚至洗手", "甚至洗脸"] },
                { "q": "5S中的“素养”是指？", "a": "养成遵守规则的习惯", "w": ["读书写字", "甚至礼貌用语", "甚至穿西装"] },
                { "q": "三定原则是？", "a": "定点、定品、定量", "w": ["定人、定机、定料", "定时、定分、定秒", "定天、定地、定人"] },
                { "q": "红牌作战主要用于哪个阶段？", "a": "整理 (Seiri)", "w": ["整顿", "清扫", "清洁"] },
                { "q": "形迹管理 (Shadow Board) 属于？", "a": "整顿/目视化", "w": ["整理", "清扫", "清洁"] },
                { "q": "黄色地胶带通常表示？", "a": "通道或一般区域", "w": ["废品区", "合格品区", "危险区"] },
                { "q": "红色地胶带通常表示？", "a": "不良品区或消防/危险区", "w": ["通道", "良品区", "原料区"] },
                { "q": "蓝色地胶带通常表示？", "a": "原材料或WIP区域", "w": ["危险区", "废品区", "通道"] },
                { "q": "绿色地胶带通常表示？", "a": "合格品或成品区域", "w": ["危险区", "废品区", "原料区"] },
                { "q": "黑黄斑马线表示？", "a": "警示/小心区域", "w": ["安全区域", "通道", "甚至斑马线"] },
                { "q": "5S是（）的基础？", "a": "精益生产", "w": ["质量管理", "安全生产", "成本控制"] },
                { "q": "清扫即（）？", "a": "点检", "w": ["清洁", "整理", "整顿"] },
                { "q": "目视化管理的目的是？", "a": "让异常显而易见", "w": ["让工厂好看", "甚至炫耀", "甚至花钱"] },
                { "q": "红牌作战区的物品如果没有人认领，应该？", "a": "按流程废弃或处理", "w": ["放回原处", "甚至藏起来", "甚至送人"] },
                { "q": "谁负责各自区域的5S？", "a": "该区域的员工", "w": ["清洁工", "甚至保洁阿姨", "甚至总经理"] },
                { "q": "地面画线属于？", "a": "目视化/整顿", "w": ["整理", "清扫", "甚至涂鸦"] },
                { "q": "标识牌属于？", "a": "目视化/整顿", "w": ["整理", "清扫", "甚至广告"] },
                { "q": "5S活动是一次性的吗？", "a": "不是，是持续的", "w": ["是", "甚至一年一次", "甚至检查时做"] },
                { "q": "整顿的目的是减少（）的浪费？", "a": "寻找", "w": ["搬运", "加工", "甚至等待"] },
                { "q": "整理的目的是腾出（）？", "a": "空间", "w": ["时间", "甚至金钱", "甚至人员"] },
                { "q": "5S做得好可以提高？", "a": "安全性与效率", "w": ["工资", "甚至奖金", "甚至职位"] },
                { "q": "如果一个工具很久不用，应该？", "a": "移出工作现场", "w": ["放在手边", "甚至锁起来", "甚至藏起来"] },
                { "q": "定量的目的是？", "a": "防止过量库存和缺货", "w": ["数数", "甚至盘点", "甚至好看"] },
                { "q": "定点的目的是？", "a": "让任何人都能找到", "w": ["固定不动", "甚至粘住", "甚至钉死"] },
                { "q": "最大/最小库存线属于？", "a": "定量/目视化", "w": ["定点", "定品", "甚至装饰"] },
                { "q": "5S检查表的作用是？", "a": "标准化检查内容，发现问题", "w": ["打分", "甚至罚款", "甚至应付"] },
                { "q": "高层管理者在5S中应该？", "a": "以身作则，定期巡查", "w": ["只发命令", "甚至不管", "甚至破坏"] },
                { "q": "5S需要（）参与？", "a": "全员", "w": ["部分人", "甚至管理者", "甚至一线员工"] },
                { "q": "办公区域需要做5S吗？", "a": "需要，甚至电脑文件也要做", "w": ["不需要", "甚至只要车间", "甚至只要仓库"] },
                { "q": "5S与安全的关系？", "a": "5S是安全的前提", "w": ["没关系", "甚至冲突", "甚至对立"] },
                { "q": "不要物是指？", "a": "在规定时间内不需要的物品", "w": ["垃圾", "甚至坏东西", "甚至旧东西"] },
                { "q": "必需品是指？", "a": "当前工作必须的物品", "w": ["好东西", "甚至新东西", "甚至贵东西"] },
                { "q": "5S口号“素养”的核心是？", "a": "守规则", "w": ["有文化", "甚至识字", "甚至礼貌"] },
                { "q": "通道上能不能放东西？", "a": "绝对不能", "w": ["可以放暂存", "甚至可以放垃圾", "甚至可以坐人"] },
                { "q": "消防栓前面应该？", "a": "保持畅通，画警示线", "w": ["堆放杂物", "甚至停车", "甚至放桌子"] },
                { "q": "5S推行初期最难的是？", "a": "整理（舍不得扔）", "w": ["整顿", "清扫", "清洁"] },
                { "q": "5S推行后期最难的是？", "a": "素养（长期坚持）", "w": ["整理", "整顿", "清扫"] },
                { "q": "目视化应该让（）也能看懂？", "a": "外行/陌生人", "w": ["专家", "甚至熟练工", "甚至领导"] },
                { "q": "仪表盘上的红区表示？", "a": "异常/危险范围", "w": ["正常范围", "甚至安全范围", "甚至最佳范围"] },
                { "q": "旋转件的对准标记（防松标记）属于？", "a": "目视化", "w": ["装饰", "甚至涂鸦", "甚至无聊"] },
                { "q": "物品的“家”是指？", "a": "固定的存放位置", "w": ["员工的家", "甚至仓库", "甚至垃圾桶"] },
                { "q": "私人物品应该？", "a": "放入更衣柜，不带入作业区", "w": ["放在工作台", "甚至挂在机器上", "甚至随身带"] },
                { "q": "泄漏的油渍应该？", "a": "立即清扫并查找源头", "w": ["盖上", "甚至不管", "甚至等干了"] },
                { "q": "5S标语的作用是？", "a": "营造氛围，提醒注意", "w": ["装饰", "甚至遮丑", "甚至挡风"] },
                { "q": "5S红牌作战的红牌应该贴在？", "a": "物品上", "w": ["人身上", "甚至墙上", "甚至门上"] },
                { "q": "透明化管理有利于？", "a": "发现内部异常", "w": ["偷窥", "甚至监视", "甚至透光"] },
                { "q": "文件柜的斜线标识是为了？", "a": "发现文件缺失或顺序错误", "w": ["美观", "甚至画画", "甚至无聊"] },
                { "q": "工具使用后应该？", "a": "立即归位", "w": ["下班归位", "甚至明天归位", "甚至不归位"] },
                { "q": "5S定点摄影是指？", "a": "在同一位置、角度拍摄改善前后的照片", "w": ["随便拍", "甚至自拍", "甚至拍风景"] },
                { "q": "改善前后的对比照片用于？", "a": "展示成果，激励员工", "w": ["留念", "甚至存档", "甚至发朋友圈"] },
                { "q": "5S雷达图用于？", "a": "评估5S水平的各维度得分", "w": ["看天气", "甚至打仗", "甚至导航"] },
                { "q": "不要物处理清单需要？", "a": "领导审批", "w": ["随便处理", "甚至自己拿走", "甚至送人"] },
                { "q": "5S责任区地图应该？", "a": "张贴在现场，明确责任人", "w": ["锁在柜子里", "甚至不画", "甚至保密"] },
                { "q": "每天下班前的5S时间通常是？", "a": "5-10分钟", "w": ["1小时", "甚至半天", "甚至不留"] },
                { "q": "清扫时发现设备螺丝松动，这是？", "a": "清扫即点检", "w": ["多管闲事", "甚至运气好", "甚至眼花"] },
                { "q": "5S能不能提高产品质量？", "a": "能，减少脏污和错误", "w": ["不能", "甚至降低", "甚至无关"] },
                { "q": "看板上的字迹应该？", "a": "清晰工整", "w": ["潦草", "甚至艺术", "甚至看不清"] },
                { "q": "5S咨询顾问的作用是？", "a": "指导方法，传授理念", "w": ["替大家做卫生", "甚至发号施令", "甚至看戏"] },
                { "q": "参观通道线一般是？", "a": "绿色或特定颜色", "w": ["红色", "甚至黑色", "甚至隐形"] },
                { "q": "危险化学品柜必须？", "a": "上锁，贴警示标，定点存放", "w": ["敞开", "甚至随便放", "甚至混放"] },
                { "q": "5S是一项？", "a": "全员工程", "w": ["面子工程", "甚至清洁工程", "甚至土木工程"] },
                { "q": "整顿的“三要素”是？", "a": "场所、方法、标识", "w": ["时间、地点、人物", "甚至红、黄、蓝"] },
                { "q": "整理的判断基准是？", "a": "使用频率", "w": ["购买价值", "甚至个人喜好", "甚至体积大小"] },
                { "q": "不常用的东西（如半年一次）应该？", "a": "入库或远距离存放", "w": ["扔掉", "甚至放手边", "甚至放通道"] },
                { "q": "每小时都要用的东西应该？", "a": "放手边", "w": ["放仓库", "甚至放工具箱", "甚至放隔壁"] },
                { "q": "5S能否降低设备故障？", "a": "能，通过清扫发现微缺陷", "w": ["不能", "甚至增加", "甚至无关"] },
                { "q": "5S是简单的还是复杂的？", "a": "知易行难", "w": ["很简单", "甚至很复杂", "甚至不用学"] },
                { "q": "目视化管理让问题？", "a": "无处遁形", "w": ["消失", "甚至隐藏", "甚至变小"] },
                { "q": "5S标准化之后，下一步是？", "a": "持续改善", "w": ["停止", "甚至倒退", "甚至庆祝"] },
                { "q": "“红牌作战”一词源于？", "a": "日本 (Red Tag Strategy)", "w": ["美国", "甚至德国", "甚至中国"] },
                { "q": "5S做得好的工厂，给人的感觉是？", "a": "整洁、有序、士气高昂", "w": ["冷清", "甚至恐怖", "甚至杂乱"] },
                { "q": "5S能不能降低成本？", "a": "能，减少寻找和浪费", "w": ["不能", "甚至增加成本", "甚至浪费钱"] },
                { "q": "5S中的“定品”需要？", "a": "物品名称和编号", "w": ["价格", "甚至重量", "甚至产地"] },
                { "q": "5S中的“定量”需要？", "a": "规定最大和最小数量", "w": ["规定价格", "甚至规定重量", "甚至规定颜色"] },
                { "q": "5S中的“定点”需要？", "a": "区域规划和划线", "w": ["打地基", "甚至盖房子", "甚至买地"] },
                { "q": "5S是一种？", "a": "管理技术", "w": ["清洁技术", "甚至装修技术", "甚至建筑技术"] },
                { "q": "6S比5S多了什么？", "a": "Safety (安全)", "w": ["Save (节约)", "Study (学习)", "Speed (速度)"] },
                { "q": "7S比6S多了什么？", "a": "Save (节约)", "w": ["Service (服务)", "Smart (智能)", "System (系统)"] },
                { "q": "5S最初起源于？", "a": "丰田 (Toyota)", "w": ["福特", "甚至大众", "甚至通用"] },
                { "q": "5S不仅仅是现场，还包括？", "a": "人的思维", "w": ["机器", "甚至地板", "甚至墙壁"] },
                { "q": "整顿之前的步骤是？", "a": "整理", "w": ["清扫", "甚至清洁", "甚至素养"] },
                { "q": "没有整理就做整顿，后果是？", "a": "把垃圾也整顿得很好", "w": ["效果很好", "甚至更省事", "甚至更整齐"] },
                { "q": "5S的最终目的是？", "a": "提升企业体质", "w": ["拿奖", "甚至给领导看", "甚至应付检查"] },
                { "q": "5S活动失败的最常见原因是？", "a": "领导不重视，难以坚持", "w": ["员工不会", "甚至没钱", "甚至没时间"] },
                { "q": "目视化管理是（）的工具？", "a": "自主管理", "w": ["强制管理", "甚至独裁管理", "甚至放任管理"] },
                { "q": "区域线脱落应该？", "a": "及时修补", "w": ["不管", "甚至撕掉", "甚至用粉笔画"] },
                { "q": "5S巡查应该？", "a": "定期进行并打分公示", "w": ["偷偷进行", "甚至不进行", "甚至只表扬"] },
                { "q": "5S是精益生产的？", "a": "入门券", "w": ["毕业证", "甚至学位", "甚至奖杯"] },
                { "q": "做好5S可以减少？", "a": "寻找物品的时间 (Motion Waste)", "w": ["加工时间", "甚至设备时间", "甚至吃饭时间"] },
                { "q": "5S中的颜色管理属于？", "a": "目视化", "w": ["声音管理", "甚至气味管理", "甚至触觉管理"] },
                { "q": "油漆桶应该放在？", "a": "专门的化学品柜", "w": ["随便放", "甚至机台上", "甚至通道上"] },
                { "q": "垃圾桶应该？", "a": "分类并定时清理", "w": ["随便扔", "甚至堆满", "甚至不清理"] },
                { "q": "5S不仅是行动，更是？", "a": "纪律", "w": ["游戏", "甚至娱乐", "甚至表演"] },
                { "q": "车间里的死角应该？", "a": "彻底清扫并消除", "w": ["藏垃圾", "甚至堆杂物", "甚至不管"] },
                { "q": "5S做得好，客户会？", "a": "增加信任感", "w": ["觉得浪费", "甚至觉得太贵", "甚至觉得没用"] },
                { "q": "5S是（）工作？", "a": "每天的", "w": ["每月的", "甚至每年的", "甚至一次性的"] }
            ],
            "TIMWOODS": [
                { "q": "TIMWOODS中的I代表？", "a": "Inventory (库存浪费)", "w": ["Idea (想法)", "Internet (网络)", "Inspection (检查)"] },
                { "q": "TIMWOODS中的M代表？", "a": "Motion (动作浪费)", "w": ["Money (金钱)", "Machine (机器)", "Management (管理)"] },
                { "q": "TIMWOODS中的W代表？", "a": "Waiting (等待浪费)", "w": ["Work (工作)", "Waste (浪费)", "Walk (走路)"] },
                { "q": "TIMWOODS中的第一个O代表？", "a": "Overproduction (过量生产)", "w": ["Overtime (加班)", "Office (办公室)", "Order (订单)"] },
                { "q": "TIMWOODS中的第二个O代表？", "a": "Over-processing (过加工)", "w": ["Operation (操作)", "Option (选项)", "Opportunity (机会)"] },
                { "q": "TIMWOODS中的D代表？", "a": "Defects (不良/返工)", "w": ["Design (设计)", "Detail (细节)", "Delay (延误)"] },
                { "q": "TIMWOODS中的S代表？", "a": "Skills (人才/技能浪费)", "w": ["System (系统)", "Standard (标准)", "Safety (安全)"] },
                { "q": "被精益生产称为“万恶之源”的浪费是？", "a": "过量生产", "w": ["库存", "不良", "等待"] },
                { "q": "过量生产会导致？", "a": "库存增加，掩盖问题", "w": ["效率提高", "成本降低", "质量变好"] },
                { "q": "ECRS中的E代表？", "a": "Eliminate (剔除)", "w": ["Easy (简单)", "Enter (进入)", "Edit (编辑)"] },
                { "q": "ECRS中的C代表？", "a": "Combine (合并)", "w": ["Cut (切割)", "Clean (清洁)", "Control (控制)"] },
                { "q": "ECRS中的R代表？", "a": "Rearrange (重排)", "w": ["Reduce (减少)", "Repair (修理)", "Report (报告)"] },
                { "q": "ECRS中的S代表？", "a": "Simplify (简化)", "w": ["Speed (速度)", "Safe (安全)", "Save (节约)"] },
                { "q": "改善的首选原则是？", "a": "Eliminate (剔除)", "w": ["Combine (合并)", "Rearrange (重排)", "Simplify (简化)"] },
                { "q": "操作员弯腰去取地上的零件，属于？", "a": "动作浪费", "w": ["搬运浪费", "加工浪费", "等待浪费"] },
                { "q": "叉车将物料从A仓库搬到B仓库，属于？", "a": "搬运浪费", "w": ["动作浪费", "库存浪费", "加工浪费"] },
                { "q": "操作员看着机器自动运行，属于？", "a": "等待浪费", "w": ["动作浪费", "加工浪费", "库存浪费"] },
                { "q": "生产了客户还没下订单的产品，属于？", "a": "过量生产", "w": ["战略储备", "高效生产", "库存浪费"] },
                { "q": "对产品内部看不见的地方进行抛光，属于？", "a": "过加工浪费", "w": ["不良浪费", "动作浪费", "搬运浪费"] },
                { "q": "因为做错了而进行返工，属于？", "a": "不良浪费", "w": ["加工浪费", "过加工浪费", "动作浪费"] },
                { "q": "员工有好的建议没被采纳，属于？", "a": "人才浪费", "w": ["等待浪费", "动作浪费", "加工浪费"] },
                { "q": "仓库里堆积如山的物料，属于？", "a": "库存浪费", "w": ["资产", "财富", "安全感"] },
                { "q": "使用滑槽让物料自动滑到下一工序，体现了ECRS的？", "a": "Simplify (简化) / Eliminate (剔除搬运)", "w": ["Combine (合并)", "Rearrange (重排)", "Eliminate (剔除)"] },
                { "q": "取消不必要的签字审批，体现了ECRS的？", "a": "Eliminate (剔除)", "w": ["Combine (合并)", "Rearrange (重排)", "Simplify (简化)"] },
                { "q": "将两道工序由一个人完成，体现了ECRS的？", "a": "Combine (合并)", "w": ["Eliminate (剔除)", "Rearrange (重排)", "Simplify (简化)"] },
                { "q": "调整工序顺序以减少走动，体现了ECRS的？", "a": "Rearrange (重排)", "w": ["Eliminate (剔除)", "Combine (合并)", "Simplify (简化)"] },
                { "q": "使用工装夹具代替手扶，体现了ECRS的？", "a": "Simplify (简化)", "w": ["Eliminate (剔除)", "Combine (合并)", "Rearrange (重排)"] },
                { "q": "增值工作 (VA) 是？", "a": "客户愿意付费的、改变产品形态或性能的工作", "w": ["所有工作", "辛苦的工作", "耗时的工作"] },
                { "q": "非增值但必要 (NNVA) 的工作包括？", "a": "法规要求的检查、发工资等", "w": ["返工", "等待", "搬运"] },
                { "q": "库存被称为“水”，因为它？", "a": "掩盖了水面下的石头（问题）", "w": ["很清澈", "很流动", "很便宜"] },
                { "q": "精益生产的目标是消除？", "a": "Muda (浪费)", "w": ["Mura (波动)", "Muri (超负荷)", "Money (钱)"] },
                { "q": "Mura 是指？", "a": "不均匀/波动", "w": ["浪费", "超负荷", "村庄"] },
                { "q": "Muri 是指？", "a": "超负荷/不合理", "w": ["浪费", "波动", "无理"] },
                { "q": "动作浪费与搬运浪费的区别？", "a": "动作是人动，搬运是物动", "w": ["动作是物动，搬运是人动", "没区别", "动作远，搬运近"] },
                { "q": "提前生产也是？", "a": "过量生产", "w": ["高效", "未雨绸缪", "库存"] },
                { "q": "检验属于？", "a": "非增值活动 (NVA)", "w": ["增值活动 (VA)", "核心活动", "甚至赚钱活动"] },
                { "q": "为什么说库存是浪费？", "a": "占用资金、场地，且掩盖问题", "w": ["因为库存会过期", "因为库存难数", "因为库存重"] },
                { "q": "减少动作浪费的方法通常利用？", "a": "动作经济原则", "w": ["购买机器人", "增加人员", "减少产量"] },
                { "q": "将工具放在伸手可得的地方，是为了消除？", "a": "动作浪费 (寻找/移动)", "w": ["搬运浪费", "库存浪费", "等待浪费"] },
                { "q": "如果一个工序CT是30秒，另一个是60秒，会导致？", "a": "等待浪费 (线不平衡)", "w": ["效率提升", "库存减少", "质量变好"] },
                { "q": "过度包装属于？", "a": "过加工浪费", "w": ["过量生产", "不良浪费", "搬运浪费"] },
                { "q": "生产线的长度越长，通常会导致？", "a": "搬运和动作浪费增加", "w": ["效率越高", "质量越好", "管理越容易"] },
                { "q": "大批量生产容易导致？", "a": "过量生产和库存", "w": ["单件流", "低成本", "快速交付"] },
                { "q": "JIT (Just In Time) 旨在消除？", "a": "库存和等待", "w": ["人工", "设备", "质量"] },
                { "q": "设备故障会导致？", "a": "等待浪费", "w": ["过加工", "过量生产", "动作浪费"] },
                { "q": "换型时间长会导致？", "a": "大批量生产 (过量生产)", "w": ["小批量生产", "单件流", "库存降低"] },
                { "q": "ECRS原则通常用于？", "a": "方法改善", "w": ["设备购买", "人员招聘", "财务核算"] },
                { "q": "消除浪费的起点是？", "a": "识别浪费 (学习去看)", "w": ["消除浪费", "制造浪费", "忽略浪费"] },
                { "q": "最难被发现的浪费通常是？", "a": "过加工 (因为看起来在工作)", "w": ["等待", "不良", "搬运"] },
                { "q": "“假装工作”属于？", "a": "等待/动作浪费", "w": ["增值工作", "辛苦工作", "甚至核心工作"] },
                { "q": "单手空闲属于？", "a": "动作浪费", "w": ["等待浪费", "搬运浪费", "加工浪费"] },
                { "q": "转身180度取料属于？", "a": "动作浪费", "w": ["搬运浪费", "加工浪费", "等待浪费"] },
                { "q": "将设备排成U型可以减少？", "a": "走动 (动作浪费)", "w": ["加工时间", "设备故障", "不良品"] },
                { "q": "自动化检测设备可以消除？", "a": "人工检验 (NVA) 和 不良 (Defects)", "w": ["库存", "搬运", "等待"] },
                { "q": "如果Lead Time为10天，实际加工时间为1小时，说明？", "a": "存在大量等待和库存浪费", "w": ["效率很高", "正常现象", "无法改善"] },
                { "q": "精益生产认为，除了增值活动，其他都是？", "a": "浪费", "w": ["必要", "有用", "资产"] },
                { "q": "减少批量大小 (Batch Size) 可以？", "a": "暴露问题并减少库存", "w": ["增加库存", "掩盖问题", "降低效率"] },
                { "q": "看板拉动系统可以防止？", "a": "过量生产", "w": ["不良", "动作浪费", "过加工"] },
                { "q": "Andon系统有助于减少？", "a": "不良 (及时发现) 和 等待 (及时响应)", "w": ["库存", "搬运", "过加工"] },
                { "q": "防错装置 (Poka Yoke) 消除？", "a": "不良浪费", "w": ["库存浪费", "搬运浪费", "动作浪费"] },
                { "q": "改善提案制度旨在减少？", "a": "人才浪费", "w": ["纸张浪费", "时间浪费", "甚至金钱浪费"] },
                { "q": "价值流图 (VSM) 是识别（）的工具？", "a": "浪费", "w": ["增值", "资产", "人员"] },
                { "q": "如果一个步骤客户不付钱，它就是？", "a": "浪费", "w": ["赠品", "服务", "优惠"] },
                { "q": "将分散的仓库集中起来，可能减少？", "a": "库存 (共享安全库存)", "w": ["搬运", "动作", "等待"] },
                { "q": "将工具悬挂在弹簧平衡器上，属于？", "a": "Simplify (简化)", "w": ["Eliminate (剔除)", "Combine (合并)", "Rearrange (重排)"] },
                { "q": "用脚踏开关代替手按开关，属于？", "a": "Simplify (简化) / 动作改善", "w": ["Eliminate (剔除)", "Combine (合并)", "Rearrange (重排)"] },
                { "q": "将两个零件设计成一个整体，属于？", "a": "Combine (合并) / Eliminate (剔除组装)", "w": ["Simplify (简化)", "Rearrange (重排)", "Eliminate (剔除)"] },
                { "q": "调整作业台高度以适应员工身高，减少？", "a": "动作浪费 (疲劳)", "w": ["搬运浪费", "库存浪费", "等待浪费"] },
                { "q": "多能工轮岗可以减少？", "a": "等待 (平衡负荷) 和 人才浪费", "w": ["库存", "搬运", "过加工"] },
                { "q": "SMED (快速换模) 的目的是减少？", "a": "换型时间 (停机等待) 和 批量", "w": ["加工时间", "动作时间", "搬运时间"] },
                { "q": "物料配送采用水蜘蛛 (Water Spider) 可以减少作业员的？", "a": "走动 (动作/搬运) 浪费", "w": ["加工浪费", "等待浪费", "库存浪费"] },
                { "q": "如果一个报表没人看，制作报表是？", "a": "过加工浪费", "w": ["必要工作", "增值工作", "辛苦工作"] },
                { "q": "过度设计 (Over-engineering) 属于？", "a": "过加工浪费", "w": ["过量生产", "不良浪费", "动作浪费"] },
                { "q": "在制品 (WIP) 也是？", "a": "库存浪费", "w": ["有用资产", "半成品", "必要的"] },
                { "q": "浪费的发现需要去？", "a": "现场 (Gemba)", "w": ["办公室", "会议室", "电脑前"] },
                { "q": "七大浪费的提出者是？", "a": "大野耐一 (Taiichi Ohno)", "w": ["丰田佐吉", "亨利福特", "泰勒"] },
                { "q": "第八大浪费 (人才) 是后来补充的，强调？", "a": "尊重人性", "w": ["尊重机器", "尊重钱", "尊重客户"] },
                { "q": "消除浪费是（）的过程？", "a": "永无止境", "w": ["一次性", "短期", "简单"] },
                { "q": "如果浪费消除了，成本会？", "a": "降低", "w": ["升高", "不变", "不确定"] },
                { "q": "如果浪费消除了，效率会？", "a": "提高", "w": ["降低", "不变", "不确定"] },
                { "q": "如果浪费消除了，Lead Time会？", "a": "缩短", "w": ["延长", "不变", "不确定"] },
                { "q": "ECRS分析表是？", "a": "改善工具", "w": ["统计工具", "绘图工具", "计算工具"] },
                { "q": "为了消除搬运，最好的方法是？", "a": "改变布局 (Layout)", "w": ["买更快的叉车", "雇更多人", "甚至用飞机"] },
                { "q": "为了消除等待，最好的方法是？", "a": "线平衡 (Line Balancing)", "w": ["让机器跑快点", "让人跑快点", "甚至增加库存"] },
                { "q": "为了消除不良，最好的方法是？", "a": "源头防错", "w": ["加强检验", "甚至返工", "甚至报废"] },
                { "q": "为了消除过量生产，最好的方法是？", "a": "拉动系统 (Pull) 和 均衡化", "w": ["推式生产", "甚至加大批量", "甚至不管"] },
                { "q": "为了消除库存，最好的方法是？", "a": "单件流 (One Piece Flow)", "w": ["建大仓库", "甚至促销", "甚至不管"] },
                { "q": "为了消除动作浪费，最好的方法是？", "a": "动作分析与改善", "w": ["做操", "甚至休息", "甚至不管"] },
                { "q": "为了消除过加工，最好的方法是？", "a": "明确客户标准 (VE/VA)", "w": ["做得更好", "甚至不管", "甚至加价"] },
                { "q": "为了消除人才浪费，最好的方法是？", "a": "授权与提案制度", "w": ["严格管理", "甚至开除", "甚至不管"] },
                { "q": "浪费的反义词是？", "a": "增值 (Value)", "w": ["节约", "甚至赚钱", "甚至效率"] },
                { "q": "精益思想等于？", "a": "消除浪费 + 创造价值", "w": ["消除库存", "甚至消除人员", "甚至消除设备"] },
                { "q": "如果一个操作需要左手拿螺丝，右手拿螺丝刀，ECRS建议？", "a": "使用自动送螺丝机 (Simplify/Combine)", "w": ["练就左右互搏", "甚至不管", "甚至招两个人"] },
                { "q": "将打印机放在办公室角落，导致大家都要走过去，是？", "a": "动作/搬运浪费", "w": ["锻炼身体", "甚至合理布局", "甚至美观"] }
            ]
        };

        // ====== 深度定制的判断题库 (逻辑严密) ======
        const TF_SEEDS = {
            "DM": [
                { "q": "班前会 (Asakai) 可以坐着开，只要大家听清楚就行。", "a": false, "expl": "班前会必须站立进行 (Stand-up meeting)，以保持紧迫感和高效。" },
                { "q": "SQDC 看板中的 'S' 代表 Speed (速度)。", "a": false, "expl": "'S' 代表 Safety (安全)，这是精益生产的第一优先级。" },
                { "q": "日常管理的 '3秒法则' 指管理者应在3秒内通过目视化判断现场是否正常。", "a": true, "expl": "这是目视化管理的核心标准，通过红绿颜色区分异常。" },
                { "q": "当 4M 发生变化时，必须执行初物管理 (First Piece Inspection)。", "a": true, "expl": "4M 变化是产生不良的高风险点，必须进行首件确认。" },
                { "q": "Andon 系统亮红灯时，操作员应继续生产，等待班长到来。", "a": false, "expl": "应立即停止生产 (Stop) 并呼叫 (Call)，遵循不制造不良的原则。" },
                { "q": "班前会的主要目的是为了点名考勤。", "a": false, "expl": "核心目的是工作对齐 (Alignment)、安全宣贯和目标设定。" },
                { "q": "KYT (危险预知训练) 属于质量管理的范畴。", "a": false, "expl": "KYT 属于安全 (Safety) 管理范畴。" },
                { "q": "日常管理是为了维持现状，防止业绩倒退。", "a": true, "expl": "这是日常管理与方针管理（旨在突破）的主要区别。" },
                { "q": "SQDC 看板只要每周更新一次即可，日常波动不影响管理。", "a": false, "expl": "日常管理强调当班/当天节奏，红灯必须当天触发动作与责任人，周更会延迟响应。" },
                { "q": "三现主义强调管理者应该通过报表判断现场，而不是到现场确认。", "a": false, "expl": "三现主义是现场/现物/现实，要求到现场看现物，用事实确认。" },
                { "q": "Andon 的目标是让问题在产生处被停止与处理，而不是事后挑出不良。", "a": true, "expl": "Andon 体现“自働化”，问题要在源头停止并呼叫支援，防止流出。" },
                { "q": "4M 变化点管理的关键之一是先定义“什么算变化”，再规定触发动作。", "a": true, "expl": "没有清晰的变化定义，就无法稳定触发首件确认/加强点检等动作。" },
                { "q": "日常管理指标越多越好，越全面越能管住现场。", "a": false, "expl": "指标过多会稀释注意力；应围绕SQDC等关键指标，做到可视化、可行动、可闭环。" }
            ],
            "PSP": [
                { "q": "5W2H 中的 Who 是为了找出责任人并进行处罚。", "a": false, "expl": "Who 是为了分析与人员技能、班次等相关的规律，精益强调'对事不对人'。" },
                { "q": "鱼骨图 (Fishbone) 适合用于定量数据分析。", "a": false, "expl": "鱼骨图是定性分析工具，用于头脑风暴潜在原因；数据分析应使用帕累托图等。" },
                { "q": "5Why 分析法必须严格问满 5 次为什么。", "a": false, "expl": "原则是问到真因浮现为止，可能是 3 次也可能是 7 次。" },
                { "q": "PDCA 循环中的 A (Act) 仅指采取纠正措施。", "a": false, "expl": "Act 还包含标准化 (Standardize) 和横向展开，以防止问题再发。" },
                { "q": "解决问题的最高境界是预防问题发生。", "a": true, "expl": "从救火到防火，是精益管理的最终目标。" },
                { "q": "能够用数据量化描述问题，是解决问题的第一步。", "a": true, "expl": "模糊的问题描述会导致模糊的解决方案。" },
                { "q": "暂时的围堵措施 (Containment) 等同于根本对策。", "a": false, "expl": "围堵只是止血，根本对策 (Root Cause Countermeasure) 才能防止再发。" },
                { "q": "5Why 可以跳过证据验证，直接写到“系统原因”以提高效率。", "a": false, "expl": "每一层Why都要证据支撑；没有验证会把猜测当真因，导致对策无效。" },
                { "q": "临时对策验证有效后，可以不做标准化，靠班组经验维持。", "a": false, "expl": "不标准化就无法复制与维持，问题容易复发；有效对策必须固化到标准/点检/培训。" },
                { "q": "对策有效性的判定应基于趋势与复发情况，而非单次结果。", "a": true, "expl": "单次改善可能是偶然；应看数据趋势、复发率与过程稳定性来判定有效。" },
                { "q": "帕累托分析可以用于识别主要矛盾，从而做改善优先级排序。", "a": true, "expl": "帕累托强调少数关键原因造成多数问题，用于抓主要原因并排序。" },
                { "q": "鱼骨图的作用是直接确认真因，画完即可执行对策。", "a": false, "expl": "鱼骨图用于头脑风暴潜在原因；真因仍需数据与现场证据验证。" },
                { "q": "一个合格的问题描述通常必须包含 How many（数量/频率）。", "a": true, "expl": "没有数量就无法量化差距与验证改善效果；How many 是问题可验证的关键字段。" }
            ],
            "SW": [
                { "q": "节拍时间 (Takt Time) 是由设备的最快运行速度决定的。", "a": false, "expl": "TT 由客户需求决定，与设备能力无关。" },
                { "q": "如果 Cycle Time (CT) 大于 Takt Time (TT)，说明该工序是瓶颈。", "a": true, "expl": "生产速度慢于客户需求速度，无法满足交付。" },
                { "q": "计算 TT 时，应扣除设备故障和换型时间。", "a": false, "expl": "仅扣除计划停机（如休息、会议）。故障属于管理损失，不应降低 TT 标准。" },
                { "q": "标准手持 (SWIP) 的数量越多越好，可以防止断料。", "a": false, "expl": "SWIP 应是维持标准作业循环所需的'最小'在制品数量。" },
                { "q": "标准作业不仅规定了怎么做，还规定了做多少时间。", "a": true, "expl": "包含 TT、作业顺序和 SWIP 三要素。" },
                { "q": "线平衡率 (LBE) 越低，说明生产线效率越高。", "a": false, "expl": "LBE 越低说明等待浪费越多，效率越低。" },
                { "q": "ECRS 中的 'C' 代表 Clean (清洁)。", "a": false, "expl": "'C' 代表 Combine (合并)。" },
                { "q": "TT 与产能是等价概念，TT 越小表示产能越小。", "a": false, "expl": "TT 是客户需求节奏，TT 越小表示需求越高；产能取决于CT与资源，不与TT等价。" },
                { "q": "CT 的测量建议连续多次采样，并剔除明显异常后取代表值。", "a": true, "expl": "CT要反映“常态过程”，需要多次测量并识别异常点，避免用一次值误判。" },
                { "q": "SWIP 的作用之一是稳定作业循环，数量过多会掩盖问题。", "a": true, "expl": "SWIP过多会让缺料/不平衡被库存掩盖；标准在制应是维持循环所需最小量。" },
                { "q": "线平衡的目标是让每个人都同样忙，忙到没有空档。", "a": false, "expl": "线平衡追求节拍稳定与等待更少，不是让人更累；应以TT与过程稳定为目标。" },
                { "q": "标准作业改善后不需要更新标准作业票，口头传达即可。", "a": false, "expl": "不更新标准会导致回退与人员差异；改善必须固化到标准作业票与培训点检。" },
                { "q": "瓶颈改善的首选策略通常是直接加人或加设备。", "a": false, "expl": "优先用ECRS、方法改善、人机分离等降低CT；盲目加人加设备成本高且可能引入新浪费。" }
            ],
            "VSM": [
                { "q": "VSM 与普通流程图的区别在于它包含了信息流和时间线。", "a": true, "expl": "这是 VSM 的核心特征，用于识别系统性浪费。" },
                { "q": "Lead Time (交付周期) 通常短于 Processing Time (加工时间)。", "a": false, "expl": "由于大量库存和停滞，LT 通常远长于 VA 时间（增值比 < 1%）。" },
                { "q": "VSM 中的推式箭头 (黑白格) 代表精益的拉动生产。", "a": false, "expl": "推式箭头代表按计划生产 (Push)，容易造成过量生产。" },
                { "q": "超市 (Supermarket) 是用来存放无限量库存的地方。", "a": false, "expl": "超市是受控的拉动系统，有明确的最高和最低库存水位。" },
                { "q": "定拍工序 (Pacemaker) 是全厂唯一接收生产计划的工序。", "a": true, "expl": "这是实现连续流和拉动的关键控制点。" },
                { "q": "未来态 (Future State) 规划应尽量实现单件流。", "a": true, "expl": "单件流是消除库存和等待的最佳方式。" },
                { "q": "未来态图不需要绑定参数（节拍、批量、补给周期），画出流程即可。", "a": false, "expl": "没有参数就无法落地；未来态必须明确拉动点、补给节奏、批量与换型等关键约束。" },
                { "q": "定拍工序一定是全价值流中节拍最慢、CT 最大的工序。", "a": false, "expl": "定拍工序是计划唯一入口与节奏控制点，不等同于瓶颈；选择要综合考虑信息流与可控性。" },
                { "q": "推式系统往往带来过量生产与库存，从而拉长 Lead Time。", "a": true, "expl": "推式按计划生产，容易过量生产；库存与等待会拉长交付周期。" },
                { "q": "时间线的一个关键用途是量化等待与停滞，从而定位主要浪费。", "a": true, "expl": "把加工与等待分开，才能看到浪费主要发生在哪里并形成改善优先级。" },
                { "q": "增值比率越高，通常说明系统性浪费越少。", "a": true, "expl": "增值比率=增值时间/总Lead Time，越高说明等待/库存等浪费占比更低。" }
            ],
            "5S": [
                { "q": "5S 中的清扫 (Seiso) 仅仅是为了让车间看起来干净。", "a": false, "expl": "清扫即点检 (Inspection)，目的是发现微小的异常（如漏油、螺丝松动）。" },
                { "q": "红牌作战 (Red Tag) 主要用于 5S 的整理阶段。", "a": true, "expl": "用于区分要与不要，将隐性库存显性化。" },
                { "q": "根据哈尔斯 VCS 标准，红色区域通常用于存放合格品。", "a": false, "expl": "红色通常表示不良品区、危险区或消防设备；合格品一般用绿色。" },
                { "q": "5S 的最终目的是为了应付客户参观。", "a": false, "expl": "目的是构建异常探测系统，提升企业体质。" },
                { "q": "三定原则是指：定点、定品、定量。", "a": true, "expl": "这是整顿 (Seiton) 的核心，旨在消除寻找的浪费。" },
                { "q": "素养 (Shitsuke) 是 5S 中最难坚持的一环。", "a": true, "expl": "因为它涉及到人员习惯和文化的改变。" },
                { "q": "清扫中发现的漏油、松动属于设备管理问题，与 5S 无关。", "a": false, "expl": "清扫即点检，发现异常并推动处理是5S的重要价值，能提前暴露设备隐患。" },
                { "q": "三定中的“定量”需要设定上限/下限，才能触发补给与异常暴露。", "a": true, "expl": "没有数量阈值就无法判断缺料或过量，定量本质是用标准让异常可见。" },
                { "q": "5S 稽核的作用只是打分排名，不需要结合对策改善。", "a": false, "expl": "稽核是发现差距与推动对策的机制；只打分不改善会导致形式化。" },
                { "q": "素养可以通过一次集中整顿活动完成，之后无需维持机制。", "a": false, "expl": "素养靠长期机制：标准化、教育训练、日常点检与稽核，形成习惯才算完成。" },
                { "q": "红牌作战中“暂时保留”的物品也需要设定期限与处置方式。", "a": true, "expl": "没有期限会变成永久堆放；红牌的价值在于推动决策与清理隐性库存。" },
                { "q": "5S 与安全没有直接关系，主要是提升现场美观。", "a": false, "expl": "5S是安全基础：通道畅通、标识清晰、异常可见，能显著降低事故风险。" }
            ],
            "TIMWOODS": [
                { "q": "在八大浪费中，库存 (Inventory) 被认为是万恶之源。", "a": false, "expl": "过量生产 (Overproduction) 才是万恶之源，因为它导致了库存和其他所有浪费。" },
                { "q": "检验员的工作属于增值活动 (Value Added)。", "a": false, "expl": "检验属于非增值活动 (NVA)，虽然必要，但不改变产品形态或性能。" },
                { "q": "ECRS 改善原则中，首先应该考虑的是 Simplify (简化)。", "a": false, "expl": "首先应考虑 Eliminate (剔除)，如果不做就能解决问题，成本最低。" },
                { "q": "人员的动作 (Motion) 浪费和物料的搬运 (Transportation) 浪费是一回事。", "a": false, "expl": "Motion 指'人'的多余动作；Transportation 指'物'的移动。" },
                { "q": "等待 (Waiting) 浪费通常是由于线不平衡或缺料引起的。", "a": true, "expl": "人或机器闲置无法创造价值。" },
                { "q": "过量生产 (Overproduction) 常被认为是其他浪费的根源之一。", "a": true, "expl": "过量生产会制造库存与等待，并掩盖质量与效率问题，牵引其他浪费发生。" },
                { "q": "动作浪费只指走动距离，不包含弯腰、伸手、扭转等多余动作。", "a": false, "expl": "动作浪费包含所有多余动作：走动、伸手、弯腰、寻找、转身等。" },
                { "q": "过度加工 (Over-processing) 的常见原因之一是客户标准不清或过度追求完美。", "a": true, "expl": "没有明确标准容易做多做过；应以客户价值与标准为准做VE/VA。" },
                { "q": "等待浪费通常只能通过增加人员或加班来解决。", "a": false, "expl": "等待多由不平衡、缺料、换型、故障等引起；应通过线平衡、拉动、稳定化等解决。" },
                { "q": "ECRS 的四步可以随意跳过或颠倒顺序，不影响改善质量。", "a": false, "expl": "ECRS强调先E再C/R/S，先取消无价值动作成本最低，顺序是方法论核心。" },
                { "q": "人才浪费不仅是缺人，更包括员工技能未被使用或建议不被采纳。", "a": true, "expl": "人才浪费强调“能力未发挥”，通过授权、提案制度与多能工培养来改善。" }
            ]
        };

        function sanitizeText(text) {
            if (typeof text !== 'string') return text;
            return text.replace(/甚至\s*/g, '').replace(/\s{2,}/g, ' ').trim();
        }

        function normalizeWhitespace(s) {
            return String(s || '').replace(/\s+/g, ' ').trim();
        }

        function isBannedOption(text) {
            const t = normalizeWhitespace(text);
            if (!t) return true;
            const banned = [
                '碎纸机', '烧掉', '迷路', '洗澡', '洗手', '洗脸', '自拍', '朋友圈', '斑马线', '圣旨', '独角戏',
                '飞机', '打仗', '导航', '恐怖', '礼貌用语', '穿西装', '总经理', '保洁阿姨', '炫耀', '涂鸦',
                '垃圾', '倒霉', '诅咒', '躺着', '蹲着', '懒惰', '万恶之源', '百丑遮',
                '颜色好看', '省钱', '模仿军队', '练习打钩', '私人八卦', '零食', '倒水', '跑步比赛', '饭后散步', '跳跃'
            ];
            return banned.some(w => t.includes(w));
        }

        function hashString(s) {
            let h = 2166136261;
            const str = String(s || '');
            for (let i = 0; i < str.length; i++) {
                h ^= str.charCodeAt(i);
                h = Math.imul(h, 16777619);
            }
            return h >>> 0;
        }

        function dedupeKeepOrder(items) {
            const seen = new Set();
            const out = [];
            for (const it of items) {
                const key = normalizeWhitespace(it).toLowerCase();
                if (!key || seen.has(key)) continue;
                seen.add(key);
                out.push(normalizeWhitespace(it));
            }
            return out;
        }

        const DISTRACTOR_BANK = {
            DM: [
                '方针管理 (Hoshin Kanri)',
                '标准作业 (Standard Work)',
                '目视化管理 (Visual Management)',
                'TPM (全员生产维护)',
                'JIT (准时化)',
                '安灯 (Andon) 异常呼叫',
                '4M 变化点管理',
                'KYT 危险预知训练'
            ],
            PSP: [
                '5W2H 问题描述',
                '5Why 真因分析',
                '鱼骨图 (因果图)',
                '帕累托分析 (80/20)',
                'PDCA 循环',
                '临时对策 (围堵)',
                '标准化与防复发',
                '数据验证与对策确认'
            ],
            SW: [
                'TT (节拍时间)',
                'CT (循环时间)',
                'SWIP (标准在制品)',
                '线平衡 (LBE)',
                '作业顺序与要点',
                '人机分离与并行作业',
                'ECRS 动作改善',
                '瓶颈工序改善'
            ],
            VSM: [
                'Lead Time (交付周期)',
                'Processing Time (加工时间)',
                '增值/非增值 (VA/NVA)',
                '超市 (Supermarket) 拉动',
                '看板 (Kanban) 补给信号',
                '定拍工序 (Pacemaker)',
                '推式与拉式生产',
                '未来态 (Future State)'
            ],
            '5S': [
                '整理 (Seiri)',
                '整顿 (Seiton)',
                '清扫 (Seiso)',
                '清洁 (Seiketsu)',
                '素养 (Shitsuke)',
                '红牌作战 (Red Tag)',
                '三定 (定品/定量/定位)',
                '责任区与稽核机制'
            ],
            TIMWOODS: [
                '运输浪费 (Transportation)',
                '库存浪费 (Inventory)',
                '动作浪费 (Motion)',
                '等待浪费 (Waiting)',
                '过度加工 (Over-processing)',
                '过量生产 (Overproduction)',
                '缺陷浪费 (Defects)',
                '人才浪费 (Skills)'
            ]
        };

        function pickFallbackWrong(subj, seed, used) {
            const bank = DISTRACTOR_BANK[subj] || [];
            const start = bank.length ? (hashString(`${subj}::${seed && seed.q ? seed.q : ''}`) % bank.length) : 0;
            for (let i = 0; i < bank.length; i++) {
                const item = bank[(start + i) % bank.length];
                const t = sanitizeText(item);
                const key = normalizeWhitespace(t).toLowerCase();
                if (!t || used.has(key) || isBannedOption(t)) continue;
                used.add(key);
                return t;
            }
            return '不完全正确，需要进一步确认';
        }

        function buildMcqExplanation(subj, seed) {
            const q = sanitizeText(seed.q);
            const a = sanitizeText(seed.a);

            // 为每个科目构建详细的解析生成逻辑
            const explanationBuilders = {
                DM: () => buildDMExplanation(q, a),
                PSP: () => buildPSPExplanation(q, a),
                SW: () => buildSWExplanation(q, a),
                VSM: () => buildVSMExplanation(q, a),
                '5S': () => build5SExplanation(q, a),
                TIMWOODS: () => buildTIMWOODSExplanation(q, a)
            };

            const builder = explanationBuilders[subj];
            const detailExplanation = builder ? builder() : '';

            return `正确答案：${a}<br><br>${detailExplanation}`;
        }

        // DM 科目详细解析生成器
        function buildDMExplanation(q, a) {
            const explanations = {
                '日常管理的核心目的': '日常管理 (Daily Management) 是精益生产的"底盘"，其核心目标是维持现状并稳定绩效。与追求突破性目标的方针管理 (Hoshin Kanri) 不同，日常管理关注的是防止退步、保持改进成果。没有稳固的日常管理，任何改善成果都无法持久。这就像盖房子，日常管理是地基，地基不稳，上层建筑再华丽也会倒塌。',
                'SQDC': 'SQDC是现场管理的"仪表盘"和"平衡记分卡"。S代表Safety安全（第一优先级，无灾害天数、未遂事故）；Q代表Quality质量（直通率FPY、客诉）；D代表Delivery交付（计划达成率、UPPH人均时产）；C代表Cost成本（废品金额、加班工时）。管理者应遵循"3秒法则"：3秒内通过颜色（红/绿）判断状态，快速决策。',
                '4M': '4M变化点管理是日常管理的核心工具。Man（人）：人员变动、缺勤、技能不足；Machine（机）：设备故障、维修、换型；Material（料）：供应商更换、原料变异；Method（法）：SOP修改、工艺变更。任何4M变化都必须进行"初物管理"（首件检验），防止变化导致批量不良。',
                '班前会': '班前会 (Asakai/Pre-shift Meeting) 不是点名会，而是"作战部署会"。标准时长5-10分钟，必须站立进行以保持紧迫感。议程：1.人员确认 2.安全宣贯(KYT危险预知) 3.回顾昨日SQDC红绿灯 4.今日目标部署。班前会要在现场 (Gemba) 开，不能在会议室，主持人是班组长。',
                '异常响应': '异常响应的正确流程：发现异常 → 停止生产 (Stop) → 呼叫支援 (Call/Andon) → 等待支援 → 确认恢复 → 记录学习。"三现主义"：现场、现物、现实。管理者要到现场看实物，掌握真实信息，而不是坐在办公室看报告。',
                'Andon': 'Andon系统是异常可视化的核心工具。黄灯：缺料或请求支援；红灯：设备故障或质量异常，停线。Andon的目的是"让问题暴露"，而不是"监控员工"。当Andon亮时，支援团队必须快速响应，否则操作员会失去对系统的信任。',
                '目视化': '目视化管理的最高境界：异常一旦发生，显而易见。任何陌生人进入现场，5秒内能判断正常/异常。目视化不是贴标语，而是让状态透明化，比如：最大/最小库存线、设备状态指示灯、质量看板红绿灯。',
                'PDCA': 'PDCA是持续改善的基础循环。P (Plan)：定义问题、分析原因、制定对策；D (Do)：执行对策；C (Check)：检查效果，验证Gap是否消除；A (Act)：如果有效，进行标准化(Standardization)和横向展开(Yokoten)；无效则重新开始。PDCA是螺旋上升的循环，不是封闭圆环。',
                '标准化': '标准化作业指导书 (SOP) 是标准，不是建议也不是参考。标准作业不是僵化的教条，而是"当前最佳"的作业方法。它是管理者与员工之间的契约，也是持续改善 (Kaizen) 的基准。标准必须随着改善不断更新，否则会束缚改进。',
                'OJT': 'OJT (On the Job Training) 在岗培训是班组长的核心职责。通过TWI-JI (工作指导) 方法：说给他听、做给他看、让他做、纠正他。多能工培养可以应对人员缺勤带来的波动，提高线平衡率。',
                'Gemba': 'Gemba (现场) 是日语"现场"的意思，Gemba Walk (走动管理) 要求管理者定期巡视现场，而不是坐在办公室。只有到现场才能看到真实的问题，听到一线的声音，发现报告中被过滤掉的细节。',
                'TPM': '全员生产维护 (TPM) 的基础是日常清扫和点检。操作工是设备的"第一主人"，要做到"清扫即点检"：发现漏油、松动、异响等微缺陷，及时处理。专业维修是最后的手段，日常维护才是正道。',
                '首件检验': '首件检验的目的是防止批量不良。当4M发生变化后（换班、换料、换模、修机），必须进行首件检验，确认合格后才能批量生产。首件检验不是走过场，而是围堵止血的第一道防线。',
                '红牌作战': '红牌作战是5S整理阶段的强力工具。对不确定或不需要的物品贴红牌，移送到红牌区，冻结期满后处置（废弃、变卖、归位）。红牌作战的目的是将隐性库存显性化，腾出空间，减少寻找浪费。',
                'JIT': 'JIT (Just In Time) 准时化的核心思想：在需要的时间，按需要的量，生产需要的产品。不是越快越好，不是越多越好，不是越早越好，而是"恰到好处"。拉动式生产的信号是看板 (Kanban)，而非计划指令。',
                '一个流': '一个流 (One Piece Flow) 的好处是快速暴露问题，缩短Lead Time。批量生产会掩盖问题，增加库存，延长Lead Time。一个流让问题无处遁形，迫使团队立即解决，而不是等库存积累到一定程度再处理。',
                '水蜘蛛': '水蜘蛛 (Water Spider) 的角色是负责物料配送，让作业员专注于增值工作，而不是来回取料。水蜘蛛也需要标准作业，且要求更高，因为他的节拍要配合多个工位。',
                '防错': '防错 (Poka-Yoke) 装置的作用是即使人为疏忽也不会产生不良。防错的等级：1. 消除（使错误不可能发生）2. 预防（错误发生时报警）3. 检测（错误发生后挑选）4. 依靠人的注意力。最好的防错是消除错误发生的可能性。',
                'OPL': '单点课程 (OPL) 的时长通常是5-10分钟，针对一个具体的知识点或技能点进行培训。OPL的特点：一页纸、一个主题、图文并茂、便于理解。OPL由班组长或资深员工编写，用于班前会培训。',
                '质量责任': '质量的第一责任人是制造者 (操作工)，而不是检验员、质量经理或总经理。"三不原则"：不接收不良、不制造不良、不流出不良。检验是事后把关，制造者才能事前预防。',
                '生产计划': '生产计划未达成时，首先应分析未达成的原因 (Gap Analysis)，而不是修改计划、加班、指责员工或无视。Gap Analysis：实际 vs 计划的差距是多少？在哪里发生的？为什么发生？如何防止再发生？',
                '班组建设': '班组建设的核心是凝聚力与执行力。凝聚力：团队成员互相信任、互相支持；执行力：目标明确、责任清晰、行动迅速。班组建设不是吃喝玩乐，而是通过班会、培训、改善活动建立共同语言和信任。',
                '精益目标': '精益生产追求的目标是零浪费、零不良、零故障、零灾害。这不是绝对意义上的"零"，而是"追求零"的态度和方向。零库存只是一个手段，不是目标。真正的目标是消除浪费，提升价值。'
            };

            // 根据问题关键词匹配解析
            for (const [key, value] of Object.entries(explanations)) {
                if (q.includes(key)) {
                    return value;
                }
            }

            // 默认详细解析
            return `本题考查日常管理 (Daily Management) 的核心原则。<br><br>
                    <strong>深入解析：</strong>${a}体现了精益管理的核心思想——以现场为中心，以数据为依据，以标准化为基础。<br><br>
                    <strong>实际应用：</strong>在现场管理中，这一原则帮助管理者快速识别异常、稳定绩效、防止退步。日常管理是精益屋的地基，没有稳固的日常管理，任何改善成果都无法持久。<br><br>
                    <strong>拓展思考：</strong>如果违反这一原则，可能导致问题被掩盖、改善成果无法维持、团队失去对标准化作业的信任。记住：标准化不是限制自由，而是保障质量的契约。`;
        }

        // PSP 科目详细解析生成器
        function buildPSPExplanation(q, a) {
            const explanations = {
                '5Why': '5Why分析法是挖掘问题根本原因的钻探技术，其核心是"问到底"。原则：问到真因浮现为止，不一定是5次。验证：用"因此" (Therefore) 倒推，逻辑必须通畅。例如：机器停了 → 为什么？保险丝断了 → 为什么？超负荷 → 为什么？轴承润滑不足 → 为什么？油泵吸不上油 → 为什么？油泵磨损且有金属屑 → 真因：没有安装过滤器。对策：安装过滤器并定期点检。如果只问一次Why（保险丝断了），换个保险丝，问题会复发。5Why的目标是找到可行动的真因，而不是归咎于"工人不小心"这种不可控因素。',
                '鱼骨图': '鱼骨图 (Fishbone/石川图/Ishikawa) 是用于头脑风暴的工具，帮助团队从多个角度寻找问题原因。鱼头：问题陈述；大骨 (4M1E)：人 (Man)、机 (Machine)、料 (Material)、法 (Method)、环 (Environment)。鱼骨图的价值不在于画出漂亮的图，而在于激发团队的思考，找到遗漏的因素。使用时要注意：1. 明确问题陈述 2. 鼓励自由畅想，暂不评判 3. 追问"为什么"，深入挖掘 4. 用数据和现场验证，不要凭空猜测。',
                'PDCA': 'PDCA是所有改善活动的基础逻辑，是一个螺旋上升的循环，而非封闭圆环。P (Plan)：定义问题、分析原因、制定对策；D (Do)：小范围执行对策；C (Check)：检查效果，用数据验证Gap是否消除；A (Act)：如果有效，进行标准化(Standardization)和横向展开(Yokoten)；无效则重新回到Plan阶段。PDCA的关键在于"闭环"：问题发生 → 分析真因 → 制定对策 → 执行验证 → 标准化 → 防止复发。很多企业的问题在于"做了"但没有"做完"，只做到D就结束，没有C和A，导致问题重复发生。',
                '5W2H': '5W2H是描述问题的框架，确保问题陈述完整、清晰。What：发生了什么问题？Where：在哪里发生？When：何时发生？Who：与谁有关（技能、班次）？Why：为什么是个问题？影响什么？How：发生的模式是怎样的？How Much：数量、频率、金钱损失。5W2H的价值在于把模糊的"出问题了"变成可分析的"在X时间，Y地点，发生了Z问题，影响W美元损失"，为后续分析打下基础。',
                '问题定义': '问题的定义是：现状与标准（目标）之间的差距 (Gap)。没有标准就没有问题。如果不知道"应该是什么样"，就无法判断"现在有什么不对"。例如：产品有划痕不是问题，"划痕率超过3%的标准"才是问题。员工迟到不是问题，"迟到率超过5%的目标"才是问题。解决问题的第一步是明确标准，然后测量现状，计算Gap。',
                '纠正和纠正措施': '纠正 (Correction) 和纠正措施 (Corrective Action) 是两个层次。纠正治标：处理不良品、修理设备、调整参数，是"止血"。纠正措施治本：找到真因、消除真因、防止复发，是"治病"。例如：产品有划痕，纠正→挑出不良品；纠正措施→找到"治具护套磨损"这个真因，更换护套并加入点检表。很多企业只做纠正不做纠正措施，结果是"天天救火，问题不断"。',
                '防错': '防错 (Poka-Yoke) 设计的等级决定了可靠性。最高等级：消除（使错误不可能发生，如对称设计）；次级：预防（错误发生时报警，如传感器）；再次：检测（错误发生后挑选，如检具）；最差：依靠人的注意力。丰田的思路是：不要相信人会永远正确，要设计让人"不可能犯错"的系统。例如：电池只能按正确方向放入（不对称设计）；传感器检测零件缺失（自动停机）；双按钮启动（防止误操作）。',
                'QC七大手法': 'QC七大手法是质量问题的分析工具。帕累托图 (80/20法则)：识别关键的少数问题；鱼骨图：头脑风暴找原因；直方图：分析数据分布形态；控制图：监控过程是否受控；散点图：分析两个变量的相关性；检查表：收集数据；分层法：数据分类分析。注意：SWOT分析不是QC七大手法，SWOT是战略工具，不是质量问题分析工具。',
                'DMAIC': 'DMAIC 是六西格玛的改进路径。D (Define) 定义：明确问题、客户需求、项目范围；M (Measure) 测量：收集数据，建立基线；A (Analyze) 分析：识别根本原因；I (Improve) 改进：制定并实施对策；C (Control) 控制：标准化，监控，维持成果。DMAIC与PDCA的关系：DMAIC是PDCA的细化和数据化版本，更强调统计分析。',
                '8D报告': '8D 报告是福特汽车开发的解决问题方法。D0：准备和计划；D1：成立小组；D2：描述问题；D3：临时围堵措施（止血）；D4：确定并验证根本原因；D5：选择并验证永久对策；D6：实施永久对策；D7：预防再发生（标准化、横向展开）；D8：表彰团队。8D的关键在于D3（先止血，防止不良流出）和D4（找到真因，不是猜测）。',
                'FMEA': 'FMEA (失效模式与影响分析) 是一种预防性的风险分析工具，用于在设计阶段识别潜在失效模式。RPN (风险顺序数) = 严重度 × 发生度 × 探测度。RPN越高，风险越大，优先处理。FMEA的价值在于"事前预防"而非"事后补救"，在问题发生前就消除隐患。',
                '头脑风暴': '头脑风暴法的原则是自由畅想，暂不评判。数量优先，追求数量；延迟评判，不批评任何想法；搭便车，在他人的想法上延伸；鼓励疯狂的想法，不受束缚。头脑风暴的目的是打破思维定式，激发创新。如果一开始就评判，会抑制参与者的创造力，错失好主意。',
                'A3报告': 'A3报告是一种在一页纸上呈现完整解决过程的工具。它强制思考者"用一页纸说清问题"。结构：背景 → 现状（数据） → 目标 → 根本原因分析 → 对策 → 实施计划 → 效果验证 → 标准化。A3的价值不在于格式，而在于逻辑：让思考可视化，让讨论基于事实和数据，而不是凭空争论。',
                '解决问题态度': '解决问题的态度应该是对事不对人。如果对人不对事，员工会隐瞒问题、推卸责任，问题永远无法解决。丰田的"大野圆圈"：让员工站在圈里观察现场直到发现问题，而不是"画个圈诅咒问题"。这是一种培养观察力和问题意识的方法。',
                '问题解决能力': '解决问题的能力是可以通过训练提高的技能，不是天生的天赋。训练方法：1. 学习工具（5Why、鱼骨图、PDCA）2. 实践应用（用真实问题练手）3. 复盘反思（成功/失败案例总结）4. 导师指导（经验丰富的导师带路）。持续改善 (Kaizen) 的精神是解决问题的根本动力，相信"总有更好的方法"。',
                '科学思维': '丰田解决问题的核心思考方式是科学思维，而非经验主义或教条主义。科学思维：观察 → 假设 → 实验 → 验证 → 结论。例如：观察"机器经常停"，假设"轴承润滑不足"，实验"加强润滑"，验证"停机减少"，结论"假设成立"。如果没有科学思维，会陷入"我觉得"、"应该是"、"差不多"的模糊思维，无法找到真因。',
                '问题冰山': '问题的冰山模型：水面上的事件 (Event) 是可见的现象，水水面下的模式 (Pattern)、系统结构 (Structure)、心智模式 (Mental Model) 是深层原因。例如：机器坏了（事件）→ 维护不及时（模式）→ 没有点检制度（结构）→ "坏了再修"的观念（心智模式）。只处理事件会重复救火，改变心智模式才能治本。',
                '员工智慧': '企业最大的浪费是员工智慧的浪费。只让员工动手不让动脑，是最大的浪费。一线员工最了解现场问题，他们的想法往往最有价值。问题解决型团队的特征是自主性、协作性、数据导向，而非依赖性、对抗性、直觉导向。',
                '数据比观点': '解决问题时，数据比观点重要，因为观点可能带有偏见，数据更客观。观点："我觉得这个问题很严重" → 数据："这个问题每月造成30万损失"。"我认为是因为原料问题" → 数据："原料更换后，不良率从3%上升到8%"。用数据说话，可以减少无谓的争论，聚焦真正的问题。',
                '围堵止血': '对于突发性质量事故，首先要做的是围堵不良品（止血），防止继续流出。围堵措施：隔离可疑批次、加严检验、确认流出范围、通知客户、临时增加防护。注意：围堵是临时措施，不是根本对策。止血后，必须启动问题解决流程，找到真因并消除。',
                '标准化的目的': '标准化是为了防止问题反弹，而不是限制自由或增加文档。改善成果必须通过标准化固化，否则换人就回退。标准化包括：更新SOP、培训员工、设置点检项、修改控制计划。没有标准化的改善是"半途而废"。',
                '横向展开': 'Yokoten (横向展开) 的意义是让一个地方的教训成为全公司的经验。例如：A线发现"治具护套磨损"导致划痕，对策是"点检+更换周期"，B线、C线也有相同治具，应该立即同步这个对策，而不是等B线、C线也出现问题后再解决。横向展开是"举一反三"的具体实践。',
                '三现主义': '三现主义：现场、现物、现实。解决问题时要"现地现物" (Go and See)，因为报告和数据往往过滤了细节。管理者要到现场看实物，观察真实情况，而不是坐在办公室看PPT。大野耐一说："没有数据就没有管理，但数据不能代替现场。"',
                'PSP在精益屋': 'PSP在精益屋中的位置是基础 (与标准化并列)。标准作业是"当前最佳实践"，PSP是"如何找到更好的实践"。没有PSP，标准作业无法改进；没有标准作业，PSP的成果无法维持。两者相辅相成，共同支撑精益屋。'
            };

            for (const [key, value] of Object.entries(explanations)) {
                if (q.includes(key)) {
                    return value;
                }
            }

            return `本题考查问题解决 (PSP) 的核心方法论。<br><br>
                    <strong>深入解析：</strong>${a}体现了科学解决问题的思维模式——基于事实、逻辑严密、闭环管理。<br><br>
                    <strong>实际应用：</strong>在现场问题解决中，这一方法帮助我们避免头痛医头脚痛医脚，而是找到根本原因并彻底解决。问题解决能力是可以训练的，通过不断实践和复盘，每个人都能成为问题解决高手。<br><br>
                    <strong>拓展思考：</strong>记住"问题就是机会"，每个问题背后都隐藏着改善的空间。解决问题的态度应该是对事不对人，这样员工才会愿意暴露问题，而不是隐瞒问题。`;
        }

        // SW 科目详细解析生成器
        function buildSWExplanation(q, a) {
            const explanations = {
                'TT': 'TT (Takt Time 节拍时间) = 净可用工作时间 / 客户需求量。TT是客户需求的脉搏，决定生产线的速度。例如：每天工作8小时（480分钟），客户需求480件，TT = 480/480 = 1分钟/件。这意味着平均每1分钟就要产出一件产品才能满足客户需求。计算TT时，净可用时间要扣除休息、会议等计划停机，但不扣除故障、换型等非计划停机（因为故障和换型是要消除的浪费）。TT是由市场决定的，不是工厂能力决定的。如果CT（循环时间）大于TT，说明产能不足，无法满足客户需求；如果CT小于TT，说明有过量生产或等待浪费。',
                'SWIP': 'SWIP (Standard WIP 标准手持) = ∑(人工时间 + 自动加工时间) / Takt Time，结果向上取整。SWIP是维持标准作业循环所需的"最小"在制品数量，不是最大库存。例如：人工时间20秒，机器自动40秒，TT=60秒，SWIP = (20+40)/60 = 1件。如果算出来是1.2，向上取整为2。SWIP的作用是保证人在机器自动加工时有别的工作可做，避免等待，同时也避免过量生产。SWIP的位置必须是固定的、标准化的，且要有目视化标识。',
                '线平衡率': 'LBE (Line Balancing Efficiency 线平衡率) = (∑各工序CT) / (瓶颈工序CT × 工序数) × 100%。例如：5个工位，CT分别是10, 12, 10, 9, 10秒，瓶颈是12秒，总CT=51秒。LBE = 51 / (12 × 5) = 51 / 60 = 85%。LBE低意味着存在大量等待浪费，改善方法是ECRS (削峰填谷)：把瓶颈工序的一部分工作拆分给其他工序，合并动作，重排顺序，简化动作。目标LBE > 90%。',
                'CT': 'Cycle Time (循环时间) 是作业者完成一个工序实测所需的时间，通常是连续测量10次以上取平均值。CT是客观存在的"实际速度"，而TT是客户要求的"目标速度"。当 CT > TT，为瓶颈，无法满足客户需求；CT < TT，为等待或过量生产。注意：CT不包括非周期性作业（如换刀、加料、清扫），这些应该尽量转化为外部作业或由水蜘蛛进行，以免计入循环时间。',
                '标准作业三要素': '标准作业的三要素是：1. 节拍时间 (TT)：客户需求的节奏 2. 作业顺序 (Work Sequence)：最高效的操作次序 3. 标准手持 (SWIP)：最小在制品数量。这三者是相互关联的：TT决定了生产速度，作业顺序决定了CT，CT和TT决定了SWIP。没有TT就没有目标，没有作业顺序就无法保证质量，没有SWIP就无法维持循环。',
                '标准作业三票': '标准作业三票是：1. 工程别能力表：记录各工序的加工能力、CT、换型时间、设备信息 2. 标准作业组合票：显示人机时间配合，包括手动时间、自动时间、步行时间、等待时间 3. 标准作业票：显示设备布局、物流动线、人员动线、SWIP位置。这三票是标准作业的"宪法"，任何改善后都必须更新三票，否则标准会回退。',
                '山积图': '山积图 (Yamazumi Chart) 用于线平衡分析，纵轴是时间，横轴是工位，堆叠每个工位的手动时间、自动时间、等待时间。山积图直观显示"山峰"（瓶颈工位）和"山谷"（负荷不足工位）。改善方向：削峰（拆分瓶颈）、填谷（合并工作）、消除等待。山积图是线平衡改善的"地图"，没有它，改善就是"盲人摸象"。',
                '少人化': '少人化 (Shojinka) 是根据需求波动灵活调整生产线人数的能力，实现依赖于标准作业和多能工。当需求增加，TT变短，需要增加人员；当需求减少，TT变长，可以减少人员。前提是每个人都是多能工，可以胜任多个工位。少人化不是裁员，而是"灵活应对"，避免"闲时养人，忙时缺人"。',
                '标准作业卡': '标准作业卡 (SOS/Standardized Work Sheet) 主要用于培训和目视化管理，它应该张贴在工位上，让任何人都能看到"标准做法"。内容包括：作业顺序、关键质量点 (Key Point)、安全注意点、标准时间、SWIP位置。标准作业卡不是"摆设"，而是"活文档"，每次改善后都要更新。',
                '人机作业分离': '人机作业分离的目的是人不做机器能做的事（如看守机器），让人的价值和机器的价值都最大化。例如：机器自动加工40秒，人不能傻等40秒，应该把这40秒用于其他工位的工作。实现方法是：自动化设备（机器自动完成后报警或停机，人不需要看守）、多机床看管（一个人看多台机器）、外部作业准备（停机前就把工具、材料准备好）。',
                'TWI-JI': 'TWI-JI (Training Within Industry - Job Instruction) 是标准作业培训的最佳方法，也称"工作指导法"。步骤：1. 说给他听（讲清楚）2. 做给他看（示范标准动作）3. 让他做（让学员操作）4. 纠正他（指出偏差，强化正确）。TWI-JI的核心是"分解动作"，把复杂操作拆成简单步骤，让学员逐步掌握。没有TWI-JI，标准作业培训就是"看一遍就会"，结果"各做各的"。',
                'Therblig': 'Therblig (动素) 分析用于微观动作研究，把人的动作拆分成18个基本动素：伸手、抓取、移动、定位、装配、使用、拆卸、检查、预定位、放手、寻找、选择、计划、持住、休息、延迟、故延、思考。通过动素分析，可以发现"无效动作"（如寻找、选择、等待），并优化为"有效动作"（如抓取、装配、使用）。动素分析是"动作经济原则"的基础。',
                'PTS': 'PTS (Predetermined Time Standard 预定时间标准法) 可以在不观测现场的情况下设定标准时间，如MTM、MOST等方法。PTS把所有动作分解成基本动素，每个动素都有标准时间（如"伸手25cm"需要X秒）。PTS的价值在于：1. 新产品设计阶段就可以预估工时 2. 不需要现场测量 3. 方法变更时快速更新时间。但PTS需要专业人员，且不如现场观测准确。',
                '标准时间的设定': '标准时间的设定应该基于熟练工人的正常速度，而不是最快工人或最慢工人的速度。标准时间 = 观测时间 × 评比系数 × (1 + 宽放率)。宽放包括：生理宽放（上厕所、喝水）、疲劳宽放（恢复体力）、作业宽放（不可避免的延迟）。观测时间通常需要测量10次以上，剔除异常值（太快或太慢的数据），取平均值。',
                '作业顺序': '作业顺序是指作业员在周期内最高效的操作次序，不是产品工艺流程。例如：产品工艺流程是A→B→C→D，但作业员的操作顺序可能是A→C→B→D（根据工位布局和动作经济原则）。作业顺序应该避免交叉迂回和空手等待，尽量采用U型线、逆时针巡回（大部分人是右撇子，便于取放料）。',
                '标准作业的前提': '标准作业的前提是过程稳定 (4M稳定)：人（技能稳定）、机（设备稳定）、料（质量稳定）、法（工艺稳定）。如果4M不稳定，测量出的CT会忽高忽低，标准作业就无法建立。因此，标准作业前要先做4M变更管理、设备维护、原料控制、工艺验证。',
                '改善的循环': '标准作业改善的循环是：观察（测量现行CT）→ 分析（找瓶颈）→ 改善（ECRS）→ 新标准（更新三票）。这是一个永无止境的循环，不是"一次改善，终身受益"。记住：标准作业是"当前最佳"，不是"永远最佳"。今天的"标准"就是明天的"改善起点"。',
                'U型线': 'U型线内侧宽度一般建议为1.2米-1.5米，便于作业员跨越。U型线的优势：1. 灵活调配人员（需求少时少人，需求多时多人）2. 减少搬运 3. 便于沟通 4. 易于实现"水蜘蛛"配送。逆时针巡回有利于右撇子操作。',
                '标准手持量': '标准手持量过多会掩盖工序间的不平衡和微小停顿。例如：如果工序间有10件库存，即使上游停顿5分钟，下游也不会断料，问题就被掩盖了。正确的做法是：把SWIP降到最小（按计算值），问题立即暴露，然后解决。这就是"水落石出理论"：库存是水面，库存低了，石头（问题）就露出来了。'
            };

            for (const [key, value] of Object.entries(explanations)) {
                if (q.includes(key)) {
                    return value;
                }
            }

            return `本题考查标准作业 (Standard Work) 的核心原理。<br><br>
                    <strong>深入解析：</strong>${a}体现了标准作业的逻辑——以客户节拍为中心，建立稳定的、可重复的作业方法。<br><br>
                    <strong>实际应用：</strong>标准作业不是限制自由的枷锁，而是"当前最佳实践"的体现。它是改善的起点，不是终点。没有标准，就无法知道"哪里需要改善"；没有改善，标准就会变成过时的教条。<br><br>
                    <strong>拓展思考：</strong>标准作业的三要素（TT、作业顺序、SWIP）相互关联，缺一不可。标准作业三票（工程别能力表、组合票、作业票）是标准的"宪法"，任何改善后都必须更新，否则标准会回退。记住：标准化是防止回退的武器，不是束缚创新的绳索。`;
        }

        // VSM 科目详细解析生成器
        function buildVSMExplanation(q, a) {
            const explanations = {
                '增值时间': '增值时间 (VA Value Added) 是指改变产品形态或性能且客户愿意付费的时间。例如：冲压、焊接、喷涂、装配。检验、搬运、等待不是增值时间，客户不愿意为这些付费。理想情况下，VA Time占总Lead Time的比例应该尽可能高，但传统工厂通常 < 1%，说明99%的时间都在浪费。缩短Lead Time是VSM的核心目标。',
                'Lead Time': 'Lead Time (交付周期) = 库存数量 / 日客户需求量。例如：工序间有1000件库存，日需求100件，Lead Time = 1000/100 = 10天。这意味着一个产品从进入这个库存到流出，需要等待10天。Lead Time是"时间线顶部的平直线"，代表非增值时间。VSM的时间线分为两部分：顶部是Lead Time（天），底部是VA Time（秒）。两者差距越大，改善空间越大。',
                '推式生产': '推式生产 (Push) 是按计划生产，不管下道工序是否需要。VSM中用黑白格粗箭头（斑马线）表示。推式的问题：上游生产多少，下游就接收多少，不管下游是否需要，导致库存堆积。例如：A工序计划生产100件，B工序只需要50件，结果50件变成库存。推式是"过量生产"（Overproduction，万恶之源）的根源。',
                '拉动生产': '拉动生产 (Pull) 是按客户信号生产，下道工序需要多少，上道工序就生产多少。VSM中用"超市"（开口向右的U型）或"看板"（小卡片）表示。拉动的优势：只在需要的时候生产需要的量，没有过量生产，库存降低。例如：B工序需要50件，发出看板，A工序只生产50件。拉动的核心是"看板"（Kanban），它是生产或取料的指令。',
                '超市': '超市 (Supermarket) 在VSM中是开口向右的U型符号，代表受控的拉动库存。超市不是大仓库，而是"在无法连续流处设置的水库，水位受控"。超市必须有：标准量（最大/最小库存）、地址（放在哪里）、目视化（一眼看出缺不缺）。超市拉动适用于：无法实现连续流的断点处（如工艺差异、距离远、设备共用）。',
                '定拍工序': '定拍工序 (Pacemaker) 是生产计划下达的唯一工序。传统工厂所有工序都接计划，导致"各自为政"，库存高。精益工厂只有定拍工序接计划，其他工序按拉动补给。定拍工序通常是：最靠近客户的连续流末端。例如：总装线是定拍工序，计划只给它，冲压、焊接等上游工序按超市补给。',
                'EPEI': 'EPEI (Every Part Every Interval) 反映了生产的柔性/换型频率。例如：每天生产A、B、C三种产品，EPEI = 1天；每周生产A、B、C，EPEI = 1周。EPEI越小，柔性越高，库存越低。EPEI受换型时间限制：换型时间长 → EPEI大 → 批量大 → 库存高。缩短换型时间 (SMED) 是降低EPEI的关键。',
                '连续流': '连续流 (Continuous Flow) 是最高效的生产方式，因为它消除了工序间的库存和等待。VSM中，连续流用工序直接连接表示，中间没有库存三角。理想状态：从原材料到成品的整个过程都是连续流，没有停顿。连续流的前提：工序节拍平衡、设备可靠、质量合格、布局紧凑。',
                'FIFO': 'FIFO (First In First Out 先入先出) 用于连接两个工序并限制库存上限。VSM中用"车道"符号表示。FIFO与超市的区别：FIFO是"管道"，有容量上限，满了就停止；超市是"水库"，有上/下限水位。FIFO适用于：上游快下游慢的场合，防止过量生产。',
                'Heijunka': 'Heijunka (均衡化) 是均衡生产及其混流排产的工具。例如：客户需求A产品80件、B产品20件，如果先生产80A再生产20B，会导致A的库存高、B断货。均衡化是把A、B混流排产：A、B、A、B、A、A、B...，这样生产平稳，库存降低。Heijunka Box（负荷均衡框）是实现均衡化的工具。',
                '产品族': '选择适合绘制VSM的产品族是第一步。产品族矩阵 (Product Family Matrix) 用于：列出所有产品和工艺路径，把工艺路径相似的产品归为一个产品族。例如：产品A和产品B都经过冲压→焊接→装配，是同一个产品族，可以画一张VSM。产品C经过注塑→装配，是另一个产品族，需要单独画VSM。',
                '增值比率': '增值比率 (Activity Ratio) = 总增值时间 / 总Lead Time。例如：VA Time = 20分钟，Lead Time = 20天 = 28800分钟，增值比率 = 20 / 28800 = 0.07%。这个数字让人震惊：99.93%的时间都在浪费！增值比率是VSM的"体检报告"，比率越低，改善空间越大。目标：增值比率 > 5%（已经很棒了）。',
                '数据框': '数据框 (Data Box) 记录工序的关键数据：循环时间 (CT)、换型时间 (C/O)、稼动率 (Uptime)、批量 (Batch Size)、操作员数量。数据框不包含操作员的家庭住址等无关信息。数据采集必须在现场 (Gemba)，基于真实数据，不能凭空猜测或用理想值。最差情况和最好情况之间取典型值。',
                'Kaizen Burst': 'Kaizen Burst (爆炸状图标) 代表改善机会/突击周。VSM中用云朵或爆炸形状表示。Kaizen Burst是"未来态的改进计划"，如：缩短换型时间、提高设备稼动率、实施拉动。Kaizen Burst要有负责人、时间表、预期效果。没有Kaizen Burst的未来态图只是"梦想"，不是"计划"。',
                '看板': '看板 (Kanban) 在VSM中用于传递生产或取料指令。生产看板：制造规定数量的产品；取料看板：从上游工序或超市搬运物料；信号看板：批量生产的触发。看板的规则：1. 后工序向前工序取料 2. 前工序只生产被取走的量 3. 没有看板不生产不搬运 4. 看板必须附着在实物上。看板数量 = (日需求 × Lead Time × (1+安全库存)) / 容器容量。',
                '绘制VSM': '绘制VSM最好用铅笔和纸 (A3)，而不是电脑软件。因为：1. 铅笔可以随时修改 2. 团队可以一起画，激发讨论 3. 现场画，看实物，数据真实。电脑画的VSM往往"太漂亮"，不敢修改，失去"对话平台"的作用。VSM必须由不仅是工程师，管理者也要参与，这样才会有执行力。',
                '从后往前': '绘制当前态图时，应该从后往前画 (从客户到供应商)，而不是从前往后。因为：VSM的起点是客户需求，然后反推需要什么工序、什么库存、什么信息。从后往前画能避免"只看自己工序，不看下游需求"的局部优化思维。',
                '未来态': '未来态 (Future State) 通常规划6-12个月的目标，不是10年也不是1周。未来态是"下一个当前态"，不是永恒的真理。一旦实现未来态，就要画新的未来态。PDCA循环：当前态 → 未来态 → 实施 → 新的当前态 → 新的未来态。VSM是精益转型的蓝图，但蓝图不是一成不变的。',
                '价值流经理': '价值流经理 (Value Stream Manager) 的职责是对整个价值流的绩效负责，打破部门墙。传统组织按部门划分（生产部、物流部、质量部），导致"局部最优，整体次优"。价值流经理跨越部门，统筹从原材料到交付的全流程，对Lead Time、库存、成本负责。价值流经理是VSM执行的"推手"。'
            };

            for (const [key, value] of Object.entries(explanations)) {
                if (q.includes(key)) {
                    return value;
                }
            }

            return `本题考查价值流图 (VSM) 的核心分析方法。<br><br>
                    <strong>深入解析：</strong>${a}体现了价值流分析的理念——从整体视角看待流程，用时间线揭示浪费，用信息流规划未来。<br><br>
                    <strong>实际应用：</strong>VSM不同于普通流程图，它包含信息流、物流、时间线三要素，是"精益的战略地图"。通过VSM，我们可以计算出总Lead Time和总VA Time，发现99%的时间都在浪费。这让人震惊，但也让人兴奋，因为改善空间巨大。<br><br>
                    <strong>拓展思考：</strong>VSM的终极目标是实现按需生产、零浪费。未来态不是一成不变的"完美状态"，而是"下一个当前态"。记住：如果VSM仅仅挂在墙上不执行，它就是墙纸 (Wallpaper)。VSM必须由管理者亲自参与，团队签名承诺，才能落地。`;
        }

        // 5S 科目详细解析生成器
        function build5SExplanation(q, a) {
            const explanations = {
                '整理': '整理 (Seiri) 是区分要与不要，核心工具是红牌作战 (Red Tag)。判断基准是使用频率：每小时用→放手边；每天用→放工位；每周用→放附近；每月用→放仓库；半年以上用→入库或废弃。整理的目的不是"扔东西"，而是"腾出空间"。整理最难的阶段是初期（舍不得扔），但只有把不要物清理出去，才能让必需品显现出来。',
                '整顿': '整顿 (Seiton) 是将要用的东西按规定摆放（三定：定点、定品、定量）。整顿的核心是消除"寻找"的浪费。如果你每天花10分钟找工具，一年就是2500分钟 = 52小时 = 6.5个工作日！整顿的原则：任何人（包括新员工、陌生人）都能在30秒内找到需要的东西。整顿的"三要素"是：场所、方法、标识。',
                '清扫': '清扫 (Seiso) 是清除脏污，并进行点检（清扫即点检）。清扫不是大扫除，而是发现微缺陷：漏油、松动、裂纹、异响。清扫时发现的异常必须标识并进入处理流程，否则清扫只是"擦灰尘"。高频异常点要写进点检表：位置、判定标准、处理动作、责任人。清扫是TPM（全员生产维护）的基础。',
                '清洁': '清洁 (Seiketsu) 是维持前3S的成果，制度化。清洁不是洗衣服，而是：将前3S的做法写成标准、纳入培训、建立稽核机制、设定奖惩。没有清洁，前3S会"春风吹又生"，一周后回到原样。清洁的关键是"标准化"和"稽核节奏"：班组自查 + 周巡查 + 月度抽查。',
                '素养': '素养 (Shitsuke) 是养成遵守规则的习惯。素养不是识字或礼貌用语，而是"守规则"。5S的终极目标是培养员工的自律性：没有监督也能按标准操作。素养需要时间：刚开始靠制度，后来靠习惯，最后靠文化。素养最难，但也最重要。',
                '三定': '三定原则是定点、定品、定量。定点：固定位置（有区域规划、划线、地址）；定品：明确物品名称和编号（标识统一）；定量：规定最大和最小数量（水位线，低于最小线触发补给）。三定的目的是让缺料从"事后抱怨"变成"现场异常"，管理者可以及时响应。例如：螺丝盒有最大/最小线，低于最小线，水蜘蛛立即补给。',
                '红牌作战': '红牌作战 (Red Tag Strategy) 用于整理阶段。步骤：1. 挂牌（对不确定或不需要的物品贴红牌）2. 移送（移送到红牌区 Red Tag Area）3. 处置（冻结期满后：废弃、变卖、归位）。红牌作战的目的是将隐性库存显性化，让浪费无处遁形。红牌必须贴在物品上，不能贴在人身上或墙上。红牌区要有台账记录：品名、数量、挂牌日期、处置期限。',
                '目视化': '目视化管理的目的是让异常显而易见，而不是让工厂好看。标准：陌生人（外行）5秒内能判断正常/异常。目视化不是贴标语，而是让状态透明化：最大/最小库存线（一眼看出缺不缺）、设备状态灯（红灯=故障，绿灯=正常）、质量看板（红绿灯显示合格率）。目视化是自主管理的工具，不是强制管理的手段。',
                '颜色标准': '目视化颜色标准 (VCS Visual Control System)：黄色 = 通道线、一般区域分界；红色 = 不合格品区、消防设备、危险品、红牌区；蓝色 = 原材料区、在制品 (WIP)、待检区；绿色 = 合格品区、成品区、安全设施；黑黄斑马 = 警示区域（电柜前、坑洞边缘）。颜色统一的好处：任何员工（包括新员工、临时工）都能快速识别区域功能，避免误入。',
                '定置管理': '定置管理 (Shadow Board 形迹管理) 属于整顿/目视化。工具的轮廓画在板上，一眼看出哪个工具缺失。形迹管理的好处：1. 工具归位（空缺立即可见）2. 防止混放（每个工具有固定的"家"）3. 新员工培训（看轮廓就知道工具放哪）。记住：物品的"家"是固定的存放位置，不是仓库或垃圾桶。',
                '5S检查表': '5S检查表的作用是标准化检查内容，发现问题，而不是打分或罚款。检查表应该包含：整理（不要物清理）、整顿（三定执行）、清扫（点检发现）、清洁（标准更新）、素养（规则遵守）。检查表要有责任人、检查周期、整改要求。5S检查要"定期进行并打分公示"，而不是偷偷进行或不进行。',
                '5S和安全': '5S是安全的前提，不是对立。整理：清理通道，消防栓前不堆物；整顿：危险品上锁、警示标识；清扫：发现油渍、松动等隐患；清洁：安全规程标准化；素养：遵守安全规则。做好5S可以提高安全性与效率。反之，5S差的工厂事故率高，因为障碍物多、地面滑、设备状态差。',
                '5S推行': '5S推行初期最难的是整理（舍不得扔），后期最难的是素养（长期坚持）。5S是"知易行难"：整理、整顿、清扫（行动）容易，清洁、素养（坚持）难。5S活动不是一次性的，而是持续的。5S检查表的作用是标准化检查内容，发现问题。5S咨询顾问的作用是指导方法，传授理念，不是替大家做卫生。',
                '透明化管理': '透明化管理有利于发现内部异常，而不是偷窥或监视。例如：文件柜的斜线标识，发现文件缺失或顺序错误；透明门板，看见内部库存；透明管道，看见流体流动。透明化让问题"无处遁形"，迫使团队及时处理。没有透明化，问题会被掩盖，直到爆发。',
                '定点摄影': '5S定点摄影是指在同一位置、角度拍摄改善前后的照片，用于展示成果，激励员工。定点摄影不是随便拍或自拍。步骤：1. 改善前拍照（固定位置、角度）2. 实施改善 3. 改善后拍照（同一位置、角度）4. 对比展示。定点摄影的价值：可视化改善成果，增强员工成就感，为其他区域提供参考。',
                '5S雷达图': '5S雷达图用于评估5S水平的各维度得分（整理、整顿、清扫、清洁、素养）。雷达图是一个五边形，每个角代表一个S，连接各点形成雷达图。雷达图的作用：1. 识别短板（哪个S得分低）2. 跟踪进步（改善前后对比）3. 横向对比（不同班组比较）。雷达图让5S评估"可视化"，而不是"凭感觉"。',
                '6S': '6S比5S多了Safety (安全)。5S是安全的前提，但安全太重要，所以单独列为第6个S。6S的含义：在5S的基础上，增加安全意识、安全规程、安全隐患排查。7S比6S多了Save (节约)，强调节约能源、节约材料、节约时间。5S/6S/7S的演变：从"现场整理"到"安全意识"到"成本意识"，不断扩展。',
                '5S基础': '5S是精益生产的入门券，不是毕业证。没有5S，精益工具（标准作业、看板、TPM）无法落地，因为现场混乱、数据不准、员工缺乏纪律。5S是"地基"，精益屋是"建筑"。地基不稳，建筑再漂亮也会倒塌。5S最初起源于丰田 (Toyota)，后来被全球制造业采纳。',
                '三要素': '整顿的"三要素"是场所、方法、标识。场所：物品放在哪（区域规划、划线）；方法：怎么放（定位方式、存放工具）；标识：是什么（名称、编号、数量）。缺少三要素中的任何一个，整顿都不完整：没有场所 = 随便放；没有方法 = 放不好；没有标识 = 找不到。',
                '不要物': '不要物是指在规定时间内不需要的物品，不是垃圾或坏东西。例如：半年才用一次的工具、上个月的产品样品、过期的文件。不要物的处理：领导审批 → 废弃/变卖/归位。不要物处理清单需要领导审批，不能私自处理。必需品是指当前工作必须的物品，不是好东西、新东西或贵东西。',
                '5S是管理技术': '5S是一种管理技术，不是清洁技术、装修技术或建筑技术。5S改变的是人的思维和行为，而不仅仅是地板和墙壁。5S是"全员工程"，需要全员参与，不是部分人、管理者或一线员工的事。高层管理者在5S中应该以身作则，定期巡查，而不是只发命令或不管。',
                '5S最终目的': '5S的最终目的是提升企业体质，而不是拿奖、给领导看或应付检查。企业体质包括：员工纪律性、问题意识、改善能力、客户印象。5S做得好的工厂，给人的感觉是整洁、有序、士气高昂。5S失败的常见原因是领导不重视，难以坚持。',
                '5S与成本': '5S能降低成本，减少寻找和浪费。寻找浪费：找不到工具、材料、文件，浪费时间；库存浪费：不要物占空间、资金；质量浪费：脏污导致不良；安全浪费：事故导致损失。做好5S可以减少寻找物品的时间 (Motion Waste)，提高效率。',
                '区域线': '区域线脱落应该及时修补，不能不管或撕掉。区域线是目视化的"边界"，边界模糊，目视化失效。5S巡查要定期进行并打分公示，不能偷偷进行或不进行。5S责任区地图应该张贴在现场，明确责任人，不能锁在柜子里或不画。'
            };

            for (const [key, value] of Object.entries(explanations)) {
                if (q.includes(key)) {
                    return value;
                }
            }

            return `本题考查5S与目视化管理的核心原则。<br><br>
                    <strong>深入解析：</strong>${a}体现了5S的哲学——通过整理、整顿、清扫、清洁、素养五个阶段，建立"异常显现"的现场管理系统。<br><br>
                    <strong>实际应用：</strong>5S绝非简单的打扫卫生。如果一个陌生人在5秒内无法分辨现场的正常与异常，说明5S是失败的。5S是安全的基石，是精益的入门券。没有5S，其他精益工具（标准作业、看板、TPM）无法落地。<br><br>
                    <strong>拓展思考：</strong>5S是"知易行难"：整理、整顿、清扫（行动）容易，清洁、素养（坚持）难。5S的终极目标是培养员工的自律性，而不仅仅是整理现场。记住：5S是一种管理技术，改变的是人的思维和行为。`;
        }

        // TIMWOODS 科目详细解析生成器
        function buildTIMWOODSExplanation(q, a) {
            const explanations = {
                'TIMWOODS': 'TIMWOODS代表八大浪费：T-Transportation（搬运浪费）、I-Inventory（库存浪费）、M-Motion（动作浪费）、W-Waiting（等待浪费）、O-Overproduction（过量生产，万恶之源）、O-Over-processing（过加工浪费）、D-Defects（不良浪费）、S-Skills（人才浪费）。识别浪费是改善的第一步，用TIMWOODS模型逐项检查现场，可以发现大量改善机会。',
                '搬运浪费': 'Transportation (搬运) 是不产生价值的物料移动。如：叉车空跑、动线过长、重复搬运。消除方法：1. 调整布局（U型线、紧凑化）2. 实现连续流（减少工序间库存）3. 使用水蜘蛛（专业配送）。搬运不仅浪费时间和人力，还会增加碰伤、丢失风险。目标：物料"流起来"，而不是"搬来搬去"。',
                '库存浪费': 'Inventory (库存) 掩盖问题（水落石出理论），占用资金和场地。库存是"问题的缓冲垫"：设备故障？用库存顶着。质量不良？用库存顶着。换型时间长？用库存顶着。但库存也是有成本的：资金占用、场地占用、过期风险、管理成本。降低库存会暴露问题，迫使团队解决。这就是"水落石出"：库存（水）低了，问题（石头）就露出来了。',
                '动作浪费': 'Motion (动作) 是<strong>人</strong>的多余活动。如：弯腰、转身、找工具、空手移动。消除方法：1. 动作经济原则（双手并用、减少动作幅度）2. 工装夹具（滑槽、定位销）3. 形迹管理（工具归位）。注意：动作浪费不同于搬运浪费。动作是人的活动，搬运是物的移动。',
                '等待浪费': 'Waiting (等待) 是人或机器闲置。如：缺料、设备故障、等待指令、等待检验。消除方法：1. 线平衡（削峰填谷）2. 设备维护（TPM）3. 拉动式生产（看板）4. 多能工（灵活调配）。等待浪费往往被其他活动掩盖（如"整理"就是等待），需要细致观察才能发现。',
                '过量生产': 'Overproduction (过量生产) 是<span class="k-strong">万恶之源</span>。生产多于或早于客户需求。后果：库存堆积、资金占用、场地浪费、管理复杂。为什么是万恶之源？因为过量生产会导致其他浪费：库存（没卖掉的产品）、搬运（搬运库存）、等待（等待库存消耗）、动作（管理库存）。消除方法：拉动式生产（看板）、小批量生产、按TT生产。',
                '过加工浪费': 'Over-processing (过加工) 是超出客户要求的加工。如：过度抛光（客户不需要镜面）、多余检测（重复检验）、过度包装（豪华包装）。消除方法：1. 明确客户需求（VOC）2. 价值分析（VA/NVA）3. 简化流程。过加工往往源于"我们一直这样做"的思维惯性，而不是客户真正需要。',
                '不良浪费': 'Defects (不良) 导致返工、报废、客诉。不良不仅浪费材料和人工，更会损害客户信任。消除方法：1. 源头管理（防错Poka-Yoke）2. 标准作业（减少变异）3. 自主检验（不制造不良）4. 快速响应（围堵止血）。不良的成本不仅仅是废品价值，还包括返工工时、检验成本、信誉损失、订单损失。',
                '人才浪费': 'Skills (人才浪费) 是未利用员工的智慧。只让动手不让动脑，是最大的浪费。一线员工最了解现场问题，他们的想法往往最有价值。消除方法：1. 改善提案制度（Kaizen Teian）2. 班前会头脑风暴 3. 问题解决型团队 4. OPL（单点课程，员工做讲师）。记住：企业最大的浪费是员工智慧的浪费，而不是材料或时间。',
                'ECRS': 'ECRS改善四原则：E-Eliminate（剔除，首选）、C-Combine（合并）、R-Rearrange（重排）、S-Simplify（简化）。使用顺序：先E（最好的改善是不做），再C（无法剔除时合并），再R（改变顺序），最后S（让动作更简单）。ECRS可以用于任何流程：生产线、办公室、医院、餐厅。例如：用ECRS降低换型时间：E（取消不必要的签字）、C（合并两次测量）、R（把找工具提前到停机前）、S（使用快速定位销）。',
                '改善四原则': 'ECRS改善四原则的应用场景：1. 剔除（Eliminate）：取消不必要的审批、等待、搬运 2. 合并（Combine）：加工与检测合并、两个工序合并 3. 重排（Rearrange）：将检验放到瓶颈工序之前、调整工位顺序 4. 简化（Simplify）：使用工装夹具、滑槽、颜色标识。ECRS不是独立的，而是组合使用。例如：先E，再C，再R，最后S。',
                '价值': '增值 (VA Value Added) 活动是改变产品形态或性能且客户愿意付费的活动，如冲压、焊接、装配。非增值 (NVA Non-Value Added) 活动是客户不愿意付费的，如检验、搬运、等待。精益的核心是消除NVA，最大化VA。理想状态：VA Time > 5%（虽然看起来很低，但传统工厂通常 < 1%）。',
                '水落石出': '水落石出理论：库存是水，问题是石头。库存高，问题被掩盖；库存低，问题暴露。降低库存会暴露：设备故障（没有库存顶着）、质量不良（没有库存可选）、换型时间长（没有库存缓冲）。暴露问题是好事，因为只有暴露了问题，才能解决问题。这就是精益的"降低库存策略"：不是为了库存而库存，而是为了暴露问题而降低库存。',
                '换型时间': '用ECRS降低换型时间：E（取消不必要的签字/等待，把"等确认"改为并行确认）、C（把两次重复测量合并为一次）、R（把"找工具/找夹具"提前到停机前准备，即外部作业）、S（使用快速定位销与颜色标识）。目标：SMED (Single Minute Exchange of Die，单分钟换型)，把换型时间从小时级降到分钟级。换型时间短 → 批量可以小 → 库存可以低 → 柔性高。',
                '浪费识别': '浪费识别的步骤：1. 观察现场（Gemba Walk）2. 用TIMWOODS逐项检查 3. 数据收集（时间研究、库存统计）4. 价值分析（VA vs NVA）5. 帕累托图（识别关键的少数）。浪费识别不是为了指责，而是为了改善。记住：没有完美的流程，只有不断改善的流程。'
            };

            for (const [key, value] of Object.entries(explanations)) {
                if (q.includes(key)) {
                    return value;
                }
            }

            return `本题考查八大浪费 (TIMWOODS) 的识别与ECRS改善方法。<br><br>
                    <strong>深入解析：</strong>${a}体现了精益消除浪费的核心思想——识别非增值活动，用ECRS原则系统性地消除浪费。<br><br>
                    <strong>实际应用：</strong>浪费识别是改善的第一步。用TIMWOODS模型逐项检查现场，可以发现大量改善机会。消除浪费的优先级：先消除过量生产（万恶之源），再消除库存、搬运、等待等。ECRS是消除浪费的工具：E（剔除，最好的改善是不做）→ C（合并）→ R（重排）→ S（简化）。<br><br>
                    <strong>拓展思考：</strong>记住"水落石出理论"：库存是水，问题是石头。降低库存会暴露问题，迫使团队解决。库存不是"缓冲"，而是"问题的遮羞布"。企业最大的浪费是员工智慧的浪费，而不是材料或时间。让员工参与改善，释放他们的智慧，是最大的价值创造。`;
        }

        function normalizeWrongOptions(subj, seed) {
            const ans = sanitizeText(seed.a);
            const used = new Set([normalizeWhitespace(ans).toLowerCase()]);
            const raw = Array.isArray(seed.w) ? seed.w : [];
            const cleaned = raw.map(sanitizeText).map(normalizeWhitespace).filter(Boolean);
            const filtered = cleaned
                .filter(x => {
                    const key = normalizeWhitespace(x).toLowerCase();
                    if (!key || used.has(key)) return false;
                    if (isBannedOption(x)) return false;
                    used.add(key);
                    return true;
                });

            let wrongs = dedupeKeepOrder(filtered);
            if (wrongs.length > 6) wrongs = wrongs.slice(0, 6);

            const targetLen = normalizeWhitespace(ans).length;
            wrongs.sort((a, b) => Math.abs(a.length - targetLen) - Math.abs(b.length - targetLen));

            const picked = [];
            const pickedUsed = new Set([normalizeWhitespace(ans).toLowerCase()]);
            for (const w of wrongs) {
                const key = normalizeWhitespace(w).toLowerCase();
                if (pickedUsed.has(key)) continue;
                pickedUsed.add(key);
                picked.push(w);
                if (picked.length >= 3) break;
            }
            while (picked.length < 3) {
                picked.push(pickFallbackWrong(subj, seed, pickedUsed));
            }
            return picked.slice(0, 3);
        }

        function escapeHtml(s) {
            return String(s)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function optionLabel(idx) {
            if (idx === null || idx === undefined) return '';
            const labels = ['A', 'B', 'C', 'D', 'E', 'F'];
            return labels[idx] || String(idx + 1);
        }

        function toggleExamReport() {
            const box = document.getElementById('exam-report');
            const btn = document.getElementById('toggle-report-btn');
            if (!box || !btn) return;
            const list = document.getElementById('report-list');
            const summary = document.getElementById('report-summary');
            const hidden = (list && list.style.display === 'none');
            if (list) list.style.display = hidden ? 'grid' : 'none';
            if (summary) summary.style.display = hidden ? 'block' : 'none';
            btn.textContent = hidden ? '收起' : '展开';
        }

        function renderExamReport() {
            const box = document.getElementById('exam-report');
            const summary = document.getElementById('report-summary');
            const list = document.getElementById('report-list');
            const btn = document.getElementById('toggle-report-btn');
            if (!box || !summary || !list || !btn) return;

            const total = appState.questions.length;
            let correctCount = 0;
            let unansweredCount = 0;
            const wrongItems = [];

            appState.questions.forEach((q, i) => {
                const userIdx = appState.examAnswers[i];
                if (userIdx === null) unansweredCount++;
                if (userIdx === q.correctIndex) {
                    correctCount++;
                    return;
                }
                const correctOpt = q.options[q.correctIndex];
                const userOpt = (userIdx === null) ? null : q.options[userIdx];
                wrongItems.push({
                    no: i + 1,
                    q,
                    userIdx,
                    userText: userOpt ? userOpt.text : '未作答',
                    correctText: correctOpt ? correctOpt.text : '',
                });
            });

            const wrongCount = total - correctCount;
            summary.textContent = `共 ${total} 题｜答对 ${correctCount} 题｜答错 ${wrongCount} 题｜未答 ${unansweredCount} 题`;

            if (wrongItems.length === 0) {
                list.innerHTML = `<div class="report-item"><div class="report-q">本次全部答对，无错题。</div></div>`;
                box.style.display = 'block';
                btn.textContent = '收起';
                return;
            }

            list.innerHTML = wrongItems.map(item => {
                const questionText = escapeHtml(item.q.text);
                const correctText = escapeHtml(item.correctText);
                const userText = escapeHtml(item.userText);
                const expl = item.q.explanation ? `<div class="report-expl">解析：${escapeHtml(item.q.explanation)}</div>` : '';
                const userLabel = (item.userIdx === null) ? '' : optionLabel(item.userIdx);
                const correctLabel = optionLabel(item.q.correctIndex);

                return `
                    <div class="report-item">
                        <div class="report-q"><span class="report-qno">${item.no}</span>${questionText}</div>
                        <div class="report-rows">
                            <div class="report-row"><span class="label">你的答案</span><span class="bad">${userLabel ? userLabel + '：' : ''}${userText}</span></div>
                            <div class="report-row"><span class="label">正确答案</span><span class="good">${correctLabel ? correctLabel + '：' : ''}${correctText}</span></div>
                        </div>
                        ${expl}
                    </div>
                `;
            }).join('');

            box.style.display = 'block';
            btn.textContent = '收起';
        }

        class QuestionEngine {
            constructor() {
                this.cache = {};
            }

            generateForSubject(subj) {
                let mcqSeeds = QUESTION_SEEDS[subj] || [];
                let tfSeeds = TF_SEEDS[subj] || [];
                let generated = [];
                let idCounter = 1;

                mcqSeeds.forEach(seed => {
                    const normalizedWrongs = normalizeWrongOptions(subj, seed);
                    let options = [
                        { text: sanitizeText(seed.a), isCorrect: true },
                        { text: normalizedWrongs[0] || "以上皆非", isCorrect: false },
                        { text: normalizedWrongs[1] || "不确定", isCorrect: false },
                        { text: normalizedWrongs[2] || "其他", isCorrect: false }
                    ];
                    options.sort(() => Math.random() - 0.5);
                    generated.push({
                        id: `${subj}-MCQ-${idCounter++}`,
                        type: 'MCQ',
                        text: sanitizeText(seed.q),
                        options: options,
                        correctIndex: options.findIndex(o => o.isCorrect),
                        explanation: sanitizeText(seed.expl || seed.e || seed.explanation || '') || buildMcqExplanation(subj, seed)
                    });
                });

                tfSeeds.forEach(seed => {
                    generated.push({
                        id: `${subj}-TF-${idCounter++}`,
                        type: 'TF', 
                        text: `【判断题】${sanitizeText(seed.q)}`,
                        options: [
                            { text: "正确 (Correct)", isCorrect: seed.a === true },
                            { text: "错误 (Incorrect)", isCorrect: seed.a === false }
                        ],
                        correctIndex: seed.a === true ? 0 : 1,
                        explanation: sanitizeText(seed.expl) 
                    });
                });

                return generated.sort(() => Math.random() - 0.5);
            }
        }

        const engine = new QuestionEngine();

        // ================= 业务逻辑控制 (Controller) =================
        
        let appState = {
            mode: null,
            subject: null,
            questions: [],
            currentIndex: 0,
            timer: null,
            timeLeft: 0,
            examAnswers: [],
            userInfo: { auth: null, name: "", id: "", userId: null, avatar: "a1" }
        };

        const AUTH_STORAGE_KEY = 'haers_user_v1';
        let postLoginCallback = null;
        let authView = 'login';

        const AVATAR_OPTIONS = [
            { id: 'a1', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 21v-1a7 7 0 0 1 7-7h2a7 7 0 0 1 7 7v1"/></svg>' },
            { id: 'a2', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-3-3.87"/><path d="M4 21v-2a4 4 0 0 1 3-3.87"/><circle cx="12" cy="7" r="4"/><path d="M16 21v-1a4 4 0 0 0-4-4h0a4 4 0 0 0-4 4v1"/></svg>' },
            { id: 'a3', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3 7 7 .5-5.5 4.5 1.8 7.5L12 18l-6.3 4 1.8-7.5L2 9.5 9 9l3-7z"/></svg>' },
            { id: 'a4', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3l2.2 4.6 5 .7-3.6 3.5.9 5-4.5-2.4-4.5 2.4.9-5L4.8 8.3l5-.7L12 3z"/><path d="M7 21h10"/></svg>' },
            { id: 'a5', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12l2-2 4 4L19 4l2 2L9 18 3 12z"/></svg>' },
            { id: 'a6', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a7 7 0 0 0-7 7c0 2.4 1.2 4.5 3 5.8V22l4-2 4 2v-7.2c1.8-1.3 3-3.4 3-5.8a7 7 0 0 0-7-7z"/></svg>' }
        ];

        function getAvatarSvg(id) {
            const key = String(id || '').trim();
            const found = AVATAR_OPTIONS.find(x => x.id === key);
            return found ? found.svg : AVATAR_OPTIONS[0].svg;
        }

        function renderAvatarPicker(selectedId) {
            const grid = document.getElementById('avatar-grid');
            if (!grid) return;
            const current = String(selectedId || AVATAR_OPTIONS[0].id);
            grid.innerHTML = AVATAR_OPTIONS.map(opt => `
                <button type="button" class="avatar-option ${opt.id === current ? 'selected' : ''}" data-avatar="${opt.id}" onclick="selectAvatar('${opt.id}')">
                    ${opt.svg}
                </button>
            `).join('');
        }

        function selectAvatar(id) {
            appState.userInfo.avatar = String(id || AVATAR_OPTIONS[0].id);
            renderAvatarPicker(appState.userInfo.avatar);
        }

        function isLoggedIn() {
            return !!(appState.userInfo && (appState.userInfo.auth === 'guest' || appState.userInfo.userId));
        }

        function isGuest() {
            return !!(appState.userInfo && appState.userInfo.auth === 'guest');
        }

        function isRegistered() {
            return !!(appState.userInfo && appState.userInfo.auth === 'user' && appState.userInfo.userId);
        }

        function updateNavUser() {
            const chip = document.getElementById('user-chip');
            const nameEl = document.getElementById('nav-user-name');
            const idEl = document.getElementById('nav-user-id');
            const avatarEl = document.getElementById('user-avatar');
            if (!chip || !nameEl || !idEl || !avatarEl) return;

            if (!isLoggedIn()) {
                chip.style.display = 'none';
                nameEl.textContent = '未登录';
                idEl.textContent = '';
                avatarEl.innerHTML = getAvatarSvg(appState.userInfo.avatar || AVATAR_OPTIONS[0].id);
                renderMemoModules();
                return;
            }

            chip.style.display = 'inline-flex';
            nameEl.textContent = appState.userInfo.name || '已登录';
            idEl.textContent = isGuest() ? '员工模式' : (appState.userInfo.id ? `工号 ${appState.userInfo.id}` : '');
            avatarEl.innerHTML = getAvatarSvg(appState.userInfo.avatar || AVATAR_OPTIONS[0].id);
            renderMemoModules();
        }

        function saveSession() {
            if (!isRegistered()) return;
            const payload = {
                userId: appState.userInfo.userId,
                id: appState.userInfo.id,
                name: appState.userInfo.name,
                avatar: appState.userInfo.avatar || AVATAR_OPTIONS[0].id
            };
            localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(payload));
        }

        function loadSession() {
            try {
                const raw = localStorage.getItem(AUTH_STORAGE_KEY);
                if (!raw) return false;
                const data = JSON.parse(raw);
                if (!data || !data.userId || !data.id || !data.name) return false;
                appState.userInfo = { auth: 'user', userId: data.userId, id: data.id, name: data.name, avatar: data.avatar || AVATAR_OPTIONS[0].id };
                return true;
            } catch {
                return false;
            }
        }

        function setAuthView(view) {
            authView = view === 'register' ? 'register' : 'login';
            const title = document.getElementById('auth-title');
            const btn = document.getElementById('auth-primary-btn');
            const tabLogin = document.getElementById('auth-tab-login');
            const tabRegister = document.getElementById('auth-tab-register');
            const avatarPicker = document.getElementById('avatar-picker');
            const aside = document.getElementById('auth-aside');
            const hint = document.getElementById('auth-hint');
            const example = document.getElementById('auth-example');

            const setActive = (el, on) => {
                if (!el) return;
                el.classList.toggle('btn-primary', on);
                el.classList.toggle('btn-outline', !on);
            };

            setActive(tabLogin, authView === 'login');
            setActive(tabRegister, authView === 'register');
            if (title) title.textContent = authView === 'register' ? '注册' : '登录';
            if (btn) btn.textContent = authView === 'register' ? '注册并登录' : '登录';
            if (avatarPicker) avatarPicker.style.display = authView === 'register' ? 'block' : 'none';
            if (aside) aside.style.display = authView === 'login' ? 'grid' : 'none';
            if (example) example.style.display = authView === 'register' ? 'block' : 'none';

            if (hint) {
                const linkStyle = "cursor:pointer; color: var(--klein-blue); font-weight: 950; text-decoration: underline;";
                hint.innerHTML = authView === 'login'
                    ? `没有账号？<span style="${linkStyle}" onclick="setAuthView('register')">去注册</span>。`
                    : `已有账号？<span style="${linkStyle}" onclick="setAuthView('login')">去登录</span>。注册后可同步保存成绩、错题本与笔记本。`;
            }

            if (authView === 'register') renderAvatarPicker(appState.userInfo.avatar || AVATAR_OPTIONS[0].id);
        }

        function openLoginModal(callback) {
            postLoginCallback = typeof callback === 'function' ? callback : null;
            const modal = document.getElementById('login-modal');
            if (modal) modal.style.display = 'flex';
            setAuthView('login');
            setTimeout(() => {
                const el = document.getElementById('user-name');
                if (el) el.focus();
            }, 50);
        }

        function ensureAuth(callback) {
            if (isLoggedIn()) return true;
            guestLogin(true);
            return true;
        }

        function logout() {
            localStorage.removeItem(AUTH_STORAGE_KEY);
            appState.userInfo = { auth: null, name: "", id: "", userId: null, avatar: AVATAR_OPTIONS[0].id };
            guestLogin(true);
            goHome();
        }

        async function deleteAccount() {
            if (!ensureAuth(deleteAccount)) return;
            if (!isRegistered()) {
                alert('员工模式无法注销账号，请先登录/注册。');
                openLoginModal(deleteAccount);
                return;
            }
            const ok = confirm('确认要注销账号吗？\n\n注销后将删除：个人信息、全部考试成绩与错题记录。\n该操作不可恢复。');
            if (!ok) return;

            const payload = {
                userId: appState.userInfo.userId,
                employeeId: appState.userInfo.id,
                name: appState.userInfo.name
            };
            const res = await apiDeleteAccount(payload);
            if (res.ok && res.data && res.data.success) {
                alert('账号已注销。');
                logout();
                return;
            }
            alert(`注销失败：${(res.data && (res.data.error || res.data.message)) || '请稍后重试'}`);
        }

        function setFooterVariant(variant) {
            const home = document.getElementById('footer-home');
            const simple = document.getElementById('footer-simple');
            if (!home || !simple) return;
            if (variant === 'home') {
                home.style.display = 'block';
                simple.style.display = 'none';
            } else {
                home.style.display = 'none';
                simple.style.display = 'block';
            }
        }

        function selectMode(mode) {
            if (!ensureAuth()) return;
            appState.mode = mode;
            const titles = { 'study': '知识学习', 'practice': '强化练习', 'exam': '正式考试', 'bank': '题库解析' };
            document.getElementById('mode-title').textContent = titles[mode] + " - 选择科目";
            document.getElementById('current-mode-display').textContent = titles[mode];
            
            document.getElementById('hero-page').style.display = 'none';
            document.getElementById('subject-page').style.display = 'block';
            setFooterVariant('simple');
            window.scrollTo(0,0);
        }

        function goHome() {
            stopTimer();
            document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');
            document.getElementById('hero-page').style.display = 'block';
            document.getElementById('timer-box').style.display = 'none';
            if (isLoggedIn()) document.getElementById('login-modal').style.display = 'none';
            setFooterVariant('home');
            window.scrollTo(0,0);
        }

        function backToSubject() {
            document.getElementById('study-page').style.display = 'none';
            document.getElementById('bank-page').style.display = 'none';
            document.getElementById('subject-page').style.display = 'block';
            setFooterVariant('simple');
        }

        function startActivity(subj) {
            if (!ensureAuth(() => startActivity(subj))) return;
            appState.subject = subj;

            document.getElementById('subject-page').style.display = 'none';
            if (appState.mode === 'study') initStudy();
            else if (appState.mode === 'practice') initPractice();
            else if (appState.mode === 'bank') initBank();
            else if (appState.mode === 'exam') initExam();
            setFooterVariant('simple');
        }

        const bankState = {
            items: [],
            filtered: [],
            visibleCount: 40,
            showAnswer: true,
            type: 'ALL',
            keyword: ''
        };

        function stripLeadingAnswer(expl) {
            const s = String(expl || '');
            return s.replace(/^正确答案：.*?<br><br>/, '');
        }

        function buildBankItems(subj) {
            const items = [];
            const mcqSeeds = QUESTION_SEEDS[subj] || [];
            const tfSeeds = TF_SEEDS[subj] || [];

            mcqSeeds.forEach((seed, idx) => {
                const rawExpl = sanitizeText(seed.expl || seed.e || seed.explanation || '') || buildMcqExplanation(subj, seed);
                const expl = seed.expl || seed.e || seed.explanation ? sanitizeText(seed.expl || seed.e || seed.explanation || '') : stripLeadingAnswer(rawExpl);
                items.push({
                    no: idx + 1,
                    type: 'MCQ',
                    question: sanitizeText(seed.q),
                    answer: sanitizeText(seed.a),
                    explanation: expl
                });
            });

            const baseNo = items.length;
            tfSeeds.forEach((seed, idx) => {
                items.push({
                    no: baseNo + idx + 1,
                    type: 'TF',
                    question: sanitizeText(seed.q),
                    answer: seed.a === true ? '正确' : '错误',
                    explanation: sanitizeText(seed.expl || '')
                });
            });

            return items;
        }

        function bankApplyFilter() {
            const keyword = normalizeWhitespace(bankState.keyword).toLowerCase();
            const type = bankState.type;

            bankState.filtered = bankState.items.filter(item => {
                if (type !== 'ALL' && item.type !== type) return false;
                if (!keyword) return true;
                const hay = `${item.question} ${item.answer} ${item.explanation}`.toLowerCase();
                return hay.includes(keyword);
            });
        }

        function bankRender() {
            const list = document.getElementById('bank-list');
            const meta = document.getElementById('bank-meta');
            const loadMoreBtn = document.getElementById('bank-load-more');
            const showAnswer = bankState.showAnswer;

            const total = bankState.filtered.length;
            const shown = Math.min(bankState.visibleCount, total);
            meta.textContent = `共 ${total} 题｜已显示 ${shown} 题`;

            list.innerHTML = bankState.filtered.slice(0, shown).map((item, idx) => {
                const q = escapeHtml(item.question);
                const a = escapeHtml(item.answer);
                const expl = item.explanation ? item.explanation : '';

                const answerHtml = showAnswer ? `<div class="bank-a">标准答案：${a}</div>` : '';
                const explHtml = showAnswer && expl ? `<div class="bank-expl">解析：${expl}</div>` : '';

                const typeLabel = item.type === 'MCQ' ? '选择题' : '判断题';
                const noLabel = idx + 1;

                return `
                    <div class="bank-item">
                        <div class="bank-item-head">
                            <div class="bank-badges">
                                <span class="bank-badge no">#${noLabel}</span>
                                <span class="bank-badge type">${typeLabel}</span>
                            </div>
                        </div>
                        <div class="bank-q">${q}</div>
                        ${answerHtml}
                        ${explHtml}
                    </div>
                `;
            }).join('');

            loadMoreBtn.style.display = shown < total ? 'inline-flex' : 'none';
        }

        function bankLoadMore() {
            bankState.visibleCount += 40;
            bankRender();
        }

        function initBank() {
            document.getElementById('bank-page').style.display = 'block';
            document.getElementById('bank-subject-title').textContent = `${KNOWLEDGE_BASE[appState.subject].title} - 题库解析`;

            bankState.items = buildBankItems(appState.subject);
            bankState.visibleCount = 40;
            bankState.keyword = '';
            bankState.type = 'ALL';
            bankState.showAnswer = true;

            const search = document.getElementById('bank-search');
            const typeSelect = document.getElementById('bank-type-filter');
            const toggle = document.getElementById('bank-show-answer');

            search.value = '';
            typeSelect.value = 'ALL';
            toggle.checked = true;

            search.oninput = (e) => {
                bankState.keyword = e.target.value || '';
                bankApplyFilter();
                bankState.visibleCount = 40;
                bankRender();
            };

            typeSelect.onchange = (e) => {
                bankState.type = e.target.value || 'ALL';
                bankApplyFilter();
                bankState.visibleCount = 40;
                bankRender();
            };

            toggle.onchange = (e) => {
                bankState.showAnswer = !!e.target.checked;
                bankRender();
            };

            bankApplyFilter();
            bankRender();
            window.scrollTo(0,0);
        }

        const CERTIFIED_TALENTS = [
            { dept: '一分厂', name: '万海', belt: '绿带' },
            { dept: '二分厂', name: '于成飞', belt: '绿带' },
            { dept: '临安基地', name: '盛鑫泷', belt: '绿带' },
            { dept: '二分厂', name: '李波', belt: '绿带' },
            { dept: '模塑厂', name: '李鹏辉', belt: '绿带' },
            { dept: '模塑厂', name: '吴宗禄', belt: '绿带' },
            { dept: '模塑厂', name: '徐雕', belt: '绿带' },
            { dept: '一分厂', name: '龙群勇', belt: '绿带' },
            { dept: '一分厂', name: '龙奥湾', belt: '绿带' },
            { dept: '一分厂', name: '郭秀峰', belt: '绿带' },
            { dept: '二分厂', name: '程玉林', belt: '绿带' },
            { dept: '模塑厂', name: '孙柏成', belt: '绿带' },
            { dept: '泰哈', name: '刘进伦', belt: '绿带' },
            { dept: '二分厂', name: '刘波', belt: '绿带' },
            { dept: '二分厂', name: '欧宇涛', belt: '绿带' },
            { dept: '模塑厂', name: '郭世良', belt: '绿带' },
            { dept: '模塑厂', name: '周君', belt: '绿带' },
            { dept: '模塑厂', name: '谭联明', belt: '绿带' },
            { dept: '二分厂', name: '刘礼彬', belt: '绿带' },
            { dept: '二分厂', name: '张国', belt: '绿带' },
            { dept: '二分厂', name: '徐海', belt: '绿带' },
            { dept: '一分厂', name: '胡健', belt: '绿带' },
            { dept: '一分厂', name: '肖淋', belt: '绿带' },
            { dept: '一分厂', name: '吴潇男', belt: '绿带' },
            { dept: '临安基地', name: '王瓜亮', belt: '绿带' },
            { dept: '二分厂', name: '武虹', belt: '绿带' },
            { dept: '一分厂', name: '兰国文', belt: '绿带' },
            { dept: '一分厂', name: '马寅杰', belt: '绿带' },
            { dept: '一分厂', name: '蒋志敏', belt: '绿带' },
            { dept: '二分厂', name: '吕涛', belt: '绿带' },
            { dept: '临安基地', name: '张治国', belt: '绿带' },
            { dept: '二分厂', name: '叶传青', belt: '绿带' },
            { dept: '临安基地', name: '杨强', belt: '绿带' },
            { dept: '临安基地', name: '柯细维', belt: '绿带' },
            { dept: '临安基地', name: '焦吉平', belt: '绿带' },
            { dept: '临安基地', name: '孙运生', belt: '绿带' },
            { dept: '临安基地', name: '王建雄', belt: '绿带' },
            { dept: '模塑厂', name: '刘圣权', belt: '绿带' },
            { dept: '一分厂', name: '徐健', belt: '绿带' },
            { dept: '一分厂', name: '乔玉清', belt: '绿带' },
            { dept: '模塑厂', name: '门光辉', belt: '绿带' },
            { dept: '一分厂', name: '杨旋伟', belt: '绿带' },
            { dept: '临安基地', name: '陈金星', belt: '绿带' },
            { dept: '临安基地', name: '郑智彬', belt: '绿带' },
            { dept: '一分厂', name: '林寒', belt: '绿带' },
            { dept: '临安基地', name: '苗帅', belt: '绿带' },
            { dept: '临安基地', name: '郭宁波', belt: '绿带' },
            { dept: '临安基地', name: '朱立平2', belt: '绿带' },
            { dept: '模塑厂', name: '陈烨锋', belt: '绿带' },
            { dept: '模塑厂', name: '邓英', belt: '绿带' },
            { dept: '模塑厂', name: '廖炳威', belt: '绿带' },
            { dept: '模塑厂', name: '宋磊建', belt: '绿带' },
            { dept: '模塑厂', name: '刘勇珍', belt: '绿带' },
            { dept: '临安基地', name: '王文龙', belt: '绿带' },
            { dept: '临安基地', name: '周冬佳', belt: '绿带' },
            { dept: '一分厂', name: '祝灿丽', belt: '绿带' },
            { dept: '一分厂', name: '吉永坚', belt: '绿带' },
            { dept: '一分厂', name: '杨润', belt: '绿带' },
            { dept: '二分厂', name: '张清贵', belt: '绿带' },
            { dept: '二分厂', name: '丁祝芬', belt: '绿带' },
            { dept: '临安基地', name: '虞元林', belt: '绿带' },
            { dept: '二分厂', name: '袁先兵', belt: '绿带' },
            { dept: '二分厂', name: '张四培', belt: '绿带' },
            { dept: '二分厂', name: '王跃峰', belt: '绿带' },
            { dept: '二分厂', name: '陈勇2', belt: '绿带' },
            { dept: '二分厂', name: '涂立', belt: '绿带' },
            { dept: '模塑厂', name: '武丰', belt: '绿带' },
            { dept: '模塑厂', name: '郑景渭', belt: '绿带' },
            { dept: '模塑厂', name: '唐启俊', belt: '绿带' },
            { dept: '模塑厂', name: '梁留浩', belt: '绿带' },
            { dept: '一分厂', name: '熊俐', belt: '绿带' },
            { dept: '临安基地', name: '徐毓斌', belt: '绿带' },
            { dept: '二分厂', name: '包伟俊', belt: '绿带' },
            { dept: '二分厂', name: '李佳', belt: '绿带' },
            { dept: '临安基地', name: '张连杰', belt: '绿带' },
            { dept: '二分厂', name: '陈豪', belt: '绿带' },
            { dept: '一分厂', name: '王百顺', belt: '绿带' },
            { dept: '二分厂', name: '黄文希', belt: '绿带' },
            { dept: '模塑厂', name: '许达万', belt: '绿带' },
            { dept: '模塑厂', name: '吴玉骏', belt: '绿带' },
            { dept: '二分厂', name: '杨增寿', belt: '绿带' },
            { dept: '一分厂', name: '叶杰昂', belt: '绿带' },
            { dept: '临安基地', name: '段志平', belt: '绿带' },
            { dept: '一分厂', name: '曹蕾', belt: '绿带' },
            { dept: '二分厂', name: '余道文', belt: '绿带' },
            { dept: '二分厂', name: '翁芝花', belt: '绿带' },
            { dept: '一分厂', name: '董梅', belt: '绿带' },
            { dept: '模塑厂', name: '孙柏成', belt: '黑带' },
            { dept: '一分厂', name: '龚成才', belt: '绿带' },
            { dept: '模塑厂', name: '周键', belt: '绿带' },
            { dept: '模塑厂', name: '张腾宇', belt: '绿带' },
            { dept: '二分厂', name: '李军', belt: '绿带' },
            { dept: '一分厂', name: '程松涛', belt: '绿带' },
            { dept: '一分厂', name: '杨斌', belt: '绿带' },
            { dept: '模塑厂', name: '易进', belt: '绿带' },
            { dept: '二分厂', name: '邵会阳', belt: '绿带' },
            { dept: '二分厂', name: '王世文', belt: '绿带' },
            { dept: '二分厂', name: '杨伟乾', belt: '绿带' },
            { dept: '二分厂', name: '石小虎', belt: '绿带' }
        ];

        const BADGE_AWARDEES_2025 = [
            { name: '李波', code: 'HBS001', dept: '精益革新办' },
            { name: '李鹏辉', code: 'HBS002', dept: '精益革新办' },
            { name: '孙柏成', code: 'HBS003', dept: '精益革新办' },
            { name: '杨强', code: 'HBS004', dept: '精益革新办' },
            { name: '乔玉清', code: 'HBS005', dept: '精益革新办' },
            { name: '涂立', code: 'HBS006', dept: '精益革新办' },
            { name: '梁留浩', code: 'HBS007', dept: '精益革新办' },
            { name: '唐启俊', code: 'HBS008', dept: '精益革新办' },
            { name: '余道文', code: 'HBS009', dept: '精益革新办' },
            { name: '廖炳威', code: 'HBS010', dept: '精益革新办' }
        ];

        const beltClassName = (belt) => {
            const b = String(belt || '');
            if (b.includes('黑')) return 'black';
            return 'green';
        };

        const talentState = {
            tab: 'list',
            keyword: '',
            dept: 'ALL',
            belt: 'ALL'
        };

        function switchTalentTab(tab) {
            talentState.tab = tab;
            const listBtn = document.getElementById('tab-talent-list');
            const badgeBtn = document.getElementById('tab-talent-badges');
            const panelList = document.getElementById('talent-panel-list');
            const panelBadges = document.getElementById('talent-panel-badges');

            const activeStyle = (btn, on) => {
                btn.classList.toggle('btn-primary', on);
                btn.classList.toggle('btn-outline', !on);
            };

            activeStyle(listBtn, tab === 'list');
            activeStyle(badgeBtn, tab === 'badges');
            panelList.style.display = tab === 'list' ? 'block' : 'none';
            panelBadges.style.display = tab === 'badges' ? 'block' : 'none';
        }

        function openTalentShowcase() {
            if (!ensureAuth(openTalentShowcase)) return;
            document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');
            document.getElementById('hero-page').style.display = 'none';
            document.getElementById('talent-page').style.display = 'block';
            setFooterVariant('simple');
            initTalentShowcase();
            window.scrollTo(0,0);
        }

        function renderTalentFilters() {
            const deptSelect = document.getElementById('talent-dept');
            const beltSelect = document.getElementById('talent-belt');

            const depts = Array.from(new Set(CERTIFIED_TALENTS.map(x => x.dept))).sort((a, b) => a.localeCompare(b, 'zh-CN'));
            const belts = Array.from(new Set(CERTIFIED_TALENTS.map(x => x.belt))).sort((a, b) => a.localeCompare(b, 'zh-CN'));

            deptSelect.innerHTML = ['<option value="ALL">全部部门</option>', ...depts.map(d => `<option value="${escapeHtml(d)}">${escapeHtml(d)}</option>`)].join('');
            beltSelect.innerHTML = ['<option value="ALL">全部带级</option>', ...belts.map(b => `<option value="${escapeHtml(b)}">${escapeHtml(b)}</option>`)].join('');
        }

        function filterTalents() {
            const keyword = normalizeWhitespace(talentState.keyword).toLowerCase();
            const dept = talentState.dept;
            const belt = talentState.belt;

            return CERTIFIED_TALENTS.filter(t => {
                if (dept !== 'ALL' && t.dept !== dept) return false;
                if (belt !== 'ALL' && t.belt !== belt) return false;
                if (!keyword) return true;
                const hay = `${t.dept} ${t.name} ${t.belt}`.toLowerCase();
                return hay.includes(keyword);
            });
        }

        function buildBadgeSet() {
            const set = new Set();
            BADGE_AWARDEES_2025.forEach(x => set.add(String(x.name || '').trim()));
            return set;
        }

        function renderTalentList() {
            const grid = document.getElementById('talent-grid');
            const meta = document.getElementById('talent-meta');

            const filtered = filterTalents();
            const badgeSet = buildBadgeSet();
            const total = filtered.length;

            const byBelt = {};
            filtered.forEach(t => {
                byBelt[t.belt] = (byBelt[t.belt] || 0) + 1;
            });
            const beltSummary = Object.entries(byBelt)
                .sort((a, b) => a[0].localeCompare(b[0], 'zh-CN'))
                .map(([k, v]) => `${k} ${v} 人`)
                .join('｜');

            meta.textContent = `共 ${total} 人${beltSummary ? '｜' + beltSummary : ''}`;

            grid.innerHTML = filtered.map(t => {
                const dept = escapeHtml(t.dept);
                const name = escapeHtml(t.name);
                const belt = escapeHtml(t.belt);
                const beltClass = beltClassName(t.belt);
                const badgeTag = badgeSet.has(String(t.name || '').trim()) ? `<span class="talent-tag badge">绿带徽章</span>` : '';
                return `
                    <div class="talent-card">
                        <div class="talent-head">
                            <div class="talent-name">${name}</div>
                            <div class="talent-tags">
                                <span class="talent-tag ${beltClass}">${belt}</span>
                                ${badgeTag}
                            </div>
                        </div>
                        <div class="talent-dept">${dept}</div>
                    </div>
                `;
            }).join('');
        }

        function renderBadgeList() {
            const grid = document.getElementById('badge-grid');
            const meta = document.getElementById('badge-meta');

            const list = [...BADGE_AWARDEES_2025];
            meta.textContent = `2025 年颁发绿带徽章：共 ${list.length} 人（认证三科以上）`;

            grid.innerHTML = list.map((x, idx) => {
                const name = escapeHtml(x.name);
                const code = escapeHtml(x.code);
                return `
                    <div class="talent-card badge-award" style="animation-delay:${idx * 60}ms;">
                        <div class="badge-ribbon"><span class="badge-medal"></span>2025 绿带徽章</div>
                        <div class="talent-head">
                            <div class="talent-name">${idx + 1}. ${name}</div>
                            <div class="talent-tags">
                                <span class="talent-tag badge">${code}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function initTalentShowcase() {
            renderTalentFilters();
            switchTalentTab('list');

            const search = document.getElementById('talent-search');
            const dept = document.getElementById('talent-dept');
            const belt = document.getElementById('talent-belt');

            search.value = '';
            dept.value = 'ALL';
            belt.value = 'ALL';
            talentState.keyword = '';
            talentState.dept = 'ALL';
            talentState.belt = 'ALL';

            search.oninput = (e) => {
                talentState.keyword = e.target.value || '';
                renderTalentList();
            };
            dept.onchange = (e) => {
                talentState.dept = e.target.value || 'ALL';
                renderTalentList();
            };
            belt.onchange = (e) => {
                talentState.belt = e.target.value || 'ALL';
                renderTalentList();
            };

            renderTalentList();
            renderBadgeList();
        }

        function openProfile() {
            if (!ensureAuth(openProfile)) return;
            document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');
            document.getElementById('hero-page').style.display = 'none';
            document.getElementById('profile-page').style.display = 'block';
            setFooterVariant('simple');
            renderProfile();
            window.scrollTo(0,0);
        }

        function formatDateTime(d) {
            if (!d) return '';
            const raw = String(d);
            if (/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}/.test(raw)) return raw.slice(0, 16);
            const dt = new Date(raw);
            if (Number.isNaN(dt.getTime())) return raw;
            const parts = new Intl.DateTimeFormat('zh-CN', {
                timeZone: 'Asia/Shanghai',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            }).formatToParts(dt);
            const map = Object.fromEntries(parts.map(p => [p.type, p.value]));
            return `${map.year}-${map.month}-${map.day} ${map.hour}:${map.minute}`;
        }

        function getUserTalentInfoByName(name) {
            const n = String(name || '').trim();
            if (!n) return null;
            const matches = CERTIFIED_TALENTS.filter(t => String(t.name || '').trim() === n);
            if (matches.length === 0) return null;
            matches.sort((a, b) => {
                const ab = String(a.belt || '');
                const bb = String(b.belt || '');
                const ap = ab.includes('黑') ? 0 : 1;
                const bp = bb.includes('黑') ? 0 : 1;
                return ap - bp;
            });
            return matches[0];
        }

        async function renderProfile() {
            updateNavUser();
            const summary = document.getElementById('profile-summary');
            const examMeta = document.getElementById('profile-exam-meta');
            const examList = document.getElementById('profile-exam-list');
            if (!summary || !examMeta || !examList) return;

            const badgeSet = buildBadgeSet();
            const userName = appState.userInfo.name || '';
            const userId = appState.userInfo.id || '';
            const talent = getUserTalentInfoByName(userName);
            const hasBadge = badgeSet.has(String(userName || '').trim());

            const talentHtml = talent ? `
                <div class="talent-tags" style="margin-top: 6px;">
                    <span class="talent-tag ${beltClassName(talent.belt)}">${escapeHtml(talent.belt)}</span>
                    ${hasBadge ? `<span class="talent-tag badge">绿带徽章</span>` : ''}
                </div>
                <div class="talent-dept" style="margin-top: 6px;">部门：${escapeHtml(talent.dept)}</div>
            ` : `
                <div class="talent-dept" style="margin-top: 6px;">你还未出现在带级人才名单中，继续加油，期待你通过认证上榜。</div>
            `;

            const authTag = isGuest()
                ? `<span class="talent-tag black">员工模式（本机保存）</span>`
                : `<span class="talent-tag green">已注册</span>`;

            summary.innerHTML = `
                <div class="talent-head">
                    <div class="talent-name">${escapeHtml(userName || '员工')}（${userId ? `工号：${escapeHtml(userId)}` : '未登录'}）</div>
                    <div class="talent-tags">
                        ${authTag}
                    </div>
                </div>
                ${talentHtml}
            `;

            if (!isRegistered()) {
                examMeta.textContent = '当前为员工模式（本机保存）：成绩不跨设备同步。登录/注册后可自动同步成绩与学习记录。';
                examList.innerHTML = '';
                return;
            }

            examMeta.textContent = '加载中...';
            examList.innerHTML = '';

            try {
                const records = await apiGetUserExams(appState.userInfo.userId, appState.userInfo.id);
                if (!records || records.length === 0) {
                    examMeta.textContent = '暂无考试记录。去“资格认证”完成一次考试吧。';
                    examList.innerHTML = '';
                    return;
                }

                const best = Math.max(...records.map(r => Number(r.score || 0)));
                const last = records[0] ? formatDateTime(records[0].exam_date) : '';
                examMeta.textContent = `共 ${records.length} 次｜最高分 ${best}｜最近一次 ${last}`;

                examList.innerHTML = `
                    <table class="k-table">
                        <tr>
                            <th>时间</th>
                            <th>科目</th>
                            <th>分数</th>
                            <th>答对/总题</th>
                        </tr>
                        ${records.map(r => `
                            <tr>
                                <td>${escapeHtml(formatDateTime(r.exam_date))}</td>
                                <td>${escapeHtml(r.subject)}</td>
                                <td><strong>${escapeHtml(String(r.score))}</strong></td>
                                <td>${escapeHtml(String(r.correct_count))}/${escapeHtml(String(r.total_questions))}</td>
                            </tr>
                        `).join('')}
                    </table>
                `;
            } catch (e) {
                examMeta.textContent = '成绩加载失败，请稍后重试。';
                examList.innerHTML = '';
            }
        }

        const memoState = {
            tab: 'wrong',
            wrongItems: [],
            wrongKeyword: '',
            wrongSubject: 'ALL',
            notes: [],
            editingNoteId: null
        };

        const LOCAL_WRONG_KEY = 'haers_local_wrong_v1';
        const LOCAL_NOTES_KEY = 'haers_local_notes_v1';

        function nowDateTimeText() {
            return formatDateTime(new Date().toISOString());
        }

        function readLocalJson(key, fallback) {
            try {
                const raw = localStorage.getItem(key);
                if (!raw) return fallback;
                const parsed = JSON.parse(raw);
                return parsed === undefined || parsed === null ? fallback : parsed;
            } catch {
                return fallback;
            }
        }

        function writeLocalJson(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        function newLocalId() {
            return Number(`${Date.now()}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`);
        }

        function renderMemoModules() {
            const host = document.getElementById('memo-modules');
            if (!host) return;
            const hint = isRegistered()
                ? `<div class="memo-hint">已注册：内容会同步保存到数据库</div>`
                : `<div class="memo-hint">员工模式：内容仅保存在本机浏览器，不跨设备同步</div>`;
            host.innerHTML = `
                <div class="memo-grid">
                    <div class="memo-card" onclick="openMemoCenter('wrong')">
                        <div class="memo-head">
                            <div class="memo-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7 4h10a2 2 0 0 1 2 2v14" />
                                    <path d="M5 6a2 2 0 0 1 2-2v16a2 2 0 0 0-2-2h12" />
                                    <path d="M9 9h6" />
                                    <path d="M9 12h5" />
                                    <path d="M9 15h4" />
                                    <path d="M14 18l2-2 2 2" />
                                </svg>
                            </div>
                            <div class="memo-title">错题本</div>
                        </div>
                        <div class="memo-desc">自动收集练习/考试的错题，支持删除已掌握题目。</div>
                        ${hint}
                    </div>
                    <div class="memo-card" onclick="openMemoCenter('notes')">
                        <div class="memo-head">
                            <div class="memo-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19V6a2 2 0 0 1 2-2h9a3 3 0 0 1 3 3v12" />
                                    <path d="M6 18h11" />
                                    <path d="M8 8h7" />
                                    <path d="M8 11h7" />
                                    <path d="M8 14h5" />
                                    <path d="M8 21h10" />
                                </svg>
                            </div>
                            <div class="memo-title">笔记本</div>
                        </div>
                        <div class="memo-desc">记录你自己的精益知识要点与复盘总结，下次打开仍可查看。</div>
                        ${hint}
                    </div>
                </div>
            `;
        }

        function openMemoCenter(tab) {
            if (!ensureAuth(() => openMemoCenter(tab))) return;
            document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');
            document.getElementById('hero-page').style.display = 'none';
            document.getElementById('memo-page').style.display = 'block';
            setFooterVariant('simple');
            switchMemoTab(tab || 'wrong');
            window.scrollTo(0,0);
        }

        function switchMemoTab(tab) {
            memoState.tab = tab === 'notes' ? 'notes' : 'wrong';
            const wrongBtn = document.getElementById('tab-memo-wrong');
            const noteBtn = document.getElementById('tab-memo-notes');
            const wrongPanel = document.getElementById('memo-panel-wrong');
            const notePanel = document.getElementById('memo-panel-notes');
            const guestTip = document.getElementById('memo-guest-tip');

            const activeStyle = (btn, on) => {
                btn.classList.toggle('btn-primary', on);
                btn.classList.toggle('btn-outline', !on);
            };
            activeStyle(wrongBtn, memoState.tab === 'wrong');
            activeStyle(noteBtn, memoState.tab === 'notes');

            const employeeMode = !isRegistered();
            if (guestTip) guestTip.style.display = employeeMode ? 'block' : 'none';
            wrongPanel.style.display = memoState.tab === 'wrong' ? 'block' : 'none';
            notePanel.style.display = memoState.tab === 'notes' ? 'block' : 'none';

            if (memoState.tab === 'wrong') loadWrongBook();
            else loadNotes();
        }

        function filterWrongItems(items, keyword) {
            const k = String(keyword || '').trim().toLowerCase();
            if (!k) return items;
            return items.filter(x => {
                const hay = `${x.subject || ''} ${x.question_text || ''} ${x.correct_answer || ''} ${x.user_answer || ''}`.toLowerCase();
                return hay.includes(k);
            });
        }

        async function loadWrongBook() {
            const meta = document.getElementById('wrong-meta');
            const listEl = document.getElementById('wrong-list');
            const subjectSel = document.getElementById('wrong-subject');
            const searchEl = document.getElementById('wrong-search');
            if (!meta || !listEl || !subjectSel || !searchEl) return;

            if (!searchEl.dataset.bound) {
                searchEl.dataset.bound = '1';
                searchEl.oninput = () => {
                    memoState.wrongKeyword = searchEl.value || '';
                    renderWrongList();
                };
            }
            if (!subjectSel.dataset.bound) {
                subjectSel.dataset.bound = '1';
                subjectSel.onchange = () => {
                    memoState.wrongSubject = subjectSel.value || 'ALL';
                    loadWrongBook();
                };
            }
            searchEl.value = memoState.wrongKeyword || '';
            subjectSel.value = memoState.wrongSubject || 'ALL';

            meta.textContent = '加载中...';
            listEl.innerHTML = '';

            if (isRegistered()) {
                const items = await apiGetWrongQuestions(appState.userInfo.userId, appState.userInfo.id, memoState.wrongSubject);
                memoState.wrongItems = items || [];
            } else {
                const all = readLocalJson(LOCAL_WRONG_KEY, []);
                const subj = memoState.wrongSubject || 'ALL';
                memoState.wrongItems = subj === 'ALL' ? all : all.filter(x => String(x.subject || '') === subj);
            }
            renderWrongList();
        }

        function renderWrongList() {
            const meta = document.getElementById('wrong-meta');
            const listEl = document.getElementById('wrong-list');
            const items = filterWrongItems(memoState.wrongItems, memoState.wrongKeyword);
            meta.textContent = `共 ${items.length} 道错题`;
            listEl.innerHTML = items.map(x => `
                <div class="talent-card">
                    <div class="talent-head">
                        <div class="talent-name">${escapeHtml(x.subject || '')}｜${escapeHtml(x.created_at || '')}</div>
                        <div class="talent-tags">
                            <button class="btn btn-outline" onclick="deleteWrongItem(${Number(x.id)})" style="padding:6px 10px;">已掌握</button>
                        </div>
                    </div>
                    <div class="talent-dept" style="margin-top: 6px;">题目：${escapeHtml(x.question_text || '')}</div>
                    <div class="talent-dept" style="margin-top: 6px;">你的答案：<strong>${escapeHtml(x.user_answer || '')}</strong></div>
                    <div class="talent-dept" style="margin-top: 6px;">正确答案：<strong>${escapeHtml(x.correct_answer || '')}</strong></div>
                </div>
            `).join('');
        }

        async function deleteWrongItem(id) {
            if (!confirm('确认删除这道错题（已掌握）吗？')) return;
            if (isRegistered()) {
                const res = await apiDeleteWrongQuestion({ userId: appState.userInfo.userId, employeeId: appState.userInfo.id, wrongId: id });
                if (!res.ok || !res.data || !res.data.success) {
                    alert(`删除失败：${(res.data && res.data.error) || '请稍后重试'}`);
                    return;
                }
                await loadWrongBook();
                return;
            }
            const all = readLocalJson(LOCAL_WRONG_KEY, []);
            const next = all.filter(x => String(x.id) !== String(id));
            writeLocalJson(LOCAL_WRONG_KEY, next);
            await loadWrongBook();
        }

        async function loadNotes() {
            const meta = document.getElementById('note-meta');
            const listEl = document.getElementById('note-list');
            if (!meta || !listEl) return;
            meta.textContent = '加载中...';
            listEl.innerHTML = '';

            if (isRegistered()) {
                const items = await apiGetNotes(appState.userInfo.userId, appState.userInfo.id);
                memoState.notes = items || [];
            } else {
                memoState.notes = readLocalJson(LOCAL_NOTES_KEY, []);
            }
            meta.textContent = `共 ${memoState.notes.length} 条笔记`;
            listEl.innerHTML = memoState.notes.map(n => `
                <div class="talent-card">
                    <div class="talent-head">
                        <div class="talent-name">${escapeHtml(n.title || '')}</div>
                        <div class="talent-tags">
                            <button class="btn btn-outline" onclick="editNote(${Number(n.id)})" style="padding:6px 10px;">编辑</button>
                            <button class="btn btn-outline" onclick="deleteNote(${Number(n.id)})" style="padding:6px 10px; border-color:#dc3545; color:#dc3545;">删除</button>
                        </div>
                    </div>
                    <div class="talent-dept" style="margin-top: 6px; white-space: pre-wrap;">${escapeHtml(n.content || '')}</div>
                    <div class="talent-dept" style="margin-top: 10px; color:#9aa3b2;">更新：${escapeHtml(n.updated_at || '')}</div>
                </div>
            `).join('');
        }

        function resetNoteForm() {
            memoState.editingNoteId = null;
            const title = document.getElementById('note-title');
            const content = document.getElementById('note-content');
            const formTitle = document.getElementById('note-form-title');
            const cancel = document.getElementById('note-cancel-btn');
            if (title) title.value = '';
            if (content) content.value = '';
            if (formTitle) formTitle.textContent = '新建笔记';
            if (cancel) cancel.style.display = 'none';
        }

        function editNote(id) {
            const n = memoState.notes.find(x => Number(x.id) === Number(id));
            if (!n) return;
            memoState.editingNoteId = Number(id);
            document.getElementById('note-title').value = n.title || '';
            document.getElementById('note-content').value = n.content || '';
            document.getElementById('note-form-title').textContent = '编辑笔记';
            document.getElementById('note-cancel-btn').style.display = 'inline-flex';
            window.scrollTo(0,0);
        }

        async function saveNote() {
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('note-content').value.trim();
            if (!title || !content) {
                alert('标题和内容不能为空');
                return;
            }
            if (isRegistered()) {
                const res = await apiUpsertNote({
                    userId: appState.userInfo.userId,
                    employeeId: appState.userInfo.id,
                    noteId: memoState.editingNoteId,
                    title,
                    content
                });
                if (!res.ok || !res.data || !res.data.success) {
                    alert(`保存失败：${(res.data && res.data.error) || '请稍后重试'}`);
                    return;
                }
                resetNoteForm();
                await loadNotes();
                return;
            }

            const all = readLocalJson(LOCAL_NOTES_KEY, []);
            const now = nowDateTimeText();
            const noteId = memoState.editingNoteId ? Number(memoState.editingNoteId) : null;
            if (noteId) {
                const idx = all.findIndex(x => Number(x.id) === noteId);
                if (idx >= 0) {
                    all[idx] = { ...all[idx], title, content, updated_at: now };
                } else {
                    all.unshift({ id: noteId, title, content, updated_at: now });
                }
            } else {
                all.unshift({ id: newLocalId(), title, content, updated_at: now });
            }
            writeLocalJson(LOCAL_NOTES_KEY, all);
            resetNoteForm();
            await loadNotes();
        }

        async function deleteNote(id) {
            if (!confirm('确认删除这条笔记吗？')) return;
            if (isRegistered()) {
                const res = await apiDeleteNote({ userId: appState.userInfo.userId, employeeId: appState.userInfo.id, noteId: id });
                if (!res.ok || !res.data || !res.data.success) {
                    alert(`删除失败：${(res.data && res.data.error) || '请稍后重试'}`);
                    return;
                }
                resetNoteForm();
                await loadNotes();
                return;
            }

            const all = readLocalJson(LOCAL_NOTES_KEY, []);
            const next = all.filter(x => String(x.id) !== String(id));
            writeLocalJson(LOCAL_NOTES_KEY, next);
            resetNoteForm();
            await loadNotes();
        }

        async function recordWrongQuestion(q, userIdx, source) {
            if (!q || userIdx === undefined) return;
            const options = Array.isArray(q.options) ? q.options.map(o => ({ text: o.text })) : [];
            const correctAnswer = q.options && q.options[q.correctIndex] ? String(q.options[q.correctIndex].text || '') : '';
            const idx = Number.isInteger(userIdx) ? userIdx : null;
            const userAnswer = (idx !== null && q.options && q.options[idx]) ? String(q.options[idx].text || '') : '未作答';
            const questionText = String(q.text || '').replace(/<[^>]*>/g, '').trim();
            if (isRegistered()) {
                await apiUpsertWrongQuestion({
                    userId: appState.userInfo.userId,
                    employeeId: appState.userInfo.id,
                    subject: appState.subject || '',
                    questionText,
                    options,
                    correctAnswer,
                    userAnswer,
                    source: source || ''
                });
                return;
            }
            const all = readLocalJson(LOCAL_WRONG_KEY, []);
            all.unshift({
                id: newLocalId(),
                subject: appState.subject || '',
                question_text: questionText,
                correct_answer: correctAnswer,
                user_answer: userAnswer,
                created_at: nowDateTimeText(),
                source: source || ''
            });
            writeLocalJson(LOCAL_WRONG_KEY, all);
        }

        function closeLoginModal() {
            if (!isLoggedIn()) return;
            document.getElementById('login-modal').style.display = 'none';
        }

        function guestLogin(silent) {
            appState.userInfo = {
                auth: 'guest',
                name: '员工',
                id: '',
                userId: null,
                avatar: appState.userInfo.avatar || AVATAR_OPTIONS[0].id
            };
            updateNavUser();
            document.getElementById('login-modal').style.display = 'none';
            const cb = postLoginCallback;
            postLoginCallback = null;
            if (silent) return;
            if (cb) cb();
            else goHome();
        }

        async function submitAuth() {
            const name = document.getElementById('user-name').value.trim();
            const id = document.getElementById('user-id').value.trim();

            if (!name || !id) {
                alert("请填写完整的姓名和工号！");
                return;
            }
            if (!/^\d{7}$/.test(id)) {
                alert("工号必须是7位数字，例如：1234567");
                return;
            }

            const submitBtn = document.getElementById('auth-primary-btn');
            const originalText = submitBtn ? submitBtn.textContent : '';
            if (submitBtn) {
                submitBtn.textContent = authView === 'register' ? '注册中...' : '登录中...';
                submitBtn.disabled = true;
            }

            const result = authView === 'register'
                ? await apiRegister(id, name, appState.userInfo.avatar || AVATAR_OPTIONS[0].id)
                : await apiLogin(id, name);

            if (submitBtn) {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }

            if (!result.ok || !result.user) {
                alert(result.error || (authView === 'register' ? '注册失败，请稍后重试。' : '登录失败，请稍后重试。'));
                return;
            }

            appState.userInfo = { auth: 'user', userId: result.user.id, id: result.user.employeeId, name: result.user.name, avatar: result.user.avatar || appState.userInfo.avatar || AVATAR_OPTIONS[0].id };
            saveSession();
            updateNavUser();

            document.getElementById('login-modal').style.display = 'none';
            const cb = postLoginCallback;
            postLoginCallback = null;
            if (cb) cb();
            else goHome();
        }

        function initStudy() {
            document.getElementById('study-page').style.display = 'block';
            document.getElementById('study-subject-title').textContent = KNOWLEDGE_BASE[appState.subject].title;
            const douyinLink = `
                <div style="margin-top:50px; padding-top:30px; border-top:2px dashed #eee; text-align:center;">
                    <a href="https://v.douyin.com/gD5XK5Bc53E/" target="_blank"
                       style="display:inline-flex; align-items:center; gap:12px; padding:16px 32px;
                              background:linear-gradient(135deg, #002FA7 0%, #0047cc 100%);
                              color:white; border-radius:50px; text-decoration:none;
                              box-shadow:0 8px 24px rgba(0,47,167,0.3);
                              transition:all 0.3s ease; font-weight:700; font-size:1.1rem;"
                       onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 32px rgba(0,47,167,0.4)';"
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 24px rgba(0,47,167,0.3)';">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="white" style="flex-shrink:0;">
                            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                        </svg>
                        <span>🎬 点击观看视频学习</span>
                    </a>
                    <p style="margin-top:15px; color:#888; font-size:0.9rem;">点击上方按钮即可打开视频学习内容。</p>
                </div>
            `;
            document.getElementById('study-content').innerHTML = KNOWLEDGE_BASE[appState.subject].content + douyinLink;
            setFooterVariant('simple');
            window.scrollTo(0,0);
        }

        function quickPractice() {
            appState.mode = 'practice';
            document.getElementById('study-page').style.display = 'none';
            initPractice();
        }

        function initPractice() {
            document.getElementById('quiz-page').style.display = 'block';
            document.getElementById('quiz-mode-badge').textContent = "强化练习模式";
            document.getElementById('quiz-mode-badge').style.background = "var(--klein-blue)";
            document.getElementById('timer-box').style.display = 'none';
            document.getElementById('q-nav-grid').style.display = 'none';
            document.getElementById('prev-btn').style.visibility = 'hidden'; 
            
            document.getElementById('skip-btn').style.display = 'inline-block';
            
            let allQ = engine.generateForSubject(appState.subject);
            appState.questions = [...allQ];
            
            appState.currentIndex = 0;
            renderQuestion();
        }

        function initExam() {
            document.getElementById('quiz-page').style.display = 'block';
            document.getElementById('quiz-mode-badge').textContent = "正式考试";
            document.getElementById('quiz-mode-badge').style.background = "var(--fail-red)";
            document.getElementById('timer-box').style.display = 'block';
            document.getElementById('q-nav-grid').style.display = 'grid';
            document.getElementById('prev-btn').style.visibility = 'visible';
            
            document.getElementById('skip-btn').style.display = 'none';

            let allQ = engine.generateForSubject(appState.subject);
            appState.questions = allQ.slice(0, 20); 
            
            appState.currentIndex = 0;
            appState.examAnswers = new Array(20).fill(null);
            appState.timeLeft = 1200; 

            renderNavGrid();
            startTimer();
            renderQuestion();
        }

        function renderNavGrid() {
            const grid = document.getElementById('q-nav-grid');
            grid.innerHTML = '';
            appState.questions.forEach((_, idx) => {
                const btn = document.createElement('div');
                btn.className = 'q-nav-item';
                btn.textContent = idx + 1;
                btn.id = `nav-item-${idx}`;
                btn.onclick = () => {
                    appState.currentIndex = idx;
                    renderQuestion();
                };
                grid.appendChild(btn);
            });
            updateNavGridStatus();
        }

        function updateNavGridStatus() {
            if (appState.mode !== 'exam') return;
            appState.questions.forEach((_, idx) => {
                const btn = document.getElementById(`nav-item-${idx}`);
                btn.classList.remove('active', 'answered');
                if (idx === appState.currentIndex) btn.classList.add('active');
                if (appState.examAnswers[idx] !== null) btn.classList.add('answered');
            });
        }

        function renderQuestion() {
            let q = appState.questions[appState.currentIndex];
            let total = appState.questions.length;
            
            document.getElementById('quiz-progress').textContent = `QUESTION ${appState.currentIndex + 1} / ${total}`;
            document.getElementById('question-text').innerHTML = q.text;
            
            let container = document.getElementById('options-container');
            container.innerHTML = '';
            const feedback = document.getElementById('feedback-container');
            feedback.style.display = 'none';
            feedback.className = 'feedback-box';

            if (q.type === 'TF') {
                container.style.gridTemplateColumns = '1fr 1fr';
            } else {
                container.style.gridTemplateColumns = '1fr';
            }

            q.options.forEach((opt, idx) => {
                let div = document.createElement('div');
                div.className = 'option';
                div.dataset.idx = idx;
                
                if(q.type === 'TF') {
                    div.innerHTML = `<div style="text-align:center; width:100%; font-weight:bold;">${opt.text}</div>`;
                } else {
                    div.innerHTML = `<div class="opt-char">${String.fromCharCode(65+idx)}</div><div>${opt.text}</div>`;
                }
                
                div.onclick = () => selectOption(div, idx);
                
                if (appState.mode === 'exam' && appState.examAnswers[appState.currentIndex] === idx) {
                    div.classList.add('selected');
                }
                container.appendChild(div);
            });

            const actionBtn = document.getElementById('action-btn');
            if (appState.mode === 'practice') {
                actionBtn.textContent = "提交答案";
                actionBtn.onclick = checkAnswerPractice;
                document.getElementById('prev-btn').style.visibility = 'hidden';
            } else {
                actionBtn.textContent = (appState.currentIndex === 19) ? "交卷" : "下一题";
                actionBtn.onclick = (appState.currentIndex === 19) ? finishExam : nextQuestionExam;
                document.getElementById('prev-btn').style.visibility = (appState.currentIndex === 0) ? 'hidden' : 'visible';
            }
            updateNavGridStatus();
        }

        function selectOption(el, idx) {
            if (appState.mode === 'practice' && document.getElementById('feedback-container').style.display === 'block') return;

            document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            
            if (appState.mode === 'exam') {
                appState.examAnswers[appState.currentIndex] = idx;
                updateNavGridStatus();
            }
        }

        function checkAnswerPractice() {
            let selected = document.querySelector('.option.selected');
            if (!selected) return alert("请先选择一个选项");

            let userIdx = parseInt(selected.dataset.idx);
            let q = appState.questions[appState.currentIndex];
            let feedback = document.getElementById('feedback-container');
            let opts = document.querySelectorAll('.option');

            opts.forEach(o => o.style.pointerEvents = 'none');

            if (userIdx === q.correctIndex) {
                selected.classList.add('correct');
                feedback.style.background = '#e7f9ee';
                feedback.style.color = 'var(--success-green)';
                feedback.style.borderLeftColor = 'var(--success-green)';
                feedback.innerHTML = "<strong>✅ 回答正确！</strong>";
                if(q.explanation) {
                    feedback.innerHTML += `<br><span style="font-size:0.9rem; color:#555; margin-top:5px; display:block;">解析：${q.explanation}</span>`;
                }
            } else {
                selected.classList.add('wrong');
                opts[q.correctIndex].classList.add('correct');
                feedback.style.background = '#fceaea';
                feedback.style.color = 'var(--fail-red)';
                feedback.style.borderLeftColor = 'var(--fail-red)';
                feedback.innerHTML = "<strong>❌ 回答错误</strong>";
                if(q.explanation) {
                    feedback.innerHTML += `<br><span style="font-size:0.9rem; color:#555; margin-top:5px; display:block;">解析：${q.explanation}</span>`;
                }
                recordWrongQuestion(q, userIdx, 'practice');
            }
            feedback.style.display = 'block';

            let btn = document.getElementById('action-btn');
            btn.textContent = "下一题";
            btn.onclick = () => {
                if (appState.currentIndex < appState.questions.length - 1) {
                    appState.currentIndex++;
                    renderQuestion();
                } else {
                    alert("本轮练习结束！");
                    goHome();
                }
            };
        }

        function nextPracticeQuestion() {
            if (appState.currentIndex < appState.questions.length - 1) {
                appState.currentIndex++;
                renderQuestion();
            } else {
                alert("本轮练习结束！");
                goHome();
            }
        }

        function prevQuestion() {
            if (appState.currentIndex > 0) {
                appState.currentIndex--;
                renderQuestion();
            }
        }

        function nextQuestionExam() {
            if (appState.currentIndex < 19) {
                appState.currentIndex++;
                renderQuestion();
            }
        }

        function handleAction() {
            // Placeholder
        }

        function startTimer() {
            appState.timer = setInterval(() => {
                appState.timeLeft--;
                let m = Math.floor(appState.timeLeft / 60);
                let s = appState.timeLeft % 60;
                document.getElementById('timer-box').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                
                if (appState.timeLeft <= 0) {
                    clearInterval(appState.timer);
                    alert("时间到！自动交卷。");
                    finishExam();
                }
            }, 1000);
        }

        function stopTimer() {
            if (appState.timer) clearInterval(appState.timer);
        }

        function quitQuiz() {
            if (appState.mode === 'exam') {
                if(!confirm("考试正在进行中，退出将不记录成绩。确定退出吗？")) return;
            }
            goHome();
        }

        async function finishExam() {
            let unanswered = appState.examAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                if(!confirm(`您还有 ${unanswered} 道题未作答，确定要交卷吗？`)) return;
            }

            stopTimer();
            let correctCount = 0;
            const wrongAnswers = []; // 收集错题信息

            appState.questions.forEach((q, i) => {
                if (appState.examAnswers[i] === q.correctIndex) {
                    correctCount++;
                } else {
                    // 记录错题
                    const userOpt = appState.examAnswers[i] !== null
                        ? q.options[appState.examAnswers[i]]
                        : null;
                    const correctOpt = q.options[q.correctIndex];

                    wrongAnswers.push({
                        questionNumber: i + 1,
                        questionText: q.text,
                        userAnswer: userOpt ? userOpt.text : '未作答',
                        correctAnswer: correctOpt.text
                    });
                    recordWrongQuestion(q, appState.examAnswers[i], 'exam');
                }
            });

            let score = correctCount * 5;
            let passed = score >= 90;
            const timeSpent = 1200 - appState.timeLeft; // 计算用时（秒）

            document.getElementById('quiz-page').style.display = 'none';
            document.getElementById('result-page').style.display = 'block';

            // 显示用户信息
            document.getElementById('res-name').textContent = appState.userInfo.name || "未知考生";
            document.getElementById('res-id').textContent = appState.userInfo.id || "N/A";

            animateScore(score);

            const trophy = document.querySelector('.trophy-anim');
            const failIcon = document.querySelector('.fail-anim');
            const msg = document.getElementById('result-message');

            trophy.style.display = 'none';
            failIcon.style.display = 'none';
            document.querySelectorAll('.confetti').forEach(e => e.remove());

            if (passed) {
                trophy.style.display = 'block';
                msg.textContent = "恭喜通过认证！您已掌握该模块核心技能。";
                msg.style.color = "var(--success-green)";
                createConfetti();
            } else {
                failIcon.style.display = 'block';
                msg.textContent = "很遗憾未通过，请复习知识点后再试。";
                msg.style.color = "var(--fail-red)";
            }

            // 尝试保存成绩到API
            if (appState.userInfo.userId) {
                const examData = {
                    userId: appState.userInfo.userId,
                    employeeId: appState.userInfo.id,
                    subject: appState.subject,
                    score: score,
                    totalQuestions: appState.questions.length,
                    correctCount: correctCount,
                    timeSpent: timeSpent,
                    wrongAnswers: wrongAnswers
                };

                const saveResult = await apiSaveExam(examData);
                if (saveResult && saveResult.success) {
                    console.log('成绩已保存:', saveResult);
                    // 可以在这里显示历史最高分等信息
                    if (saveResult.bestScore) {
                        msg.textContent += ` (历史最高: ${saveResult.bestScore}分)`;
                    }
                } else {
                    console.warn('成绩保存失败，但考试已完成');
                }
            }

            renderExamReport();
        }

        function animateScore(target) {
            let current = 0;
            const el = document.getElementById('final-score');
            const step = () => {
                if (current < target) {
                    current += 1;
                    el.textContent = current;
                    requestAnimationFrame(step);
                } else {
                    el.textContent = target;
                }
            };
            requestAnimationFrame(step);
        }

        function createConfetti() {
            const colors = ['#FFD700', '#002FA7', '#28a745', '#ff0055'];
            for (let i = 0; i < 50; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDuration = (Math.random() * 2 + 2) + 's';
                conf.style.animationDelay = (Math.random() * 1) + 's';
                document.body.appendChild(conf);
            }
        }

        function retryExam() {
            // 重考时不需要重新登录，直接开始
            initExam();
        }

        // 初始化
        window.onload = function() {
            const restored = loadSession();
            if (!restored) guestLogin(true);
            updateNavUser();
            goHome();
        };
    </script>
</body>
</html>
